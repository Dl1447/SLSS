<!DOCTYPE html>
<!-- 
Student Learning Situation Statistics (SLSS)

A lightweight classroom management web application for tracking student performance,
homework submission status, and course evaluations.

Copyright (c) 2025 All_lan
Licensed under the MIT License
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3B82F6">
    <meta name="description" content="è½»é‡çº§è¯¾å ‚ç»Ÿè®¡ç®¡ç†Webåº”ç”¨">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="bjbz.png">
    <title>å­¦æƒ…ç»Ÿè®¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                    secondary: '#10B981',
                    accent: '#8B5CF6',
                    warning: '#F59E0B',
                    danger: '#EF4444',
                    light: '#F3F4F6',
                    dark: '#1F2937'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'shine': 'shine 2s infinite',
                        'glass-flow': 'glassFlow 8s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        shine: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' }
                        },
                        glassFlow: {
                            '0%': { backgroundPosition: '0% 50%' },
                            '100%': { backgroundPosition: '100% 50%' }
                        }
                    }
                },
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {                -ms-overflow-style: none;                scrollbar-width: none;            }
            .ios-scrollbar::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .ios-scrollbar::-webkit-scrollbar-track {
                background: transparent;
            }
            .ios-scrollbar::-webkit-scrollbar-thumb {
                background: rgba(156, 163, 175, 0.5);
                border-radius: 3px;
                transition: background 0.3s ease;
            }
            .ios-scrollbar::-webkit-scrollbar-thumb:hover {
                background: rgba(156, 163, 175, 0.8);
            }
            .ios-scrollbar {
                scrollbar-width: thin;
                scrollbar-color: rgba(156, 163, 175, 0.5) transparent;
            }
            .star-active {
                color: #F59E0B;
                text-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
            }
            .star-inactive {
                color: #D1D5DB;
                transition: color 0.3s ease;
            }
            .star-inactive:hover {
                color: #F59E0B;
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.75);
                backdrop-filter: blur(16px);
                -webkit-backdrop-filter: blur(16px);
                border: 1px solid rgba(255, 255, 255, 0.25);
                box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
                transition: all 0.3s ease;
            }
            .glass-effect:hover {
                background: rgba(255, 255, 255, 0.85);
                box-shadow: 0 12px 40px -12px rgba(31, 38, 135, 0.2);
            }
            .glass-effect-dark {
                background: rgba(30, 41, 59, 0.75);
                backdrop-filter: blur(16px);
                -webkit-backdrop-filter: blur(16px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            }
            .glass-effect-dark:hover {
                background: rgba(30, 41, 59, 0.85);
                box-shadow: 0 12px 40px -12px rgba(0, 0, 0, 0.25);
            }
            .gradient-border {
                position: relative;
                border-radius: 12px;
                z-index: 0;
                overflow: hidden;
            }
            .gradient-border::before {
                content: '';
                position: absolute;
                inset: -2px;
                z-index: -2;
                border-radius: 14px;
                background: linear-gradient(45deg, #3B82F6, #8B5CF6, #10B981, #F59E0B, #EF4444, #3B82F6);
                background-size: 400% 400%;
                animation: gradient-animation 15s ease infinite;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            .gradient-border:hover::before {
                opacity: 1;
            }
            .gradient-border::after {
                content: '';
                position: absolute;
                inset: 0;
                z-index: -1;
                border-radius: 12px;
                background: inherit;
            }
            .hover-lift {
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .hover-lift:hover {
                transform: translateY(-6px);
                box-shadow: 0 16px 32px -8px rgba(59, 130, 246, 0.25);
            }
            .text-gradient {
                background: linear-gradient(90deg, #3B82F6, #8B5CF6, #10B981);
                background-size: 300% 300%;
                -webkit-background-clip: text;
                background-clip: text;
                color: transparent;
                animation: gradient-animation 15s ease infinite;
            }
            .shine-effect {
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
                background-size: 200% 100%;
                animation: shine 2s infinite;
            }
            .ripple-effect {
                position: relative;
                overflow: hidden;
            }
            .ripple-effect::after {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, transparent 70%);
                transform: scale(0);
                transition: transform 0.6s ease;
            }
            .ripple-effect:active::after {
                transform: scale(2);
            }
            .pulse-card {
                animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .float-slow {
                animation: float 6s ease-in-out infinite;
            }
            .bg-pattern {
                position: absolute;
                inset: 0;
                background-image: 
                    radial-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
                    radial-gradient(rgba(139, 92, 246, 0.1) 1px, transparent 1px);
                background-size: 30px 30px;
                background-position: 0 0, 15px 15px;
                opacity: 0;
                transition: opacity 0.5s ease;
            }
            .glass-effect:hover .bg-pattern {
                opacity: 0.7;
            }
            .glass-effect-dark:hover .bg-pattern {
                opacity: 0.3;
            }
            
            /* èƒŒæ™¯æ ·å¼é›†åˆ */
            .bg-theme-blue {
                background: linear-gradient(135deg, #EBF4FF 0%, #DBEAFE 100%);
            }
            .bg-theme-purple {
                background: linear-gradient(135deg, #F3E8FF 0%, #E9D5FF 100%);
            }
            .bg-theme-green {
                background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
            }
            .bg-theme-pink {
                background: linear-gradient(135deg, #FDF2F8 0%, #FCE7F3 100%);
            }
            .bg-theme-orange {
                background: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%);
            }
            .bg-theme-dark {
                background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            }
            
            /* èƒŒæ™¯è£…é¥°å…ƒç´ åŠ¨ç”» */
            .bg-blob {
                position: absolute;
                border-radius: 50%;
                filter: blur(80px);
                opacity: 0.7;
                transition: all 1s ease;
                mix-blend-mode: overlay;
            }
            
            .bg-grid {
                background-image: 
                    linear-gradient(rgba(59, 130, 246, 0.05) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
                background-size: 20px 20px;
            }
            
            .bg-dots {
                background-image: radial-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px);
                background-size: 20px 20px;
            }
            
            .bg-circuit {
                background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%233b82f6' fill-opacity='0.07'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            }
            
            /* é¼ æ ‡ç‚¹å‡»åŠ¨ç”» */
            .cursor-effect {
                position: fixed;
                width: 80px;
                height: 80px;
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
                transform: translate(-50%, -50%) scale(0);
                transition: transform 0.4s ease-out;
                background: radial-gradient(circle, rgba(59, 130, 246, 0.8) 0%, rgba(139, 92, 246, 0.6) 50%, transparent 100%);
                mix-blend-mode: screen;
                opacity: 0;
                animation: cursorPop 0.6s ease-out forwards;
            }
            
            .cursor-effect-sparkle {
                position: fixed;
                width: 4px;
                height: 4px;
                background: white;
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
                opacity: 0;
                box-shadow: 0 0 8px 2px rgba(255, 255, 255, 0.8);
            }
        }
        
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            }
            50% {
                box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.25);
            }
        }
        
        @keyframes shine {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes blob-move {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        
        @keyframes bg-scroll {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }
        
        @keyframes cursorPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }
        
        @keyframes sparkleFly {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-40px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    
    <!-- è‡ªå®šä¹‰èƒŒæ™¯å®¹å™¨ -->
    <div id="background-container" class="fixed inset-0 -z-20 bg-theme-blue transition-colors duration-1000 ease-in-out bg-grid"></div>
    
    <!-- èƒŒæ™¯è£…é¥°å…ƒç´  -->
    <div id="bg-decoration-1" class="bg-blob bg-blue-400 top-[10%] left-[20%] w-[300px] h-[300px] animate-[blob-move_20s_infinite]"></div>
    <div id="bg-decoration-2" class="bg-blob bg-purple-400 top-[40%] right-[15%] w-[400px] h-[400px] animate-[blob-move_15s_infinite_1s]"></div>
    <div id="bg-decoration-3" class="bg-blob bg-indigo-400 bottom-[15%] left-[25%] w-[350px] h-[350px] animate-[blob-move_18s_infinite_2s]"></div>
    <div id="bg-decoration-4" class="bg-blob bg-teal-400 bottom-[20%] right-[25%] w-[250px] h-[250px] animate-[blob-move_22s_infinite_3s]"></div>
    
    <!-- èƒŒæ™¯çº¹ç†å±‚ -->
    <div id="bg-texture" class="fixed inset-0 -z-10 bg-dots opacity-70"></div>
    
    <!-- èƒŒæ™¯æ§åˆ¶é¢æ¿ -->
    <button id="bg-toggle-btn" class="fixed bottom-5 right-5 z-50 glass-effect p-3 rounded-full shadow-lg hover-lift transition-all duration-300">
        <i class="fa fa-paint-brush text-primary text-xl"></i>
    </button>
    
    <div id="bg-panel" class="fixed bottom-20 right-5 z-50 glass-effect p-5 rounded-2xl shadow-xl w-72 hidden">
        <h3 class="text-lg font-semibold text-dark mb-4 flex items-center gap-2">
            <i class="fa fa-magic text-primary"></i>
            èƒŒæ™¯è®¾ç½®
        </h3>
        
        <div class="space-y-4">
            <!-- ä¸»é¢˜é€‰æ‹© -->
            <div class="text-inherit">
                <label class="block text-sm font-medium text-inherit mb-2">ä¸»é¢˜é¢œè‰²</label>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="changeBackgroundTheme('blue')" class="h-8 rounded-lg bg-primary/10 border-2 border-transparent hover:border-primary transition-all" title="è“è‰²ä¸»é¢˜"></button>
                    <button onclick="changeBackgroundTheme('purple')" class="h-8 rounded-lg bg-accent/10 border-2 border-transparent hover:border-accent transition-all" title="ç´«è‰²ä¸»é¢˜"></button>
                    <button onclick="changeBackgroundTheme('green')" class="h-8 rounded-lg bg-secondary/10 border-2 border-transparent hover:border-secondary transition-all" title="ç»¿è‰²ä¸»é¢˜"></button>
                    <button onclick="changeBackgroundTheme('pink')" class="h-8 rounded-lg bg-pink-500/10 border-2 border-transparent hover:border-pink-500 transition-all" title="ç²‰è‰²ä¸»é¢˜"></button>
                    <button onclick="changeBackgroundTheme('orange')" class="h-8 rounded-lg bg-warning/10 border-2 border-transparent hover:border-warning transition-all" title="æ©™è‰²ä¸»é¢˜"></button>
                    <button onclick="changeBackgroundTheme('dark')" class="h-8 rounded-lg bg-dark border-2 border-transparent hover:border-gray-500 transition-all" title="æš—è‰²ä¸»é¢˜"></button>
                </div>
            </div>
            
            <!-- å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ -->
            <div class="pt-4 text-inherit">
                <label class="block text-sm font-medium text-inherit mb-2">è‡ªå®šä¹‰èƒŒæ™¯å›¾</label>
                <div class="border-2 border-dashed rounded-lg p-4 text-center hover:border-primary transition-all cursor-pointer relative overflow-hidden" id="image-upload-area">
                    <input type="file" id="image-upload" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" />
                    <i class="fa fa-upload text-2xl mb-2 text-inherit/70"></i>
                    <p class="text-sm text-inherit/80 mb-1">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</p>
                    <p id="image-upload-status" class="text-xs text-inherit/60">æ”¯æŒ JPG, PNG, WEBP æ ¼å¼</p>
                </div>
                
                <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
                <div id="image-preview-container" class="hidden mt-3">
                    <div class="relative rounded-lg overflow-hidden border border-inherit/30">
                        <img id="image-preview" class="w-full h-32 object-cover" src="" alt="é¢„è§ˆå›¾ç‰‡" />
                        <button id="remove-image" class="absolute top-2 right-2 bg-dark/70 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-dark transition-all">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div class="flex justify-between mt-2">
                        <button id="cancel-image" class="px-3 py-1.5 text-sm border border-inherit/30 rounded-lg hover:bg-inherit/10 transition-all">å–æ¶ˆ</button>
                        <button id="apply-image" class="px-3 py-1.5 text-sm bg-primary text-white rounded-lg hover:bg-primary/90 transition-all">åº”ç”¨èƒŒæ™¯</button>
                    </div>
                </div>
            </div>
            
            <!-- çº¹ç†é€‰æ‹© -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">èƒŒæ™¯çº¹ç†</label>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="changeBackgroundTexture('none')" class="h-8 rounded-lg bg-white border border-gray-300 hover:border-primary transition-all" title="æ— çº¹ç†"></button>
                    <button onclick="changeBackgroundTexture('grid')" class="h-8 rounded-lg bg-white border border-gray-300 hover:border-primary transition-all bg-grid" title="ç½‘æ ¼çº¹ç†"></button>
                    <button onclick="changeBackgroundTexture('dots')" class="h-8 rounded-lg bg-white border border-gray-300 hover:border-primary transition-all bg-dots" title="ç‚¹çŠ¶çº¹ç†"></button>
                    <button onclick="changeBackgroundTexture('circuit')" class="h-8 rounded-lg bg-white border border-gray-300 hover:border-primary transition-all bg-circuit" title="ç”µè·¯æ¿çº¹ç†"></button>
                </div>
            </div>
            
            <!-- è£…é¥°å¼ºåº¦ -->
            <div>
                <label for="bg-opacity" class="block text-sm font-medium text-gray-700 mb-2">è£…é¥°é€æ˜åº¦</label>
                <input type="range" id="bg-opacity" min="0" max="100" value="70" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="changeBackgroundOpacity(this.value)">
            </div>
            
            <!-- é‡ç½®æŒ‰é’® -->
            <button onclick="resetBackground()" class="w-full py-2 px-4 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all text-gray-700 font-medium flex items-center justify-center gap-2">
                <i class="fa fa-refresh"></i>
                é‡ç½®èƒŒæ™¯
            </button>
        </div>
    </div>
    
    <div class="container mx-auto px-4 py-8 max-w-7xl">
    <script>
        // èƒŒæ™¯æ§åˆ¶åŠŸèƒ½
        const bgPanel = document.getElementById('bg-panel');
        const bgToggleBtn = document.getElementById('bg-toggle-btn');
        
        // åˆ‡æ¢èƒŒæ™¯æ§åˆ¶é¢æ¿æ˜¾ç¤º
        bgToggleBtn.addEventListener('click', () => {
            bgPanel.classList.toggle('hidden');
            // æ·»åŠ æ˜¾ç¤º/éšè—åŠ¨ç”»
            if (!bgPanel.classList.contains('hidden')) {
                bgPanel.style.opacity = '0';
                bgPanel.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    bgPanel.style.opacity = '1';
                    bgPanel.style.transform = 'translateY(0)';
                }, 10);
            } else {
                bgPanel.style.opacity = '0';
                bgPanel.style.transform = 'translateY(20px)';
            }
        });
        
        // ç‚¹å‡»å¤–éƒ¨å…³é—­æ§åˆ¶é¢æ¿
        document.addEventListener('click', (e) => {
            if (!bgPanel.contains(e.target) && e.target !== bgToggleBtn && !bgToggleBtn.contains(e.target)) {
                bgPanel.classList.add('hidden');
            }
        });
        
        // æ”¹å˜èƒŒæ™¯ä¸»é¢˜
        function changeBackgroundTheme(theme) {
            const bgContainer = document.getElementById('background-container');
            
            // ç§»é™¤æ‰€æœ‰ä¸»é¢˜ç±»å’Œè‡ªå®šä¹‰èƒŒæ™¯
            bgContainer.classList.remove('bg-theme-blue', 'bg-theme-purple', 'bg-theme-green', 'bg-theme-pink', 'bg-theme-orange', 'bg-theme-dark');
            bgContainer.style.backgroundImage = '';
            
            // æ·»åŠ é€‰ä¸­çš„ä¸»é¢˜ç±»
            bgContainer.classList.add(`bg-theme-${theme}`);
            
            // æ˜¾ç¤ºè£…é¥°å…ƒç´ å’Œçº¹ç†
            const decorations = document.querySelectorAll('.bg-blob');
            decorations.forEach(dec => dec.style.display = 'block');
            document.getElementById('bg-texture').style.display = 'block';
            
            // æ ¹æ®ä¸»é¢˜è°ƒæ•´ç»ç’ƒæ•ˆæœå’Œæ–‡å­—é¢œè‰²
            const glassElements = document.querySelectorAll('.glass-effect, .glass-effect-dark');
            const texts = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p');
            
            if (theme === 'dark') {
                glassElements.forEach(el => {
                    el.classList.remove('glass-effect');
                    el.classList.add('glass-effect-dark');
                });
                texts.forEach(text => {
                    text.classList.remove('text-dark');
                    text.classList.add('text-white');
                });
            } else {
                glassElements.forEach(el => {
                    el.classList.remove('glass-effect-dark');
                    el.classList.add('glass-effect');
                });
                texts.forEach(text => {
                    text.classList.remove('text-white');
                    text.classList.add('text-dark');
                });
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('bg-theme', theme);
            localStorage.setItem('has-custom-bg', 'false');
            localStorage.removeItem('bg-image');
        }
        
        // æ”¹å˜èƒŒæ™¯çº¹ç†
        function changeBackgroundTexture(texture) {
            const bgTexture = document.getElementById('bg-texture');
            
            // ç§»é™¤æ‰€æœ‰çº¹ç†ç±»
            bgTexture.classList.remove('bg-grid', 'bg-dots', 'bg-circuit');
            
            if (texture !== 'none') {
                bgTexture.classList.add(`bg-${texture}`);
                bgTexture.style.display = 'block';
            } else {
                bgTexture.style.display = 'none';
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('bg-texture', texture);
        }
        
        // æ”¹å˜èƒŒæ™¯è£…é¥°é€æ˜åº¦
        function changeBackgroundOpacity(opacity) {
            const decorations = document.querySelectorAll('.bg-blob');
            const bgTexture = document.getElementById('bg-texture');
            
            decorations.forEach(dec => {
                dec.style.opacity = opacity / 100;
            });
            
            bgTexture.style.opacity = opacity / 100;
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('bg-opacity', opacity);
        }
        
        // é‡ç½®èƒŒæ™¯
        function resetBackground() {
            changeBackgroundTheme('blue');
            changeBackgroundTexture('dots');
            document.getElementById('bg-opacity').value = 70;
            changeBackgroundOpacity(70);
        }
        
        // åˆå§‹åŒ–èƒŒæ™¯è®¾ç½®
        function initBackground() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼
            const savedTheme = localStorage.getItem('bg-theme') || 'blue';
            const savedTexture = localStorage.getItem('bg-texture') || 'dots';
            const savedOpacity = localStorage.getItem('bg-opacity') || 70;
            
            changeBackgroundTheme(savedTheme);
            changeBackgroundTexture(savedTexture);
            document.getElementById('bg-opacity').value = savedOpacity;
            changeBackgroundOpacity(savedOpacity);
            
            // è®¾ç½®é¢æ¿è¿‡æ¸¡åŠ¨ç”»
            bgPanel.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–èƒŒæ™¯
        document.addEventListener('DOMContentLoaded', initBackground);
        
        // é¼ æ ‡ç‚¹å‡»åŠ¨ç”»æ•ˆæœ
        function initCursorEffect() {
            // é˜²æ­¢åŠ¨ç”»åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¿è¡Œï¼Œé¿å…æ€§èƒ½é—®é¢˜
            if (window.innerWidth <= 768) return;
            
            document.addEventListener('click', function(e) {
                // åˆ›å»ºä¸»è¦ç‚¹å‡»æ•ˆæœ
                const effect = document.createElement('div');
                effect.classList.add('cursor-effect');
                effect.style.left = `${e.clientX}px`;
                effect.style.top = `${e.clientY}px`;
                
                // æ ¹æ®èƒŒæ™¯ä¸»é¢˜è°ƒæ•´åŠ¨ç”»é¢œè‰²
                const currentTheme = localStorage.getItem('bg-theme') || 'blue';
                let gradientColors = '';
                
                switch(currentTheme) {
                    case 'purple':
                        gradientColors = 'rgba(139, 92, 246, 0.8) 0%, rgba(168, 85, 247, 0.6) 50%';
                        break;
                    case 'green':
                        gradientColors = 'rgba(16, 185, 129, 0.8) 0%, rgba(34, 197, 94, 0.6) 50%';
                        break;
                    case 'pink':
                        gradientColors = 'rgba(236, 72, 153, 0.8) 0%, rgba(244, 114, 182, 0.6) 50%';
                        break;
                    case 'orange':
                        gradientColors = 'rgba(245, 158, 11, 0.8) 0%, rgba(249, 115, 22, 0.6) 50%';
                        break;
                    case 'dark':
                        gradientColors = 'rgba(96, 165, 250, 0.8) 0%, rgba(59, 130, 246, 0.6) 50%';
                        break;
                    default:
                        gradientColors = 'rgba(59, 130, 246, 0.8) 0%, rgba(139, 92, 246, 0.6) 50%';
                }
                
                effect.style.background = `radial-gradient(circle, ${gradientColors}, transparent 100%)`;
                document.body.appendChild(effect);
                
                // åˆ›å»ºç«èŠ±æ•ˆæœ
                createSparkles(e.clientX, e.clientY, 8);
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    effect.remove();
                }, 600);
            });
        }
        
        // åˆ›å»ºç«èŠ±ç²’å­
        function createSparkles(x, y, count) {
            for (let i = 0; i < count; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('cursor-effect-sparkle');
                
                // éšæœºä½ç½®åç§»
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 20 + 10;
                const offsetX = Math.cos(angle) * distance;
                const offsetY = Math.sin(angle) * distance;
                
                sparkle.style.left = `${x + offsetX}px`;
                sparkle.style.top = `${y + offsetY}px`;
                
                // éšæœºåŠ¨ç”»æŒç»­æ—¶é—´å’Œå»¶è¿Ÿ
                const duration = Math.random() * 0.5 + 0.5;
                const delay = Math.random() * 0.2;
                
                sparkle.style.animation = `sparkleFly ${duration}s ease-out ${delay}s forwards`;
                
                // éšæœºé¢œè‰²
                const colors = ['#ffffff', '#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                sparkle.style.background = randomColor;
                sparkle.style.boxShadow = `0 0 8px 2px ${randomColor}aa`;
                
                document.body.appendChild(sparkle);
                
                setTimeout(() => {
                    sparkle.remove();
                }, (duration + delay) * 1000);
            }
        }
        
        // åˆå§‹åŒ–é¼ æ ‡ç‚¹å‡»æ•ˆæœ
        document.addEventListener('DOMContentLoaded', initCursorEffect);
        
        // åˆå§‹åŒ–å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
        function initImageUpload() {
            const uploadInput = document.getElementById('image-upload');
            const previewContainer = document.getElementById('image-preview-container');
            const imagePreview = document.getElementById('image-preview');
            const uploadArea = document.getElementById('image-upload-area');
            const uploadStatus = document.getElementById('image-upload-status');
            const removeBtn = document.getElementById('remove-image');
            const cancelBtn = document.getElementById('cancel-image');
            const applyBtn = document.getElementById('apply-image');
            
            let uploadedFile = null;
            
            // å¤„ç†æ–‡ä»¶é€‰æ‹©
            uploadInput.addEventListener('change', handleFileSelect);
            
            // å¤„ç†æ‹–æ‹½ä¸Šä¼ 
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('border-primary');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('border-primary');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-primary');
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFile(e.dataTransfer.files[0]);
                }
            });
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadArea.addEventListener('click', () => {
                if (!previewContainer.classList.contains('hidden')) return;
                uploadInput.click();
            });
            
            // ç§»é™¤å›¾ç‰‡
            removeBtn.addEventListener('click', resetImageUpload);
            cancelBtn.addEventListener('click', resetImageUpload);
            
            // åº”ç”¨èƒŒæ™¯å›¾ç‰‡
            applyBtn.addEventListener('click', () => {
                if (uploadedFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // åº”ç”¨èƒŒæ™¯å›¾ç‰‡
                        const bgContainer = document.getElementById('background-container');
                        bgContainer.style.backgroundImage = `url('${e.target.result}')`;
                        bgContainer.style.backgroundSize = 'cover';
                        bgContainer.style.backgroundPosition = 'center';
                        
                        // éšè—è£…é¥°å…ƒç´ 
                        const decorations = document.querySelectorAll('.bg-blob');
                        decorations.forEach(dec => dec.style.display = 'none');
                        
                        // éšè—çº¹ç†
                        document.getElementById('bg-texture').style.display = 'none';
                        
                        // ä¿å­˜è®¾ç½®
                        localStorage.setItem('bg-image', e.target.result);
                        localStorage.setItem('has-custom-bg', 'true');
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        uploadStatus.textContent = 'èƒŒæ™¯å›¾ç‰‡å·²åº”ç”¨ï¼';
                        uploadStatus.style.color = 'rgb(16 185 129)';
                        
                        resetImageUpload();
                    };
                    reader.readAsDataURL(uploadedFile);
                }
            });
            
            function handleFileSelect(e) {
                if (e.target.files && e.target.files[0]) {
                    handleFile(e.target.files[0]);
                }
            }
            
            function handleFile(file) {
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                const validTypes = ['image/jpeg', 'image/png', 'image/webp'];
                if (!validTypes.includes(file.type)) {
                    uploadStatus.textContent = 'ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œè¯·ä¸Šä¼ JPGã€PNGæˆ–WEBPæ ¼å¼';
                    uploadStatus.style.color = 'rgb(239 68 68)';
                    return;
                }
                
                uploadedFile = file;
                
                // æ˜¾ç¤ºé¢„è§ˆ
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                    uploadStatus.textContent = `å·²é€‰æ‹©: ${file.name}`;
                    uploadStatus.style.color = '';
                };
                reader.readAsDataURL(file);
            }
            
            function resetImageUpload() {
                uploadInput.value = '';
                previewContainer.classList.add('hidden');
                imagePreview.src = '';
                uploadedFile = null;
                uploadStatus.textContent = 'æ”¯æŒ JPG, PNG, WEBP æ ¼å¼';
                uploadStatus.style.color = '';
            }
            
            // åˆå§‹åŒ–æ—¶æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„è‡ªå®šä¹‰èƒŒæ™¯
            const hasCustomBg = localStorage.getItem('has-custom-bg') === 'true';
            const savedBgImage = localStorage.getItem('bg-image');
            
            if (hasCustomBg && savedBgImage) {
                const bgContainer = document.getElementById('background-container');
                bgContainer.style.backgroundImage = `url('${savedBgImage}')`;
                bgContainer.style.backgroundSize = 'cover';
                bgContainer.style.backgroundPosition = 'center';
                
                // éšè—è£…é¥°å…ƒç´ å’Œçº¹ç†
                const decorations = document.querySelectorAll('.bg-blob');
                decorations.forEach(dec => dec.style.display = 'none');
                document.getElementById('bg-texture').style.display = 'none';
            }
        }
        
        // åœ¨èƒŒæ™¯åˆå§‹åŒ–ååˆå§‹åŒ–å›¾ç‰‡ä¸Šä¼ 
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾…èƒŒæ™¯åˆå§‹åŒ–å®Œæˆ
            setTimeout(initImageUpload, 100);
        });
    </script>
        
        <header class="mb-8 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-20 h-20 rounded-2xl overflow-hidden glass-effect flex items-center justify-center hover-lift transition-all duration-300 shadow-lg float-slow">
                    <img src="bjbz.png" alt="ç­çº§Logo" class="w-14 h-14 object-contain transition-transform duration-700 hover:scale-110">
                </div>
                <div>
                    <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-gradient mb-2 tracking-tight">åˆä¸€äºŒç­å­¦æƒ…ç»Ÿè®¡</h1>
                    <p id="class-motto" class="text-accent italic text-lg transition-all duration-500 hover:text-indigo-600"></p>
                </div>
            </div>
        </header>

        <div class="glass-effect rounded-2xl shadow-xl overflow-hidden mb-8 hover-lift pulse-card">
            <div class="bg-pattern"></div>
            
            <div class="p-5 flex justify-between items-center border-b border-white/20">
                <div class="flex items-center gap-3">
                    <i class="fa fa-calendar text-primary text-2xl animate-pulse-slow"></i>
                    <h2 id="current-date" class="text-2xl font-semibold text-dark"></h2>
                </div>
                <button id="export-excel" class="gradient-border bg-primary hover:bg-primary/90 text-white px-5 py-2.5 rounded-lg transition-all duration-300 flex items-center gap-2 hover:shadow-lg ripple-effect">
                    <i class="fa fa-download"></i>
                    <span>å¯¼å‡ºExcel</span>
                </button>
            </div>

            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 p-8">
                
                <div class="lg:col-span-1">
                    <div class="glass-effect rounded-xl p-6 h-full hover-lift">
                        <h3 class="text-xl font-semibold mb-5 text-dark flex items-center gap-2">
                            <i class="fa fa-exclamation-circle text-warning"></i>
                            æœªäº¤ä½œä¸šè®°å½•
                        </h3>
                        
                        <div class="space-y-6">
                            
                            <div class="mb-6">
                                <label for="subject-select-btn" class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©ç§‘ç›®</label>
                                <div class="relative">
                                    <button id="subject-select-btn" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300 text-left flex justify-between items-center ripple-effect hover:scale-[1.02] active:scale-[0.98]">
                            <span id="selected-subject-text">è¯·é€‰æ‹©ç§‘ç›®</span>
                            <i class="fa fa-chevron-down text-gray-500 transition-transform duration-300"></i>
                        </button>
                                </div>
                            </div>
                            
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©æœªäº¤ä½œä¸šå­¦ç”Ÿå­¦å·</label>
                                <div id="student-numbers" class="flex flex-wrap gap-2 max-h-64 overflow-y-auto scrollbar-hide p-3 glass-effect border border-white/30 rounded-xl">
                                    
                                </div>
                            </div>
                            
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">å·²é€‰å­¦å·</label>
                                <div id="selected-numbers" class="flex flex-wrap gap-2 p-4 glass-effect border border-white/30 rounded-xl min-h-[80px] transition-all duration-300"></div>
                            </div>
                            
                            
                            <button id="add-homework-record" class="w-full gradient-border bg-secondary hover:bg-secondary/90 text-white py-3 rounded-xl transition-all duration-300 hover:shadow-lg mb-6 ripple-effect hover:scale-[1.02] active:scale-[0.98]">
                                æ·»åŠ æœªäº¤ä½œä¸šè®°å½•
                            </button>
                            
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">å·²è®°å½•åˆ—è¡¨</label>
                                <div id="homework-records" class="space-y-3 max-h-64 overflow-y-auto scrollbar-hide p-3 glass-effect border border-white/30 rounded-xl"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <div class="lg:col-span-2">
                    <div class="glass-effect rounded-xl p-6 h-full hover-lift">
                        <h3 class="text-xl font-semibold mb-5 text-dark flex items-center gap-2">
                            <i class="fa fa-book text-primary animate-pulse-slow"></i>
                            è¯¾ç¨‹è¡¨ç°è¯„åˆ†
                        </h3>
                        
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©æ˜ŸæœŸ</label>
                            <div class="flex flex-wrap gap-3">
                            <button class="day-btn gradient-border bg-primary text-white px-5 py-3 rounded-xl transition-all duration-300 hover:shadow-lg ripple-effect hover:scale-[1.05] active:scale-[0.95]" data-day="å‘¨ä¸€">å‘¨ä¸€</button>
                            <button class="day-btn glass-effect border border-white/30 hover:bg-primary/10 px-5 py-3 rounded-xl transition-all duration-300 ripple-effect hover:scale-[1.05] active:scale-[0.95]" data-day="å‘¨äºŒ">å‘¨äºŒ</button>
                            <button class="day-btn glass-effect border border-white/30 hover:bg-primary/10 px-5 py-3 rounded-xl transition-all duration-300 ripple-effect hover:scale-[1.05] active:scale-[0.95]" data-day="å‘¨ä¸‰">å‘¨ä¸‰</button>
                            <button class="day-btn glass-effect border border-white/30 hover:bg-primary/10 px-5 py-3 rounded-xl transition-all duration-300 ripple-effect hover:scale-[1.05] active:scale-[0.95]" data-day="å‘¨å››">å‘¨å››</button>
                            <button class="day-btn glass-effect border border-white/30 hover:bg-primary/10 px-5 py-3 rounded-xl transition-all duration-300 ripple-effect hover:scale-[1.05] active:scale-[0.95]" data-day="å‘¨äº”">å‘¨äº”</button>
                        </div>
                        </div>
                        
                        
                        <div class="mb-4">
                            <button id="add-new-course" class="gradient-border bg-secondary hover:bg-secondary/90 text-white px-5 py-3 rounded-xl transition-all duration-300 hover:shadow-lg flex items-center gap-2 ripple-effect hover:scale-[1.02] active:scale-[0.98]">
                                <i class="fa fa-plus"></i>
                                <span>æ·»åŠ æ–°è¯¾</span>
                            </button>
                        </div>
                        
                        
                        <div id="schedule-container" class="space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto scrollbar-hide pb-2">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        
        <!-- ä½ çŸ¥é“å—æ ç›® -->
        <div class="glass-effect rounded-2xl shadow-xl overflow-hidden mb-8 hover-lift pulse-card">
            <div class="bg-pattern"></div>
            <div class="p-5 border-b border-white/20 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-dark flex items-center gap-2">
                    <i class="fa fa-lightbulb-o text-warning animate-pulse-slow"></i>
                    ä½ çŸ¥é“å—ï¼Ÿ (æˆ‘ä¸çŸ¥é“)
                </h3>
                <button id="fun-fact-refresh" class="gradient-border bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center gap-2 hover:shadow-lg ripple-effect hover:scale-[1.05] active:scale-[0.95]">
                    <i class="fa fa-refresh"></i>
                    <span>æŸ¥çœ‹æ–°çŸ¥è¯†</span>
                </button>
            </div>
            <div class="p-6">
                <div class="bg-gradient-to-r from-dark/80 to-primary/80 text-white p-8 rounded-xl mb-4 transition-all duration-500 hover:shadow-xl shadow-inner relative overflow-hidden border-2 border-white/20">
                    <!-- è£…é¥°å…ƒç´  -->
                    <div class="absolute top-0 right-0 w-32 h-32 bg-warning/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                    <div class="absolute bottom-0 left-0 w-32 h-32 bg-secondary/20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
                    
                    <!-- å¼ºè°ƒæ–‡å­— -->
                    <p id="fun-fact-content" class="text-xl md:text-2xl font-semibold leading-relaxed relative z-10 tracking-wide bg-clip-text text-transparent bg-gradient-to-r from-white to-white/80 pb-2 border-b border-white/10">
                        <span class="text-warning text-2xl md:text-3xl font-bold">ğŸ’¡</span>
                        ç¯å¢ƒå› ç´ å¯¹å­¦ä¹ æœ‰æ˜¾è‘—å½±å“ï¼Œé€‚å®œçš„æ¸©åº¦(20-22Â°C)å’Œå……è¶³çš„è‡ªç„¶å…‰èƒ½æé«˜å­¦ä¹ æ•ˆç‡ã€‚
                    </p>
                </div>
                <div class="mt-4 text-right flex justify-between items-center">
                    <span class="text-sm text-gray-600 italic">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è·å–æ–°çŸ¥è¯†ï¼Œæˆ–ç­‰å¾…è‡ªåŠ¨åˆ·æ–°</span>
                    <span id="fact-refresh-timer" class="text-sm text-gray-500 flex items-center gap-1">
                        <i class="fa fa-clock-o"></i>
                        <span>ä¸‹æ¬¡åˆ·æ–°: <span id="countdown">60</span>ç§’</span>
                    </span>
                </div>
            </div>
        </div>
        
        <footer class="text-center text-gray-500 text-sm mt-12">
            <p>GlidePlum &copy; 2025 All_lan</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ–å˜é‡
        let currentDay = "å‘¨ä¸€";
        let selectedStudentNumbers = [];
        let scheduleData = {
            "å‘¨ä¸€": Array(8).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
            "å‘¨äºŒ": Array(8).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
            "å‘¨ä¸‰": Array(8).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
            "å‘¨å››": Array(8).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
            "å‘¨äº”": Array(8).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
            "å‘¨å…­": Array(8).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
            "å‘¨æ—¥": Array(8).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] }))
        };
        let homeworkRecords = [];
        
        // ç­çº§é…ç½® - å¯è‡ªå®šä¹‰
        let classConfig = {
            minStudentId: 1,
            maxStudentId: 50,
            excludedIds: [21, 22, 23, 24, 25, 26, 27, 28, 29,30], // æ’é™¤çš„å­¦å·
            subjects: ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "ç”Ÿç‰©", "å†å²", "åœ°ç†", "æ”¿æ²»", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
            gradeSubjects: {
                "åˆä¸€": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                "åˆäºŒ": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                "åˆä¸‰": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"]
            },
            classInfo: {
                name: "åˆä¸€äºŒç­",
                grade: "åˆä¸€",
                motto: "ã€Œæ€€å°‘å¹´æ„æ°”è€Œä¸èºï¼Œå®ˆåˆå¿ƒæœ¬çœŸè€Œä¸è¿‚ï¼›äºæ±‚çŸ¥ä¸­ç ºæœ¬é¢†ï¼Œäºå…±æƒ…ä¸­æš–å½¼æ­¤ã€"
            }
        };
        
        // IndexedDB æ•°æ®åº“
        const DB_NAME = 'slss-database';
        const DB_VERSION = 5; // æ•°æ®åº“ç‰ˆæœ¬å·
        let db = null;
        
        // åˆå§‹åŒ– IndexedDB
        function initDatabase() {
            return new Promise((resolve, reject) => {
                if (db) {
                    resolve(db);
                    return;
                }
                
                try {
                    const request = indexedDB.open(DB_NAME, DB_VERSION);
                    
                    request.onerror = () => {
                        console.error('æ•°æ®åº“æ‰“å¼€å¤±è´¥:', request.error);
                        // å³ä½¿æ•°æ®åº“å¤±è´¥ï¼Œä¹Ÿè¿”å›resolveä»¥ä¾¿åº”ç”¨ç»§ç»­è¿è¡Œ
                        resolve(null);
                    };
                    
                    request.onsuccess = () => {
                        db = request.result;
                        console.log('æ•°æ®åº“æ‰“å¼€æˆåŠŸ');
                        resolve(db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        db = event.target.result;
                        
                        // åˆ›å»ºæˆ–æ›´æ–°è¯¾ç¨‹è¡¨æ•°æ®å­˜å‚¨
                        if (!db.objectStoreNames.contains('schedule')) {
                            db.createObjectStore('schedule', { keyPath: 'day' });
                        }
                        
                        // åˆ›å»ºæˆ–æ›´æ–°ä½œä¸šè®°å½•æ•°æ®å­˜å‚¨
                        if (!db.objectStoreNames.contains('homework')) {
                            const homeworkStore = db.createObjectStore('homework', { keyPath: 'id' });
                            if (!homeworkStore.indexNames.contains('by-date')) {
                                homeworkStore.createIndex('by-date', 'date', { unique: false });
                            }
                            if (!homeworkStore.indexNames.contains('by-subject')) {
                                homeworkStore.createIndex('by-subject', 'subject', { unique: false });
                            }
                        }
                        
                        // åˆ›å»ºæˆ–æ›´æ–°é…ç½®å­˜å‚¨
                        if (!db.objectStoreNames.contains('config')) {
                            const configStore = db.createObjectStore('config', { keyPath: 'id' });
                            // å­˜å‚¨é»˜è®¤é…ç½®
                            configStore.put({ 
                                id: 'class-config', 
                                data: {
                                    minStudentId: 1,
                                    maxStudentId: 50,
                                    excludedIds: [21, 22, 23, 24, 25, 26, 27, 28, 29],
                                    subjects: ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "ç”Ÿç‰©", "å†å²", "åœ°ç†", "æ”¿æ²»", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                                    gradeSubjects: {
                                        "åˆä¸€": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                                        "åˆäºŒ": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                                        "åˆä¸‰": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"]
                                    },
                                    classInfo: {
                                    name: "åˆä¸€äºŒç­",
                                    grade: "åˆä¸€",
                                    motto: "ã€Œæ€€å°‘å¹´æ„æ°”è€Œä¸èºï¼Œå®ˆåˆå¿ƒæœ¬çœŸè€Œä¸è¿‚ï¼›äºæ±‚çŸ¥ä¸­ç ºæœ¬é¢†ï¼Œäºå…±æƒ…ä¸­æš–å½¼æ­¤ã€"
                                }
                                }
                            });
                        }
                    };
                } catch (error) {
                    console.error('æ•°æ®åº“åˆå§‹åŒ–å¼‚å¸¸:', error);
                    resolve(null);
                }
            });
        }
        
        // ä¿å­˜ç­çº§é…ç½®
        function saveClassConfig() {
            if (!db) return;
            
            const transaction = db.transaction(['config'], 'readwrite');
            const store = transaction.objectStore('config');
            store.put({ id: 'class-config', data: classConfig });
            
            transaction.oncomplete = () => {
                console.log('ç­çº§é…ç½®ä¿å­˜æˆåŠŸ');
            };
        }
        
        // åŠ è½½ç­çº§é…ç½®
        function loadClassConfig() {
            return new Promise((resolve) => {
                // ç¡®ä¿gradeSubjectsé…ç½®å§‹ç»ˆå­˜åœ¨
                if (!classConfig.gradeSubjects) {
                    classConfig.gradeSubjects = {
                        "åˆä¸€": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"],
                        "åˆäºŒ": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"],
                        "åˆä¸‰": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"]
                    };
                }
                
                try {
                    if (!db) {
                        // æ•°æ®åº“ä¸å¯ç”¨æ—¶ï¼Œç¡®ä¿å­¦ç§‘åˆ—è¡¨æ­£ç¡®
                        ensureSubjectsBasedOnGrade();
                        resolve(classConfig);
                        return;
                    }
                    
                    const transaction = db.transaction(['config'], 'readonly');
                    const store = transaction.objectStore('config');
                    const request = store.get('class-config');
                    
                    request.onsuccess = () => {
                        if (request.result && request.result.data) {
                            classConfig = request.result.data;
                            // ç¡®ä¿gradeSubjectsé…ç½®å­˜åœ¨
                            if (!classConfig.gradeSubjects) {
                                classConfig.gradeSubjects = {
                                    "åˆä¸€": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"],
                                    "åˆäºŒ": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"],
                                    "åˆä¸‰": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"]
                                };
                            }
                            // ç¡®ä¿å­¦ç§‘åˆ—è¡¨åŸºäºå¹´çº§æ­£ç¡®è®¾ç½®
                            ensureSubjectsBasedOnGrade();
                        } else {
                            // æ²¡æœ‰é…ç½®æ•°æ®æ—¶ï¼Œç¡®ä¿å­¦ç§‘åˆ—è¡¨æ­£ç¡®
                            ensureSubjectsBasedOnGrade();
                        }
                        // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œç­è®­
                document.querySelector('h1').textContent = `${classConfig.classInfo.name}å­¦æƒ…ç»Ÿè®¡`;
                updateClassMotto();
                resolve(classConfig);
                    };
                    
                    request.onerror = () => {
                        console.error('åŠ è½½ç­çº§é…ç½®å¤±è´¥');
                        // å‡ºé”™æ—¶ç¡®ä¿å­¦ç§‘åˆ—è¡¨æ­£ç¡®
                        ensureSubjectsBasedOnGrade();
                        resolve(classConfig);
                    };
                } catch (error) {
                    console.error('åŠ è½½ç­çº§é…ç½®å¼‚å¸¸:', error);
                    // å¼‚å¸¸æ—¶ç¡®ä¿å­¦ç§‘åˆ—è¡¨æ­£ç¡®
                    ensureSubjectsBasedOnGrade();
                    resolve(classConfig);
                }
            });
        }
        
        // ç¡®ä¿å­¦ç§‘åˆ—è¡¨åŸºäºå¹´çº§æ­£ç¡®è®¾ç½®
        function ensureSubjectsBasedOnGrade() {
            const grade = classConfig.classInfo.grade;
            if (!grade) {
                // å¦‚æœæ²¡æœ‰å¹´çº§è®¾ç½®ï¼Œé»˜è®¤ä½¿ç”¨åˆä¸€
                classConfig.classInfo.grade = "åˆä¸€";
                classConfig.subjects = [...classConfig.gradeSubjects["åˆä¸€"]];
            } else if (classConfig.gradeSubjects[grade]) {
                // å¦‚æœæ˜¯é¢„è®¾å¹´çº§ï¼Œå…³è”å¯¹åº”å­¦ç§‘
                classConfig.subjects = [...classConfig.gradeSubjects[grade]];
            } else {
                // è‡ªå®šä¹‰å¹´çº§ä½¿ç”¨é»˜è®¤åŸºç¡€å­¦ç§‘
                classConfig.subjects = ['è¯­æ–‡', 'æ•°å­¦', 'è‹±è¯­'];
            }
        }
        
        // åˆ›å»ºç§‘ç›®é€‰æ‹©æ¨¡æ€æ¡†
        function createSubjectSelectionModal() {
            const modal = document.createElement('div');
            modal.id = 'subject-selection-modal';
            modal.className = 'fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-md p-6">
                    <div class="p-4 border-b border-white/20 mb-4">
                        <h2 class="text-xl font-bold text-dark">é€‰æ‹©ç§‘ç›®</h2>
                    </div>
                    <div class="max-h-80 overflow-y-auto p-2">
                        <div id="subject-options" class="grid grid-cols-2 gap-3">
                            <!-- ç§‘ç›®é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="mt-6">
                        <button id="close-subject-modal" class="w-full px-4 py-3 gradient-border bg-primary hover:bg-primary/90 text-white rounded-xl transition-all duration-300 hover:shadow-lg">
                            å…³é—­
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // æ·»åŠ å…³é—­äº‹ä»¶
            document.getElementById('close-subject-modal').addEventListener('click', function() {
                modal.classList.add('hidden');
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        }
        
        // ç”Ÿæˆç§‘ç›®é€‰æ‹©å™¨
        function generateSubjectSelect() {
            // è¿‡æ»¤æ‰ä¸éœ€è¦çš„ç§‘ç›®ï¼šè‡ªä¹ ã€ç¾æœ¯ã€éŸ³ä¹ã€ç­ä¼šã€å¿ƒç†ã€ä¿¡æ¯ã€ä½“è‚²
            const excludedSubjects = ['è‡ªä¹ ', 'ç¾æœ¯', 'éŸ³ä¹', 'ç­ä¼š', 'å¿ƒç†', 'ä¿¡æ¯', 'ä½“è‚²'];
            const filteredSubjects = classConfig.subjects.filter(subject => 
                !excludedSubjects.includes(subject)
            );
            
            // åˆ›å»ºå¹¶ç»‘å®šç§‘ç›®é€‰æ‹©æ¨¡æ€æ¡†
            if (!document.getElementById('subject-selection-modal')) {
                createSubjectSelectionModal();
            }
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            const optionsContainer = document.getElementById('subject-options');
            optionsContainer.innerHTML = '';
            
            // æ·»åŠ è‡ªå®šä¹‰é€‰é¡¹
            const customOption = document.createElement('button');
            customOption.className = 'subject-option-btn py-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 hover-lift';
            customOption.dataset.subject = 'è‡ªå®šä¹‰';
            customOption.textContent = 'è‡ªå®šä¹‰';
            customOption.addEventListener('click', function() {
                document.getElementById('selected-subject-text').textContent = 'è‡ªå®šä¹‰';
                document.getElementById('subject-selection-modal').classList.add('hidden');
            });
            optionsContainer.appendChild(customOption);
            
            // æ·»åŠ ç§‘ç›®é€‰é¡¹
            filteredSubjects.forEach(subject => {
                const option = document.createElement('button');
                option.className = 'subject-option-btn py-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 hover-lift';
                option.dataset.subject = subject;
                option.textContent = subject;
                option.addEventListener('click', function() {
                    document.getElementById('selected-subject-text').textContent = subject;
                    document.getElementById('subject-selection-modal').classList.add('hidden');
                });
                optionsContainer.appendChild(option);
            });
            
            // ç»‘å®šé€‰æ‹©æŒ‰é’®äº‹ä»¶
            document.getElementById('subject-select-btn').addEventListener('click', function() {
                document.getElementById('subject-selection-modal').classList.remove('hidden');
            });
        }
        
        // æ·»åŠ é…ç½®å’Œå¯¼å…¥åŠŸèƒ½
        function addConfigAndImportFeatures() {
            // æ·»åŠ é…ç½®æŒ‰é’®åˆ°å¤´éƒ¨
            const header = document.querySelector('header');
            const configBtn = document.createElement('button');
            configBtn.id = 'config-btn';
            configBtn.className = 'gradient-border bg-accent hover:bg-accent/90 text-white px-5 py-2.5 rounded-lg transition-all duration-300 flex items-center gap-2 hover:shadow-lg';
            configBtn.innerHTML = '<i class="fa fa-cog"></i><span>é…ç½®</span>';
            header.appendChild(configBtn);
            
            // æ·»åŠ å¯¼å…¥æŒ‰é’®
            const exportBtn = document.getElementById('export-excel');
            const importBtn = document.createElement('button');
            importBtn.id = 'import-data';
            importBtn.className = 'gradient-border bg-secondary hover:bg-secondary/90 text-white px-5 py-2.5 rounded-lg transition-all duration-300 flex items-center gap-2 hover:shadow-lg ml-3';
            importBtn.innerHTML = '<i class="fa fa-upload"></i><span>å¯¼å…¥æ•°æ®</span>';
            exportBtn.parentNode.appendChild(importBtn);
            
            // åˆ›å»ºéšè—çš„æ–‡ä»¶è¾“å…¥
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            fileInput.style.display = 'none';
            fileInput.id = 'file-import';
            document.body.appendChild(fileInput);
            
            // ç»‘å®šå¯¼å…¥æŒ‰é’®äº‹ä»¶
            importBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            // å¤„ç†æ–‡ä»¶å¯¼å…¥
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = async function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // éªŒè¯å¯¼å…¥çš„æ•°æ®ç»“æ„
                        if (importedData.homeworkRecords) {
                            homeworkRecords = importedData.homeworkRecords;
                            displayHomeworkRecords();
                            saveHomeworkRecords();
                        }
                        
                        if (importedData.scheduleData) {
                            scheduleData = importedData.scheduleData;
                            generateSchedule();
                            saveScheduleData();
                        }
                        
                        if (importedData.classConfig) {
                            classConfig = importedData.classConfig;
                            generateSubjectSelect();
                            generateStudentNumberButtons();
                            saveClassConfig();
                            // æ›´æ–°é¡µé¢æ ‡é¢˜
                            document.querySelector('h1').textContent = `${classConfig.classInfo.name}å­¦æƒ…ç»Ÿè®¡`;
                        }
                        
                        showToast('æ•°æ®å¯¼å…¥æˆåŠŸï¼', 'success');
                    } catch (error) {
                        showToast('æ•°æ®å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–å†…å®¹æ— æ•ˆ', 'error');
                    }
                    
                    // é‡ç½®æ–‡ä»¶è¾“å…¥
                    this.value = '';
                };
                reader.readAsText(file);
            });
            
            // ç»‘å®šé…ç½®æŒ‰é’®äº‹ä»¶
            configBtn.addEventListener('click', openConfigModal);
            
            // åˆ›å»ºé…ç½®æ¨¡æ€æ¡†
            createConfigModal();
        }
        
        // åˆ›å»ºé…ç½®æ¨¡æ€æ¡†
        function createConfigModal() {
            const modal = document.createElement('div');
            modal.id = 'config-modal';
            modal.className = 'fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-white/20">
                        <h2 class="text-2xl font-bold text-dark flex items-center gap-2">
                            <i class="fa fa-cog text-accent"></i>
                            ç­çº§é…ç½®
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div>
                            <h3 class="font-medium text-dark mb-3">ç­çº§ä¿¡æ¯</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ç­çº§åç§°</label>
                                    <div class="relative">
                                        <input type="text" id="config-class-name-display" value="${classConfig.classInfo.name}" readonly 
                                            class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300 cursor-pointer bg-white/10">
                                        <button id="open-class-selector" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-primary transition-colors duration-300">
                                            <i class="fa fa-chevron-down"></i>
                                        </button>
                                    </div>
                                    <input type="hidden" id="config-class-name" value="${classConfig.classInfo.name}">
                                    <input type="hidden" id="config-class-grade" value="${classConfig.classInfo.grade || 'åˆä¸€'}">
                                    
                                    <!-- ç­çº§é€‰æ‹©æ¨¡æ€æ¡† -->
                                    <div id="class-selection-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
                                        <div class="glass-effect rounded-2xl w-full max-w-2xl p-6 transform transition-all duration-300 hover:shadow-xl">
                                            <div class="p-4 border-b border-white/20 mb-4">
                                                <h2 class="text-xl font-bold text-dark">é€‰æ‹©ç­çº§</h2>
                                            </div>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                                <div>
                                                    <h3 class="text-dark font-medium mb-3">é€‰æ‹©å¹´çº§</h3>
                                                    <div class="space-y-2 grade-selection">
                                                        <button class="grade-btn w-full p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.grade === 'åˆä¸€' ? 'selected border-primary' : ''}" data-grade="åˆä¸€">åˆä¸€</button>
                                                        <button class="grade-btn w-full p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.grade === 'åˆäºŒ' ? 'selected border-primary' : ''}" data-grade="åˆäºŒ">åˆäºŒ</button>
                                                        <button class="grade-btn w-full p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.grade === 'åˆä¸‰' ? 'selected border-primary' : ''}" data-grade="åˆä¸‰">åˆä¸‰</button>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h3 class="text-dark font-medium mb-3">é€‰æ‹©ç­çº§</h3>
                                                    <div class="grid grid-cols-2 gap-2 class-selection">
                                                        <button class="class-btn p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.name.includes('ä¸€ç­') ? 'selected border-primary' : ''}" data-class="ä¸€ç­">ä¸€ç­</button>
                                                        <button class="class-btn p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.name.includes('äºŒç­') ? 'selected border-primary' : ''}" data-class="äºŒç­">äºŒç­</button>
                                                        <button class="class-btn p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.name.includes('ä¸‰ç­') ? 'selected border-primary' : ''}" data-class="ä¸‰ç­">ä¸‰ç­</button>
                                                        <button class="class-btn p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.name.includes('å››ç­') ? 'selected border-primary' : ''}" data-class="å››ç­">å››ç­</button>
                                                        <button class="class-btn p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.name.includes('äº”ç­') ? 'selected border-primary' : ''}" data-class="äº”ç­">äº”ç­</button>
                                                        <button class="class-btn p-3 glass-effect border border-white/30 rounded-xl hover:bg-primary/10 transition-all duration-300 ${classConfig.classInfo.name.includes('å…­ç­') ? 'selected border-primary' : ''}" data-class="å…­ç­">å…­ç­</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex gap-3">
                                                <button id="class-selection-cancel" class="flex-1 px-4 py-3 glass-effect border border-white/30 rounded-xl hover:bg-gray-200/20 transition-all duration-300">
                                                    å–æ¶ˆ
                                                </button>
                                                <button id="class-selection-confirm" class="flex-1 px-4 py-3 gradient-border bg-primary hover:bg-primary/90 text-white rounded-xl transition-all duration-300 hover:shadow-lg">
                                                    ç¡®è®¤
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å¹´çº§ï¼ˆå°†è‡ªåŠ¨å…³è”å¯¹åº”å­¦ç§‘ï¼‰</label>
                                    <select id="config-grade" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                                        <option value="åˆä¸€" ${classConfig.classInfo.grade === "åˆä¸€" ? 'selected' : ''}>åˆä¸€</option>
                                        <option value="åˆäºŒ" ${classConfig.classInfo.grade === "åˆäºŒ" ? 'selected' : ''}>åˆäºŒ</option>
                                        <option value="åˆä¸‰" ${classConfig.classInfo.grade === "åˆä¸‰" ? 'selected' : ''}>åˆä¸‰</option>
                                        <option value="è‡ªå®šä¹‰" ${!['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰'].includes(classConfig.classInfo.grade) ? 'selected' : ''}>è‡ªå®šä¹‰</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç­è®­</label>
                                <input id="config-class-motto" type="text" value="${classConfig.classInfo.motto || ''}" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" placeholder="è¾“å…¥ç­çº§ç­è®­">
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="font-medium text-dark mb-3">å­¦å·èŒƒå›´</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æœ€å°å­¦å·</label>
                                    <input id="config-min-id" type="number" value="${classConfig.minStudentId}" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æœ€å¤§å­¦å·</label>
                                    <input id="config-max-id" type="number" value="${classConfig.maxStudentId}" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="font-medium text-dark mb-3">æ’é™¤çš„å­¦å·</h3>
                            <input id="config-excluded-ids" type="text" value="${classConfig.excludedIds.join(', ')}" placeholder="ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼š21, 22, 23" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                        </div>
                        

                        
                        <div>
                            <h3 class="font-medium text-dark mb-3">è¯¾ç¨‹è®¾ç½®</h3>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¯å¤©è¯¾ç¨‹èŠ‚æ•°</label>
                            <input id="config-max-sections" type="number" min="1" max="20" value="8" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                        </div>
                        
                        <div>
                            <h3 class="font-medium text-dark mb-3">æ•°æ®ç®¡ç†</h3>
                            <div class="space-y-3">
                                <button id="export-all-data" class="w-full gradient-border bg-primary hover:bg-primary/90 text-white py-3 rounded-xl transition-all duration-300 hover:shadow-lg flex items-center justify-center gap-2">
                                    <i class="fa fa-download"></i>
                                    <span>å¯¼å‡ºæ‰€æœ‰æ•°æ®</span>
                                </button>
                                <button id="reset-all-data" class="w-full gradient-border bg-danger hover:bg-danger/90 text-white py-3 rounded-xl transition-all duration-300 hover:shadow-lg flex items-center justify-center gap-2">
                                    <i class="fa fa-refresh"></i>
                                    <span>é‡ç½®æ‰€æœ‰æ•°æ®</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-white/20 flex justify-end gap-3">
                        <button id="cancel-config" class="px-5 py-2.5 glass-effect border border-white/30 rounded-lg hover:bg-gray-100/50 transition-all duration-300">å–æ¶ˆ</button>
                        <button id="save-config" class="px-5 py-2.5 gradient-border bg-accent hover:bg-accent/90 text-white rounded-lg transition-all duration-300 hover:shadow-lg">ä¿å­˜é…ç½®</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç»‘å®šæ¨¡æ€æ¡†äº‹ä»¶
            document.getElementById('cancel-config').addEventListener('click', closeConfigModal);
            document.getElementById('save-config').addEventListener('click', saveConfigChanges);
            document.getElementById('export-all-data').addEventListener('click', exportAllData);
            document.getElementById('reset-all-data').addEventListener('click', resetAllData);
            
            // ç»‘å®šç­çº§é€‰æ‹©äº‹ä»¶
            const classNameDisplay = document.getElementById('config-class-name-display');
            const openClassSelectorBtn = document.getElementById('open-class-selector');
            
            if (classNameDisplay) {
                classNameDisplay.addEventListener('click', openClassSelectionModal);
            }
            
            if (openClassSelectorBtn) {
                openClassSelectorBtn.addEventListener('click', openClassSelectionModal);
            }
        }
        
        // æ‰“å¼€ç­çº§é€‰æ‹©æ¨¡æ€æ¡†
        function openClassSelectionModal() {
            const modal = document.getElementById('class-selection-modal');
            if (modal) {
                modal.classList.remove('hidden');
                // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
                document.body.style.overflow = 'hidden';
                
                // åˆå§‹åŒ–é€‰ä¸­çŠ¶æ€
                const gradeBtns = modal.querySelectorAll('.grade-btn');
                const classBtns = modal.querySelectorAll('.class-btn');
                
                // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
                gradeBtns.forEach(btn => btn.classList.remove('selected', 'border-primary'));
                classBtns.forEach(btn => btn.classList.remove('selected', 'border-primary'));
                
                // è®¾ç½®å½“å‰é€‰ä¸­çŠ¶æ€
                const currentGrade = document.getElementById('config-class-grade').value || 'åˆä¸€';
                const currentClassName = document.getElementById('config-class-name').value || 'åˆä¸€äºŒç­';
                
                const selectedGradeBtn = modal.querySelector(`.grade-btn[data-grade="${currentGrade}"]`);
                const selectedClassBtn = modal.querySelector(`.class-btn[data-class="${currentClassName.substring(2)}"]`);
                
                if (selectedGradeBtn) selectedGradeBtn.classList.add('selected', 'border-primary');
                if (selectedClassBtn) selectedClassBtn.classList.add('selected', 'border-primary');
                
                // æ·»åŠ å¹´çº§æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                gradeBtns.forEach(btn => {
                    btn.onclick = function() {
                        gradeBtns.forEach(b => b.classList.remove('selected', 'border-primary'));
                        this.classList.add('selected', 'border-primary');
                    };
                });
                
                // æ·»åŠ ç­çº§æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                classBtns.forEach(btn => {
                    btn.onclick = function() {
                        classBtns.forEach(b => b.classList.remove('selected', 'border-primary'));
                        this.classList.add('selected', 'border-primary');
                    };
                });
                
                // ç¡®è®¤æŒ‰é’®äº‹ä»¶
                const confirmBtn = modal.querySelector('#class-selection-confirm');
                confirmBtn.onclick = function() {
                    const selectedGrade = modal.querySelector('.grade-btn.selected')?.dataset.grade || currentGrade;
                    const selectedClass = modal.querySelector('.class-btn.selected')?.dataset.class || currentClassName.substring(2);
                    
                    // æ›´æ–°éšè—è¾“å…¥
                    document.getElementById('config-class-grade').value = selectedGrade;
                    document.getElementById('config-class-name').value = `${selectedGrade}${selectedClass}`;
                    
                    // æ›´æ–°æ˜¾ç¤ºè¾“å…¥
                    document.getElementById('config-class-name-display').value = `${selectedGrade}${selectedClass}`;
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    closeClassSelectionModal();
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast(`å·²é€‰æ‹© ${selectedGrade}${selectedClass}`, 'success');
                };
                
                // å–æ¶ˆæŒ‰é’®äº‹ä»¶
                const cancelBtn = modal.querySelector('#class-selection-cancel');
                cancelBtn.onclick = closeClassSelectionModal;
                
                // ç‚¹å‡»èƒŒæ™¯å…³é—­
                modal.onclick = function(e) {
                    if (e.target === modal) closeClassSelectionModal();
                };
                
                // ESCé”®å…³é—­
                function handleEsc(e) {
                    if (e.key === 'Escape') {
                        closeClassSelectionModal();
                        document.removeEventListener('keydown', handleEsc);
                    }
                }
                document.addEventListener('keydown', handleEsc);
            }
        }
        
        // å…³é—­ç­çº§é€‰æ‹©æ¨¡æ€æ¡†
        function closeClassSelectionModal() {
            const modal = document.getElementById('class-selection-modal');
            if (modal) {
                modal.classList.add('hidden');
                // æ¢å¤èƒŒæ™¯æ»šåŠ¨
                document.body.style.overflow = '';
            }
        }
        
        // æ‰“å¼€é…ç½®æ¨¡æ€æ¡†
        function openConfigModal() {
            document.getElementById('config-modal').classList.remove('hidden');
            // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }
        
        // å…³é—­é…ç½®æ¨¡æ€æ¡†
        function closeConfigModal() {
            document.getElementById('config-modal').classList.add('hidden');
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = '';
        }
        
        // ä¿å­˜é…ç½®æ›´æ”¹
        function saveConfigChanges() {
            try {
                classConfig.classInfo.name = document.getElementById('config-class-name').value || 'ç­çº§';
                classConfig.classInfo.motto = document.getElementById('config-class-motto').value || '';
                const selectedGrade = document.getElementById('config-grade').value;
                
                // å¦‚æœé€‰æ‹©äº†é¢„è®¾å¹´çº§ï¼Œè‡ªåŠ¨å…³è”å¯¹åº”å­¦ç§‘
                if (selectedGrade !== 'è‡ªå®šä¹‰' && classConfig.gradeSubjects[selectedGrade]) {
                    classConfig.classInfo.grade = selectedGrade;
                    classConfig.subjects = [...classConfig.gradeSubjects[selectedGrade]]; // å¤åˆ¶é¢„è®¾å­¦ç§‘åˆ—è¡¨
                } else {
                    classConfig.classInfo.grade = 'è‡ªå®šä¹‰';
                    // å¯¹äºè‡ªå®šä¹‰å¹´çº§ï¼Œä½¿ç”¨é»˜è®¤çš„åŸºç¡€å­¦ç§‘
                    classConfig.subjects = ['è¯­æ–‡', 'æ•°å­¦', 'è‹±è¯­'];
                }
                
                classConfig.minStudentId = parseInt(document.getElementById('config-min-id').value) || 1;
                classConfig.maxStudentId = parseInt(document.getElementById('config-max-id').value) || 50;
                classConfig.maxClassSections = parseInt(document.getElementById('config-max-sections').value) || 8;
                
                // è§£ææ’é™¤çš„å­¦å·
                const excludedIdsStr = document.getElementById('config-excluded-ids').value;
                classConfig.excludedIds = excludedIdsStr ? excludedIdsStr.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id)) : [];
                
                // éªŒè¯è¯¾ç¨‹èŠ‚æ•°
                if (classConfig.maxClassSections < 1 || classConfig.maxClassSections > 20) {
                    showToast('è¯¾ç¨‹èŠ‚æ•°å¿…é¡»åœ¨1-20ä¹‹é—´ï¼', 'warning');
                    return;
                }
                
                // éªŒè¯é…ç½®
                if (classConfig.minStudentId > classConfig.maxStudentId) {
                    showToast('æœ€å°å­¦å·ä¸èƒ½å¤§äºæœ€å¤§å­¦å·ï¼', 'warning');
                    return;
                }
                
                // ä¿å­˜é…ç½®
                saveClassConfig();
                
                // å…³é—­æ¨¡æ€æ¡†
                closeConfigModal();
                
                // æç¤ºç”¨æˆ·å¹¶å‡†å¤‡åˆ·æ–°é¡µé¢
                showToast('é…ç½®ä¿å­˜æˆåŠŸï¼é¡µé¢å°†è‡ªåŠ¨åˆ·æ–°ä»¥åº”ç”¨æ›´æ”¹ã€‚', 'success');
                
                // å»¶è¿Ÿä¸€å°æ®µæ—¶é—´ååˆ·æ–°é¡µé¢ï¼Œç¡®ä¿ç”¨æˆ·èƒ½çœ‹åˆ°æç¤ºä¿¡æ¯
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } catch (error) {
                showToast('é…ç½®ä¿å­˜å¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        // å¯¼å‡ºæ‰€æœ‰æ•°æ®
        function exportAllData() {
            const allData = {
                classConfig: classConfig,
                scheduleData: scheduleData,
                homeworkRecords: homeworkRecords,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `SLSS_æ•°æ®å¯¼å‡º_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // åˆ›å»ºæ¯›ç»ç’ƒé£æ ¼ç¡®è®¤å¯¹è¯æ¡†
        function createGlassConfirmDialog(title, message, onConfirm, onCancel) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å¯¹è¯æ¡†
            const existingDialog = document.querySelector('#glass-confirm-dialog');
            if (existingDialog) existingDialog.remove();
            
            // åˆ›å»ºå¯¹è¯æ¡†å®¹å™¨
            const dialogContainer = document.createElement('div');
            dialogContainer.id = 'glass-confirm-dialog';
            dialogContainer.className = 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4';
            
            // è®¾ç½®å¯¹è¯æ¡†HTMLå†…å®¹
            dialogContainer.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-md overflow-hidden transform transition-all duration-300 hover:shadow-xl">
                    <div class="p-6 border-b border-white/20">
                        <h3 class="text-xl font-bold text-dark">${title}</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-dark/90 mb-6">${message}</p>
                        <div class="flex gap-3">
                            <button id="confirm-cancel" class="flex-1 py-3 rounded-lg border border-gray-300 hover:bg-gray-100 text-dark transition-all duration-300">
                                å–æ¶ˆ
                            </button>
                            <button id="confirm-accept" class="flex-1 py-3 rounded-lg bg-danger hover:bg-danger/90 text-white transition-all duration-300">
                                ç¡®è®¤
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°æ–‡æ¡£
            document.body.appendChild(dialogContainer);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const cancelBtn = dialogContainer.querySelector('#confirm-cancel');
            const acceptBtn = dialogContainer.querySelector('#confirm-accept');
            
            const handleCancel = () => {
                dialogContainer.remove();
                if (onCancel) onCancel();
            };
            
            const handleAccept = () => {
                dialogContainer.remove();
                if (onConfirm) onConfirm();
            };
            
            cancelBtn.addEventListener('click', handleCancel);
            acceptBtn.addEventListener('click', handleAccept);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            dialogContainer.addEventListener('click', (e) => {
                if (e.target === dialogContainer) handleCancel();
            });
            
            // ESCé”®å…³é—­
            document.addEventListener('keydown', function handleEsc(e) {
                if (e.key === 'Escape') {
                    handleCancel();
                    document.removeEventListener('keydown', handleEsc);
                }
            });
        }
        
        // é‡ç½®æ‰€æœ‰æ•°æ®
        function resetAllData() {
            createGlassConfirmDialog(
                'ç¡®è®¤é‡ç½®æ•°æ®',
                'ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼',
                () => {
                    // ç”¨æˆ·ç¡®è®¤åçš„æ“ä½œ
                    // é‡ç½®å†…å­˜ä¸­çš„æ•°æ®
                    const maxSections = classConfig.maxClassSections || 8;
                    scheduleData = {
                        "å‘¨ä¸€": Array(maxSections).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
                        "å‘¨äºŒ": Array(maxSections).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
                        "å‘¨ä¸‰": Array(maxSections).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
                        "å‘¨å››": Array(maxSections).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
                        "å‘¨äº”": Array(maxSections).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
                        "å‘¨å…­": Array(maxSections).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] })),
                        "å‘¨æ—¥": Array(maxSections).fill(null).map((_, i) => ({ id: i + 1, subject: '', rating: 0, notes: '', poorStudents: [] }))
                    };
                    homeworkRecords = [];
                    selectedStudentNumbers = [];
                    
                    // ä½¿ç”¨å•ä¸€äº‹åŠ¡æ¸…é™¤æ‰€æœ‰æ•°æ®åº“æ•°æ®
                    if (db) {
                        try {
                            // ä½¿ç”¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†æ‰€æœ‰å­˜å‚¨å¯¹è±¡çš„æ¸…é™¤
                            const transaction = db.transaction(['schedule', 'homework', 'config'], 'readwrite');
                            
                            // æ¸…é™¤æ‰€æœ‰å­˜å‚¨å¯¹è±¡
                            transaction.objectStore('schedule').clear();
                            transaction.objectStore('homework').clear();
                            transaction.objectStore('config').clear(); // æ¸…é™¤é…ç½®æ•°æ®
                            
                            // äº‹åŠ¡å®Œæˆåæ›´æ–°UIå’Œä¿å­˜é»˜è®¤é…ç½®
                            transaction.oncomplete = () => {
                                console.log('æ‰€æœ‰æ•°æ®åº“æ•°æ®å·²æ¸…é™¤');
                                
                                // é‡ç½®ä¸ºé»˜è®¤ç­çº§é…ç½®
                                classConfig = {
                                    minStudentId: 1,
                                    maxStudentId: 50,
                                    excludedIds: [21, 22, 23, 24, 25, 26, 27, 28, 29, 30],
                                    subjects: ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "ç”Ÿç‰©", "å†å²", "åœ°ç†", "æ”¿æ²»", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                                    gradeSubjects: {
                                        "åˆä¸€": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                                        "åˆäºŒ": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"],
                                        "åˆä¸‰": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯", "éŸ³ä¹", "ç¾æœ¯", "è‡ªä¹ ", "ç­ä¼š"]
                                    },
                                    classInfo: {
                                        name: "åˆä¸€äºŒç­",
                                        grade: "åˆä¸€",
                                        motto: "ã€Œæ€€å°‘å¹´æ„æ°”è€Œä¸èºï¼Œå®ˆåˆå¿ƒæœ¬çœŸè€Œä¸è¿‚ï¼›äºæ±‚çŸ¥ä¸­ç ºæœ¬é¢†ï¼Œäºå…±æƒ…ä¸­æš–å½¼æ­¤ã€"
                                    }
                                };
                                
                                // ä¿å­˜é»˜è®¤é…ç½®
                                saveClassConfig();
                                
                                // æ›´æ–°UI
                                updateUIAfterReset();
                            };
                            
                            transaction.onerror = (event) => {
                                console.error('æ¸…é™¤æ•°æ®åº“æ•°æ®å¤±è´¥:', event.target.error);
                                // å³ä½¿å‡ºé”™ä¹Ÿæ›´æ–°UI
                                updateUIAfterReset();
                            };
                        } catch (error) {
                            console.error('é‡ç½®æ•°æ®åº“æ—¶å‘ç”Ÿå¼‚å¸¸:', error);
                            // å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿæ›´æ–°UI
                            updateUIAfterReset();
                        }
                    } else {
                        // æ•°æ®åº“ä¸å¯ç”¨æ—¶ï¼Œç›´æ¥æ›´æ–°UI
                        updateUIAfterReset();
                    }
                },
                () => {
                    // ç”¨æˆ·å–æ¶ˆåçš„æ“ä½œï¼ˆå¯é€‰ï¼‰
                    console.log('ç”¨æˆ·å–æ¶ˆäº†æ•°æ®é‡ç½®');
                }
            );
        }
        
        // é‡ç½®åæ›´æ–°UIçš„è¾…åŠ©å‡½æ•°
        function updateUIAfterReset() {
            // æ›´æ–°UI
            generateSubjectSelect();
            generateStudentNumberButtons();
            generateSchedule();
            displayHomeworkRecords();
            updateSelectedNumbersDisplay();
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œç­è®­
            document.querySelector('h1').textContent = `${classConfig.classInfo.name}å­¦æƒ…ç»Ÿè®¡`;
            updateClassMotto();
            
            // ä½¿ç”¨Toastæç¤ºæ›¿ä»£alert
            showToast('æ‰€æœ‰æ•°æ®å·²é‡ç½®ï¼', 'success');
        }
        
        // ä¿å­˜è¯¾ç¨‹è¡¨æ•°æ®åˆ° IndexedDB
        function saveScheduleData() {
            // æ•°æ®åº“æœªåˆå§‹åŒ–æ£€æŸ¥
            if (!db) {
                console.warn('æ•°æ®åº“æœªåˆå§‹åŒ–ï¼Œæ— æ³•ä¿å­˜æ•°æ®');
                showToast('æ•°æ®ä¿å­˜å¤±è´¥ï¼šæ•°æ®åº“æœªåˆå§‹åŒ–', 'warning');
                return;
            }
            
            try {
                // éªŒè¯ scheduleData æ˜¯å¦ä¸ºæœ‰æ•ˆå¯¹è±¡
                if (!scheduleData || typeof scheduleData !== 'object') {
                    console.error('scheduleData ä¸æ˜¯æœ‰æ•ˆçš„æ•°æ®å¯¹è±¡');
                    showToast('æ•°æ®ä¿å­˜å¤±è´¥ï¼šæ•°æ®æ ¼å¼é”™è¯¯', 'error');
                    return;
                }
                
                console.log('å¼€å§‹ä¿å­˜è¯¾ç¨‹è¡¨æ•°æ®');
                
                // åˆ›å»ºäº‹åŠ¡
                const transaction = db.transaction(['schedule'], 'readwrite');
                const store = transaction.objectStore('schedule');
                
                // å…ˆæ¸…ç©ºç°æœ‰æ•°æ®
                const clearRequest = store.clear();
                
                clearRequest.onsuccess = () => {
                    console.log('å·²æ¸…ç©ºç°æœ‰æ•°æ®');
                    
                    // æ”¶é›†è¦ä¿å­˜çš„æ•°æ®é¡¹
                    const daysToSave = Object.keys(scheduleData).filter(dayKey => 
                        dayKey && typeof dayKey === 'string' && dayKey.trim() !== ''
                    );
                    
                    if (daysToSave.length === 0) {
                        console.log('æ²¡æœ‰æœ‰æ•ˆæ•°æ®éœ€è¦ä¿å­˜');
                        return;
                    }
                    
                    // ä½¿ç”¨ Promise.all å¤„ç†æ‰€æœ‰ä¿å­˜æ“ä½œ
                    const savePromises = daysToSave.map(dayKey => {
                        return new Promise((resolve, reject) => {
                            // åˆ›å»ºæ ‡å‡†åŒ–çš„æ•°æ®å¯¹è±¡
                            const dataObject = {
                                day: String(dayKey).trim(), // å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶å»é™¤ç©ºç™½
                                courses: Array.isArray(scheduleData[dayKey]) ? 
                                    scheduleData[dayKey] : []
                            };
                            
                            console.log('ä¿å­˜å¯¹è±¡:', dataObject);
                            
                            // æ‰§è¡Œ put æ“ä½œ
                            const putRequest = store.put(dataObject);
                            putRequest.onsuccess = () => {
                                console.log(`æˆåŠŸä¿å­˜: ${dayKey}`);
                                resolve();
                            };
                            putRequest.onerror = (event) => {
                                console.error(`ä¿å­˜å¤±è´¥ [${dayKey}]:`, event.target.error);
                                reject(event.target.error);
                            };
                        });
                    });
                    
                    // ç­‰å¾…æ‰€æœ‰ä¿å­˜å®Œæˆ
                    Promise.allSettled(savePromises).then(results => {
                        const successful = results.filter(r => r.status === 'fulfilled').length;
                        const failed = results.filter(r => r.status === 'rejected').length;
                        
                        console.log(`ä¿å­˜æ“ä½œå®Œæˆ: æˆåŠŸ ${successful}, å¤±è´¥ ${failed}`);
                        
                        if (failed === 0) {
                            showToast('æ•°æ®ä¿å­˜æˆåŠŸ', 'success');
                        } else if (successful > 0) {
                            showToast(`éƒ¨åˆ†æ•°æ®ä¿å­˜æˆåŠŸ (${successful}/${daysToSave.length})`, 'info');
                        } else {
                            showToast('æ‰€æœ‰æ•°æ®ä¿å­˜å¤±è´¥', 'error');
                        }
                    });
                };
                
                clearRequest.onerror = (event) => {
                    console.error('æ¸…ç©ºæ•°æ®å¤±è´¥:', event.target.error);
                    showToast('æ•°æ®ä¿å­˜å¤±è´¥ï¼šæ— æ³•æ¸…ç©ºæ—§æ•°æ®', 'error');
                };
                
                transaction.onerror = (event) => {
                    console.error('äº‹åŠ¡å¤±è´¥:', event.target.error);
                };
                
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®å¼‚å¸¸:', error);
                showToast('æ•°æ®ä¿å­˜å¼‚å¸¸ï¼Œè¯·é‡è¯•', 'error');
            }
        }
        
        // ä» IndexedDB åŠ è½½è¯¾ç¨‹è¡¨æ•°æ®
        function loadScheduleData() {
            return new Promise((resolve, reject) => {
                if (!db) {
                    resolve(scheduleData);
                    return;
                }
                
                const transaction = db.transaction(['schedule'], 'readonly');
                const store = transaction.objectStore('schedule');
                const allRequest = store.getAll();
                
                allRequest.onsuccess = () => {
                    const data = allRequest.result;
                    if (data.length > 0) {
                        data.forEach(item => {
                            if (scheduleData.hasOwnProperty(item.day)) {
                                scheduleData[item.day] = item.courses || [];
                            }
                        });
                    }
                    resolve(scheduleData);
                };
                
                allRequest.onerror = () => {
                    console.error('åŠ è½½è¯¾ç¨‹è¡¨æ•°æ®å¤±è´¥');
                    resolve(scheduleData);
                };
            });
        }
        
        // ä¿å­˜ä½œä¸šè®°å½•åˆ° IndexedDB
        function saveHomeworkRecords() {
            if (!db) return;
            
            const transaction = db.transaction(['homework'], 'readwrite');
            const store = transaction.objectStore('homework');
            
            homeworkRecords.forEach(record => {
                store.put(record);
            });
            
            transaction.oncomplete = () => {
                console.log('ä½œä¸šè®°å½•ä¿å­˜æˆåŠŸ');
            };
            
            transaction.onerror = () => {
                console.error('ä½œä¸šè®°å½•ä¿å­˜å¤±è´¥');
            };
        }
        
        // ä» IndexedDB åŠ è½½ä½œä¸šè®°å½•
        function loadHomeworkRecords() {
            return new Promise((resolve, reject) => {
                if (!db) {
                    resolve(homeworkRecords);
                    return;
                }
                
                const transaction = db.transaction(['homework'], 'readonly');
                const store = transaction.objectStore('homework');
                const allRequest = store.getAll();
                
                allRequest.onsuccess = () => {
                    homeworkRecords = allRequest.result;
                    resolve(homeworkRecords);
                };
                
                allRequest.onerror = () => {
                    console.error('åŠ è½½ä½œä¸šè®°å½•å¤±è´¥');
                    resolve(homeworkRecords);
                };
            });
        }
        
        // åˆ›å»ºå¹¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoader() {
            // æ£€æŸ¥åŠ è½½å™¨æ˜¯å¦å·²å­˜åœ¨
            let loader = document.getElementById('page-loader');
            if (!loader) {
                loader = document.createElement('div');
                loader.id = 'page-loader';
                loader.className = 'fixed inset-0 bg-black/70 z-50 flex items-center justify-center';
                loader.innerHTML = `
                    <div class="glass-effect p-8 rounded-2xl flex flex-col items-center">
                        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-primary mb-4"></div>
                        <p id="loader-text" class="text-white text-lg">åŠ è½½ä¸­...</p>
                    </div>
                `;
                document.body.appendChild(loader);
            }
            loader.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        // éšè—åŠ è½½åŠ¨ç”»
        function hideLoader() {
            const loader = document.getElementById('page-loader');
            if (loader) {
                loader.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        // æ›´æ–°åŠ è½½åŠ¨ç”»æ–‡æœ¬
        function updateLoaderText(text) {
            const loaderText = document.getElementById('loader-text');
            if (loaderText) {
                loaderText.textContent = text;
            }
        }
        
        // åˆ›å»ºå…¬å‘Šå¼¹çª—
        function createAnnouncementModal() {
            const modal = document.createElement('div');
            modal.id = 'announcement-modal';
            modal.className = 'fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-white/20 flex justify-between items-center">
                        <h3 class="text-2xl font-bold text-dark flex items-center gap-2">
                            <i class="fa fa-bullhorn text-accent"></i>
                            <span>å…¬å‘Š</span>
                        </h3>
                        <div id="announcement-timer" class="text-accent font-semibold">5ç§’åå…³é—­</div>
                    </div>
                    <div class="p-8">
                        <div class="prose max-w-none text-dark">
                            <h4 class="text-xl font-semibold mb-4 text-gradient">ç‚¹å‡»æˆ‘å·²é˜…è¯»ä»£è¡¨æ‚¨çŸ¥æ™“å¹¶åŒæ„</h4>
                            <p class="mb-4">æœ¬é¡¹ç›®é‡‡ç”¨MITå¼€æºè®¸å¯åè®®äºGithubå‘å¸ƒ:</p>
                            <ul class="list-disc pl-6 mb-4 space-y-2">
                                <li>æ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨ã€å¤åˆ¶ã€ä¿®æ”¹ã€åˆå¹¶ã€å‘å¸ƒæœ¬è½¯ä»¶</li>
                                <li>æ‚¨å¯ä»¥å°†æœ¬è½¯ä»¶ç”¨äºå•†ä¸šç›®çš„</li>
                                <li>ä½¿ç”¨æœ¬è½¯ä»¶æ—¶éœ€ä¿ç•™åŸå§‹è®¸å¯è¯å£°æ˜</li>
                                <li>æ‚¨å¯äºGithub/DL1447/SLSSä¸­è·å–æ–°ç‰ˆæœ¬</li>
                                <li>å­¦å·é€‰æ‹©ç³»ç»Ÿä¸ºäº†é€‚é…ä½œè€…æ‰€åœ¨ç­çº§ é»˜è®¤æ’é™¤20-30 è¯·äºé…ç½®ä¸­æ‰‹åŠ¨æ›´æ”¹</li>
                                <li>äºŒç­ On Tooooooooop</li>
                            </ul>
                            <p class="text-sm text-gray-600 italic">Â© 2025 All_lan | MIT License | SLSS</p>
                        </div>
                    </div>
                    <div class="p-6 border-t border-white/20 flex justify-end">
                        <button id="close-announcement" class="px-6 py-2.5 gradient-border bg-accent hover:bg-accent/90 text-white rounded-lg transition-all duration-300 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-check"></i>
                            <span>æˆ‘å·²é˜…è¯»</span>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // å€’è®¡æ—¶å…³é—­åŠŸèƒ½
            const closeButton = document.getElementById('close-announcement');
            const timerElement = document.getElementById('announcement-timer');
            let seconds = 5;
            
            closeButton.disabled = true;
            
            const countdownInterval = setInterval(() => {
                seconds--;
                timerElement.textContent = `${seconds}ç§’åå…³é—­`;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    closeButton.disabled = false;
                    timerElement.textContent = 'ç‚¹å‡»"æˆ‘å·²é˜…è¯»"å…³é—­';
                }
            }, 1000);
            
            // ç»‘å®šå…³é—­æŒ‰é’®äº‹ä»¶
            closeButton.addEventListener('click', () => {
                modal.style.display = 'none';
            });
        }
        
        // æ˜¾ç¤ºå…¬å‘Š
        function showAnnouncement() {
            // è·å–å¹¶æ›´æ–°è®¿é—®æ¬¡æ•°
            let visitCount = localStorage.getItem('visitCount');
            visitCount = visitCount ? parseInt(visitCount) + 1 : 1;
            localStorage.setItem('visitCount', visitCount.toString());
            
            // æ¯5æ¬¡è®¿é—®æ˜¾ç¤ºä¸€æ¬¡å…¬å‘Š
            if (visitCount % 5 === 0) {
                createAnnouncementModal();
            }
        }
        
        // Toastæç¤ºåŠŸèƒ½ - æ”¯æŒå¤šé€šçŸ¥å †å æ˜¾ç¤º
        let activeToasts = [];
        
        function showToast(message, type = 'info') {
            // ç¡®ä¿Toastæ ·å¼å·²æ·»åŠ 
            if (!document.querySelector('#toast-styles')) {
                const style = document.createElement('style');
                style.id = 'toast-styles';
                style.textContent = `
                    .toast-notification {
                        opacity: 0;
                        transform: translateX(-50%) translateY(20px);
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                        font-weight: 500;
                        border: 2px solid rgba(255, 255, 255, 0.3);
                        animation: toastSlideIn 0.3s ease-out forwards;
                        min-width: 200px;
                        text-align: center;
                        transition: all 0.3s ease;
                    }
                    
                    .toast-notification.opacity-100 {
                        opacity: 1;
                        transform: translateX(-50%) translateY(0);
                    }
                    
                    .toast-notification.opacity-0 {
                        opacity: 0;
                        transform: translateX(-50%) translateY(20px);
                    }
                    
                    @keyframes toastSlideIn {
                        from {
                            opacity: 0;
                            transform: translateX(-50%) translateY(20px);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(-50%) translateY(0);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            const toast = document.createElement('div');
            // ç§»é™¤glass-effectï¼Œä½¿ç”¨ä¸é€æ˜çš„çº¯è‰²èƒŒæ™¯ä»¥æé«˜å¯¹æ¯”åº¦
            toast.className = `toast-notification fixed left-1/2 transform -translate-x-1/2 rounded-xl px-6 py-4 text-white z-50 transition-all duration-300 shadow-lg ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-primary'}`;
            toast.textContent = message;
            
            // æ·»åŠ åˆ°æ–‡æ¡£å’Œæ´»åŠ¨é€šçŸ¥åˆ—è¡¨
            document.body.appendChild(toast);
            activeToasts.push(toast);
            
            // æ›´æ–°æ‰€æœ‰é€šçŸ¥çš„ä½ç½®
            updateToastPositions();
            
            // æ˜¾ç¤ºåŠ¨ç”»å·²é€šè¿‡CSSå®ç°
            setTimeout(() => {
                toast.classList.add('opacity-100');
            }, 10);
            
            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                closeToast(toast);
            }, 3000);
        }
        
        // å…³é—­å•ä¸ªé€šçŸ¥å¹¶æ›´æ–°å…¶ä»–é€šçŸ¥çš„ä½ç½®
        function closeToast(toast) {
            toast.classList.add('opacity-0');
            
            setTimeout(() => {
                // ä»DOMå’Œæ´»åŠ¨åˆ—è¡¨ä¸­ç§»é™¤
                toast.remove();
                
                const index = activeToasts.indexOf(toast);
                if (index !== -1) {
                    activeToasts.splice(index, 1);
                }
                
                // æ›´æ–°å‰©ä½™é€šçŸ¥çš„ä½ç½®
                updateToastPositions();
            }, 300);
        }
        
        // æ›´æ–°æ‰€æœ‰é€šçŸ¥çš„ä½ç½®ï¼Œå®ç°å †å æ•ˆæœ
        function updateToastPositions() {
            activeToasts.forEach((toast, index) => {
                // ä»ä¸‹å¾€ä¸Šå †å ï¼Œç¬¬ä¸€ä¸ªé€šçŸ¥åœ¨æœ€åº•éƒ¨
                const bottomPosition = 12 + (index * 70); // 12remåº•éƒ¨è¾¹è·ï¼Œæ¯ä¸ªé€šçŸ¥ä¹‹é—´70pxé—´éš”
                toast.style.bottom = bottomPosition + 'px';
            });
        }
        
        // æœ‰è¶£çš„äº‹å®æ•°æ® - ä¼˜åŒ–ç‰ˆï¼ˆç§»é™¤é‡å¤å†…å®¹å¹¶æ‰©å……æ–°çŸ¥è¯†ï¼‰
        const funFacts = [
            // å­¦ä¹ ç§‘å­¦ä¸è®¤çŸ¥
            "ç ”ç©¶è¡¨æ˜ï¼Œè€å¸ˆçš„åé¦ˆå¯¹å­¦ç”Ÿçš„å­¦ä¹ æˆç»©æœ‰æ˜¾è‘—å½±å“ï¼ŒåŠæ—¶ä¸”å…·ä½“çš„åé¦ˆå¯æé«˜å­¦ä¹ æ•ˆç‡è¾¾40%ã€‚",
            "åœ¨è¯¾å ‚ä¸Šä½¿ç”¨ç§¯æçš„è¯­è¨€å¯ä»¥æé«˜å­¦ç”Ÿå‚ä¸åº¦ï¼Œå‡å°‘è¯¾å ‚è¡Œä¸ºé—®é¢˜ã€‚",
            "è®°å½•å­¦ç”Ÿè¡¨ç°æ˜¯æ•™å¸ˆä¸“ä¸šå‘å±•çš„é‡è¦éƒ¨åˆ†ï¼Œæœ‰åŠ©äºä¸ªæ€§åŒ–æ•™å­¦è°ƒæ•´ã€‚",
            "æ•°æ®æ˜¾ç¤ºï¼ŒåŠæ—¶çš„è¯¾åå¤ä¹ å¯ä»¥å°†è®°å¿†ä¿ç•™ç‡æé«˜30%ï¼Œè€Œå»¶è¿Ÿä¸€å¤©å¤ä¹ æ•ˆæœä¼šæ˜¾è‘—ä¸‹é™ã€‚",
            "æ•™å­¦åæ€æœ‰åŠ©äºæé«˜æ•™å¸ˆçš„æ•™å­¦æ•ˆæœï¼Œç‰¹åˆ«æ˜¯ç»“åˆå­¦ç”Ÿåé¦ˆçš„åæ€ã€‚",
            "æ¯ä¸ªå­¦ç”Ÿçš„å­¦ä¹ èŠ‚å¥éƒ½æ˜¯ç‹¬ç‰¹çš„ï¼Œè§†è§‰å‹å­¦ä¹ è€…çº¦å 65%ï¼Œå¬è§‰å‹çº¦å 30%ï¼ŒåŠ¨è§‰å‹çº¦å 5%ã€‚",
            "é¼“åŠ±å­¦ç”Ÿæé—®å¯ä»¥åŸ¹å…»æ‰¹åˆ¤æ€§æ€ç»´èƒ½åŠ›ï¼Œæé—®è¿‡ç¨‹æœ¬èº«å°±æ˜¯æ·±åº¦æ€è€ƒçš„ä½“ç°ã€‚",
            "è‰¯å¥½çš„å­¦ä¹ ç¯å¢ƒå¯ä»¥æé«˜æ³¨æ„åŠ›é›†ä¸­åº¦ï¼Œç ”ç©¶å‘ç°æ•´æ´ç¯å¢ƒèƒ½æé«˜ä¸“æ³¨åŠ›è¾¾25%ã€‚",
            "å®šæœŸè¯„ä¼°æ˜¯äº†è§£å­¦ç”Ÿå­¦ä¹ æƒ…å†µçš„æœ‰æ•ˆé€”å¾„ï¼Œå½¢æˆæ€§è¯„ä¼°æ¯”æ€»ç»“æ€§è¯„ä¼°æ›´æœ‰åŠ©äºå­¦ä¹ ã€‚",
            "ä¸ªæ€§åŒ–çš„å­¦ä¹ è®¡åˆ’æœ‰åŠ©äºå­¦ç”Ÿå‘æŒ¥æ½œåŠ›ï¼Œé€‚åº”ä¸åŒå­¦ä¹ é£æ ¼çš„æ•™å­¦å¯æé«˜å­¦ä¹ æ•ˆæœã€‚",
            
            // è®°å¿†ä¸å­¦ä¹ æŠ€å·§
            "äº’åŠ¨æ•™å­¦æ¯”å•å‘è®²æˆæ›´èƒ½æé«˜å­¦ä¹ æ•ˆæœï¼Œå­¦ç”Ÿå‚ä¸åº¦ä¸çŸ¥è¯†ä¿ç•™ç‡æ­£ç›¸å…³ã€‚",
            "å­¦ç”Ÿçš„è‡ªä¿¡å¿ƒå¯¹å­¦ä¹ æˆç»©æœ‰é‡è¦å½±å“ï¼Œæˆé•¿å‹æ€ç»´æ¨¡å¼çš„å­¦ç”Ÿæ›´å®¹æ˜“é¢å¯¹æŒ‘æˆ˜ã€‚",
            "æ€ç»´å¯¼å›¾æ˜¯ç»„ç»‡çŸ¥è¯†ç‚¹çš„æœ‰æ•ˆå·¥å…·ï¼Œèƒ½å°†è®°å¿†æ•ˆç‡æé«˜çº¦25%ã€‚",
            "åŠæ—¶çº æ­£é”™è¯¯æ¯”åå¤ç»ƒä¹ æ›´é‡è¦ï¼Œè¯†åˆ«é”™è¯¯æ¨¡å¼æ˜¯æ·±åº¦å­¦ä¹ çš„å…³é”®ã€‚",
            "é¼“åŠ±åˆä½œå­¦ä¹ å¯ä»¥åŸ¹å…»å›¢é˜Ÿç²¾ç¥ï¼ŒåŒä¼´æ•™å­¦æ•ˆåº”å¯åŒæ—¶æå‡åŒæ–¹çš„å­¦ä¹ æ•ˆæœã€‚",
            "å­¦ä¹ æ–°æŠ€èƒ½æ—¶ï¼ŒçŸ­æ—¶é—´ã€é«˜é¢‘ç‡çš„ç»ƒä¹ æ¯”é•¿æ—¶é—´ã€ä½é¢‘ç‡çš„ç»ƒä¹ æ›´æœ‰æ•ˆï¼Œè¿™è¢«ç§°ä¸ºåˆ†æ•£å­¦ä¹ æ•ˆåº”ã€‚",
            "æƒ…ç»ªçŠ¶æ€ä¼šç›´æ¥å½±å“è®°å¿†å’Œå­¦ä¹ æ•ˆæœï¼Œé€‚åº¦çš„ç§¯ææƒ…ç»ªèƒ½æé«˜è®°å¿†ç¼–ç æ•ˆç‡ã€‚",
            "æ•™æˆä»–äººæ˜¯å·©å›ºçŸ¥è¯†çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€ï¼Œè¿™ç§å­¦ä¹ æ–¹æ³•è¢«ç§°ä¸º'è´¹æ›¼å­¦ä¹ æ³•'ï¼Œå¯å°†çŸ¥è¯†ä¿ç•™ç‡æé«˜åˆ°90%ã€‚",
            "è§†è§‰è¾…åŠ©å·¥å…·å¯ä»¥æé«˜ä¿¡æ¯è®°å¿†æ•ˆç‡é«˜è¾¾65%ï¼Œå›¾æ–‡ç»“åˆçš„å­¦ä¹ ææ–™æ•ˆæœæœ€ä½³ã€‚",
            "å­¦ä¹ è¿‡ç¨‹ä¸­çš„é€‚å½“ä¼‘æ¯æœ‰åŠ©äºçŸ¥è¯†çš„å·©å›ºå’Œæ•´åˆï¼Œç•ªèŒ„å·¥ä½œæ³•(25åˆ†é’Ÿå­¦ä¹ +5åˆ†é’Ÿä¼‘æ¯)è¢«è¯æ˜éå¸¸æœ‰æ•ˆã€‚",
            
            // å­¦ä¹ ç­–ç•¥
            "è®¾ç½®æ˜ç¡®çš„å­¦ä¹ ç›®æ ‡å¯ä»¥æé«˜å­¦ä¹ åŠ¨åŠ›å’Œæ•ˆç‡ï¼ŒSMARTç›®æ ‡(å…·ä½“ã€å¯è¡¡é‡ã€å¯å®ç°ã€ç›¸å…³æ€§ã€æ—¶é™)ç‰¹åˆ«æœ‰æ•ˆã€‚",
            "å°†å­¦ä¹ å†…å®¹ä¸ä¸ªäººç»éªŒè”ç³»èµ·æ¥å¯ä»¥å¢å¼ºè®°å¿†ï¼Œè¿™åœ¨è®¤çŸ¥å¿ƒç†å­¦ä¸­ç§°ä¸º'ç¼–ç ç‰¹å¼‚æ€§åŸåˆ™'ã€‚",
            "å¤šæ ·åŒ–çš„æ•™å­¦æ–¹æ³•å¯ä»¥æ»¡è¶³ä¸åŒå­¦ä¹ è€…çš„éœ€æ±‚ï¼Œå¤šæ„Ÿå®˜å­¦ä¹ èƒ½æ¿€æ´»å¤§è„‘å¤šä¸ªåŒºåŸŸï¼ŒåŠ æ·±è®°å¿†ã€‚",
            "æ­£é¢å¼ºåŒ–æ¯”è´Ÿé¢æ‰¹è¯„æ›´èƒ½ä¿ƒè¿›å­¦ç”Ÿçš„è¿›æ­¥ï¼Œç§¯æåé¦ˆèƒ½å¢å¼ºå­¦ä¹ åŠ¨æœºå’Œè‡ªä¿¡å¿ƒã€‚",
            "åŸ¹å…»æˆé•¿å‹æ€ç»´æ¨¡å¼æœ‰åŠ©äºå­¦ç”Ÿåº”å¯¹å­¦ä¹ æŒ‘æˆ˜ï¼Œç›¸ä¿¡èƒ½åŠ›å¯ä»¥é€šè¿‡åŠªåŠ›æå‡çš„å­¦ç”Ÿæ›´å®¹æ˜“å–å¾—è¿›æ­¥ã€‚",
            "å­¦ä¹ ç¯å¢ƒä¸­çš„èƒŒæ™¯éŸ³ä¹å¯ä»¥æé«˜æŸäº›ç±»å‹ä»»åŠ¡çš„æ•ˆç‡ï¼Œå·´æ´›å…‹éŸ³ä¹(60BPM)æœ‰åŠ©äºæé«˜ä¸“æ³¨åŠ›ã€‚",
            "æ‰‹å†™ç¬”è®°æ¯”æ‰“å­—ç¬”è®°æ›´æœ‰åŠ©äºä¿¡æ¯çš„ç†è§£å’Œè®°å¿†ï¼Œå› ä¸ºæ‰‹å†™è¿‡ç¨‹éœ€è¦æ›´å¤šçš„è®¤çŸ¥å‚ä¸ã€‚",
            "å®è·µåº”ç”¨æ˜¯å°†ç†è®ºçŸ¥è¯†è½¬åŒ–ä¸ºæŠ€èƒ½çš„å…³é”®æ­¥éª¤ï¼Œåœ¨ä¸åŒæƒ…å¢ƒä¸­åº”ç”¨çŸ¥è¯†èƒ½å¢å¼ºçŸ¥è¯†è¿ç§»èƒ½åŠ›ã€‚",
            "å®šæœŸå›é¡¾å·²å­¦çŸ¥è¯†å¯ä»¥é˜²æ­¢é—å¿˜ï¼Œæ ¹æ®è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ï¼ŒåŠæ—¶å¤ä¹ èƒ½æœ‰æ•ˆå‡ç¼“é—å¿˜é€Ÿåº¦ã€‚",
            "åŸ¹å…»å­¦ç”Ÿçš„åˆ›é€ åŠ›æ¯”å•çº¯ä¼ æˆçŸ¥è¯†æ›´é‡è¦ï¼Œå‘æ•£æ€ç»´è®­ç»ƒèƒ½æé«˜é—®é¢˜è§£å†³èƒ½åŠ›ã€‚",
            
            // å­¦ä¹ å¿ƒç†ä¸ä¹ æƒ¯
            "å­¦ç”Ÿä¹‹é—´çš„åŒä¼´å­¦ä¹ å¯ä»¥ç›¸äº’ä¿ƒè¿›æˆé•¿ï¼ŒåŒä¼´åé¦ˆæä¾›äº†ä¸åŒçš„è§†è§’å’Œæ€è€ƒæ–¹å¼ã€‚",
            "åˆç†å®‰æ’å­¦ä¹ æ—¶é—´å¯ä»¥é¿å…è®¤çŸ¥ç–²åŠ³ï¼Œç ”ç©¶è¡¨æ˜è¿ç»­å­¦ä¹ è¶…è¿‡90åˆ†é’Ÿæ•ˆç‡ä¼šæ˜¾è‘—ä¸‹é™ã€‚",
            "ç»™äºˆå…·ä½“ã€å»ºè®¾æ€§çš„åé¦ˆæ¯”ç¬¼ç»Ÿè¯„ä»·æ›´æœ‰ä»·å€¼ï¼Œæ˜ç¡®æŒ‡å‡ºä¼˜ç‚¹å’Œæ”¹è¿›æ–¹å‘çš„åé¦ˆæ•ˆæœæœ€ä½³ã€‚",
            "å»ºç«‹å­¦ä¹ ä¹ æƒ¯æ¯”ä¸´æ—¶çªå‡»å­¦ä¹ æ›´æœ‰æ•ˆï¼Œä¹ æƒ¯å½¢æˆé€šå¸¸éœ€è¦21-66å¤©çš„æŒç»­å®è·µã€‚",
            "åŸ¹å…»æ‰¹åˆ¤æ€§é˜…è¯»èƒ½åŠ›æ˜¯ä¿¡æ¯æ—¶ä»£çš„é‡è¦æŠ€èƒ½ï¼Œèƒ½å¸®åŠ©è¾¨åˆ«ä¿¡æ¯çš„çœŸå®æ€§å’Œå¯é æ€§ã€‚",
            "å­¦ä¹ ä¸­çš„æŒ«æŠ˜ä½“éªŒæ˜¯æˆé•¿çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå…‹æœå­¦ä¹ å›°éš¾çš„è¿‡ç¨‹èƒ½åŸ¹å…»éŸ§æ€§å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚",
            "å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå°æ­¥éª¤å¯ä»¥é™ä½å­¦ä¹ éš¾åº¦ï¼Œè¿™ç§æ–¹æ³•è¢«ç§°ä¸º'ä»»åŠ¡åˆ†è§£æ³•'ï¼Œæœ‰åŠ©äºç®¡ç†å¤§å‹å­¦ä¹ é¡¹ç›®ã€‚",
            "å­¦ä¹ æˆæœçš„åŠæ—¶åé¦ˆå¯ä»¥è°ƒæ•´å­¦ä¹ ç­–ç•¥ï¼Œåé¦ˆåº”å½“åŒ…æ‹¬å…·ä½“çš„æ”¹è¿›å»ºè®®ã€‚",
            "åŸ¹å…»è‡ªæˆ‘ç®¡ç†èƒ½åŠ›æ˜¯ç»ˆèº«å­¦ä¹ çš„åŸºç¡€ï¼Œè‡ªæˆ‘è°ƒèŠ‚å­¦ä¹ èƒ½åŠ›ä¸å­¦æœ¯æˆå°±é«˜åº¦ç›¸å…³ã€‚",
            "è·¨å­¦ç§‘å­¦ä¹ å¯ä»¥æ‹“å®½æ€ç»´è§†é‡ï¼Œæ•´åˆä¸åŒå­¦ç§‘çŸ¥è¯†èƒ½åŸ¹å…»ç»¼åˆåˆ†æèƒ½åŠ›ã€‚",
            
            // æ–°å¢å†…å®¹ï¼šå­¦ä¹ ç§‘å­¦å‰æ²¿
            "ç¥ç»å¯å¡‘æ€§ç ”ç©¶è¡¨æ˜ï¼Œå¤§è„‘ä¼šæ ¹æ®å­¦ä¹ æ´»åŠ¨æŒç»­æ”¹å˜ï¼Œå³ä½¿åœ¨æˆå¹´åä¹Ÿèƒ½å½¢æˆæ–°çš„ç¥ç»è¿æ¥ã€‚",
            "ç¡çœ å¯¹å­¦ä¹ å’Œè®°å¿†è‡³å…³é‡è¦ï¼Œæ·±åº¦ç¡çœ æœŸé—´å¤§è„‘ä¼šå·©å›ºç™½å¤©å­¦ä¹ çš„ä¿¡æ¯ï¼Œæé«˜ç¡çœ è´¨é‡å¯æå‡å­¦ä¹ æ•ˆç‡ã€‚",
            "å†¥æƒ³å’Œæ­£å¿µç»ƒä¹ å¯ä»¥æé«˜ä¸“æ³¨åŠ›å’Œå­¦ä¹ æ•ˆç‡ï¼Œæ¯å¤©10åˆ†é’Ÿçš„æ­£å¿µç»ƒä¹ èƒ½æ˜¾è‘—æ”¹å–„æ³¨æ„åŠ›æŒç»­æ—¶é—´ã€‚",
            "è®¤çŸ¥è´Ÿè·ç†è®ºæŒ‡å‡ºï¼Œå­¦ä¹ ææ–™çš„å¤æ‚åº¦åº”å½“ä¸å­¦ä¹ è€…çš„è®¤çŸ¥èƒ½åŠ›ç›¸åŒ¹é…ï¼Œé¿å…è®¤çŸ¥è¶…è½½ã€‚",
            "é—´éš”é‡å¤ç³»ç»Ÿ(å¦‚Anki)åˆ©ç”¨è®°å¿†ç§‘å­¦åŸç†ï¼Œé€šè¿‡ä¼˜åŒ–å¤ä¹ é—´éš”æ˜¾è‘—æé«˜è®°å¿†æ•ˆç‡ã€‚",
            "å…ƒè®¤çŸ¥ç­–ç•¥(äº†è§£è‡ªå·±çš„å­¦ä¹ è¿‡ç¨‹)èƒ½æé«˜å­¦ä¹ æ•ˆæœï¼ŒåŸ¹å…»å­¦ç”Ÿè¯„ä¼°è‡ªå·±å­¦ä¹ çŠ¶æ€çš„èƒ½åŠ›è‡³å…³é‡è¦ã€‚",
            "ç¯å¢ƒå› ç´ å¯¹å­¦ä¹ æœ‰æ˜¾è‘—å½±å“ï¼Œé€‚å®œçš„æ¸©åº¦(20-22Â°C)å’Œå……è¶³çš„è‡ªç„¶å…‰èƒ½æé«˜å­¦ä¹ æ•ˆç‡ã€‚",
            "æ•°å­—ç´ å…»å·²æˆä¸º21ä¸–çºªæ ¸å¿ƒæŠ€èƒ½ï¼ŒåŒ…æ‹¬ä¿¡æ¯ç­›é€‰ã€æ‰¹åˆ¤æ€§è¯„ä¼°å’Œè´Ÿè´£ä»»ä½¿ç”¨æ•°å­—å·¥å…·çš„èƒ½åŠ›ã€‚",
            "æƒ…æ„Ÿæ™ºèƒ½åœ¨å­¦ä¹ ä¸­æ‰®æ¼”é‡è¦è§’è‰²ï¼Œè‡ªæˆ‘æ„è¯†ã€è‡ªæˆ‘ç®¡ç†ã€ç¤¾äº¤æ„è¯†å’Œå…³ç³»ç®¡ç†èƒ½åŠ›å½±å“å­¦ä¹ æ•ˆæœã€‚",
            "å¾®å­¦ä¹ (Microlearning)å°†å†…å®¹åˆ†è§£ä¸ºçŸ­å°ç²¾æ‚çš„æ¨¡å—ï¼Œé€‚åˆç°ä»£ç¢ç‰‡åŒ–å­¦ä¹ ç¯å¢ƒï¼Œæé«˜çŸ¥è¯†å¸æ”¶ç‡ã€‚",
            
            // æ–°å¢å†…å®¹ï¼šæ•™è‚²ä¸å­¦ä¹ è¶£é—»
            "è¾¾èŠ¬å¥‡åœ¨ç¬”è®°æœ¬ä¸­ä½¿ç”¨é•œåƒä¹¦å†™ï¼Œè¿™ç§ç‹¬ç‰¹çš„ä¹¦å†™æ–¹å¼å¯èƒ½å¸®åŠ©ä»–ä¸“æ³¨æ€è€ƒå¹¶å‡å°‘å¹²æ‰°ã€‚",
            "çˆ±å› æ–¯å¦æ¯å¤©åˆä¼‘å¹¶è¿›è¡Œ'ç™½æ—¥æ¢¦'ï¼Œè¿™ç§æœ‰æ„è¯†çš„ä¼‘æ¯è¢«è®¤ä¸ºæœ‰åŠ©äºä»–çš„åˆ›é€ æ€§æ€è€ƒã€‚",
            "ç ”ç©¶è¡¨æ˜ï¼Œæ•™å®¤å†…æ¤ç‰©èƒ½æé«˜å­¦ç”Ÿæ³¨æ„åŠ›è¾¾15%ï¼Œæ”¹å–„ç©ºæ°”è´¨é‡å¹¶å‡è½»å‹åŠ›ã€‚",
            "è«æ‰ç‰¹æ•ˆåº”æŒ‡çš„æ˜¯è†å¬è«æ‰ç‰¹éŸ³ä¹å¯èƒ½çŸ­æœŸæå‡ç©ºé—´æ¨ç†èƒ½åŠ›ï¼Œè™½ç„¶æ•ˆæœæœ‰é™ä½†å±•ç¤ºäº†éŸ³ä¹ä¸è®¤çŸ¥çš„è”ç³»ã€‚",
            "ç¾å›½å‘æ˜å®¶çˆ±è¿ªç”Ÿæœ‰ç‹¬ç‰¹çš„åˆ›æ„æ¿€å‘æ–¹æ³•ï¼šåœ¨æ¤…å­ä¸Šæ”¾æ¾å¹¶æ‰‹æŒé’¢çƒï¼Œå½“å…¥ç¡æ—¶é’¢çƒæ‰è½æƒŠé†’ä»–ï¼Œæ­¤æ—¶æ•æ‰åŠç¡åŠé†’é—´çš„åˆ›æ„ã€‚",
            "å­¦ä¹ ç¬¬äºŒè¯­è¨€èƒ½å»¶ç¼“è®¤çŸ¥è¡°é€€ï¼ŒåŒè¯­è€…æ‚£é˜¿å°”èŒ¨æµ·é»˜ç—…çš„å¹³å‡å¹´é¾„æ¯”å•è¯­è€…æ™š4-5å¹´ã€‚",
            "å¤å¸Œè…Šå“²å­¦å®¶è‹æ ¼æ‹‰åº•ä½¿ç”¨'äº§å©†æœ¯'(é€šè¿‡æé—®å¼•å¯¼æ€è€ƒ)æ•™å­¦ï¼Œè¿™ç§æ–¹æ³•è‡³ä»Šä»è¢«è§†ä¸ºæœ‰æ•ˆçš„æ•™è‚²æŠ€æœ¯ã€‚",
            "ç ”ç©¶æ˜¾ç¤ºï¼Œç«™ç«‹å­¦ä¹ èƒ½æé«˜å¿ƒç‡å’Œå¤§è„‘è¡€æµï¼Œå¯èƒ½å¢å¼ºæ³¨æ„åŠ›å’Œä¿¡æ¯å¤„ç†èƒ½åŠ›ã€‚",
            "é¢œè‰²å¿ƒç†å­¦ç ”ç©¶è¡¨æ˜ï¼Œè“è‰²ç¯å¢ƒæœ‰åŠ©äºæé«˜åˆ›é€ åŠ›ï¼Œç»¿è‰²ç¯å¢ƒæœ‰åŠ©äºå‡è½»çœ¼ç›ç–²åŠ³å’Œæé«˜é˜…è¯»æ•ˆç‡ã€‚",
            "å­”å­åœ¨2500å¤šå¹´å‰å°±æå‡º'å› ææ–½æ•™'çš„æ•™è‚²ç†å¿µï¼Œè¿™ä¸ç°ä»£ä¸ªæ€§åŒ–æ•™è‚²æ€æƒ³é«˜åº¦ä¸€è‡´ã€‚",
            
            // æ–°å¢å†…å®¹ï¼šå®ç”¨å­¦ä¹ æŠ€å·§
            "ä¸»åŠ¨å›å¿†(ä¸çœ‹ææ–™å°è¯•å›å¿†å†…å®¹)æ¯”ç®€å•é‡å¤é˜…è¯»æ›´æœ‰æ•ˆï¼Œè¿™æ˜¯ä¸€ç§é«˜å¼ºåº¦çš„å­¦ä¹ ç­–ç•¥ã€‚",
            "è´¹æ›¼å­¦ä¹ æ³•(ä»¥æ•™ä¿ƒå­¦)åŒ…å«å››ä¸ªæ­¥éª¤ï¼šé€‰æ‹©æ¦‚å¿µã€ç”¨ç®€å•è¯­è¨€è§£é‡Šã€è¯†åˆ«çŸ¥è¯†ç¼ºå£ã€ç®€åŒ–å’Œç±»æ¯”ã€‚",
            "æ€ç»´å¯¼å›¾åº”ä½¿ç”¨å…³é”®è¯è€Œéå®Œæ•´å¥å­ï¼Œè¿™æœ‰åŠ©äºä¿ƒè¿›åˆ›æ„è”æƒ³å’Œè®°å¿†ã€‚",
            "å¤ä¹ æ—¶åº”é‡‡ç”¨'äº¤é”™å­¦ä¹ '(æ··åˆä¸åŒä¸»é¢˜)è€Œé'é›†ä¸­å­¦ä¹ '(ä¸“æ³¨å•ä¸€ä¸»é¢˜)ï¼Œèƒ½æé«˜é•¿æœŸè®°å¿†æ•ˆæœã€‚",
            "åˆ›å»ºä¸ªäººå­¦ä¹ ç©ºé—´å¹¶ä¿æŒä¸€è‡´æ€§èƒ½å¢å¼ºå­¦ä¹ ä»ªå¼æ„Ÿï¼Œæ¡ä»¶åå°„èˆ¬åœ°è¿›å…¥å­¦ä¹ çŠ¶æ€ã€‚",
            "ä½¿ç”¨'åº·å¥ˆå°”ç¬”è®°æ³•'(åˆ†ä¸ºç¬”è®°åŒºã€æç¤ºåŒºå’Œæ€»ç»“åŒº)å¯ä»¥æé«˜è¯¾å ‚ç¬”è®°çš„ç»„ç»‡æ€§å’Œå¤ä¹ æ•ˆç‡ã€‚",
            "å­¦ä¹ å‰è®¾å®šå…·ä½“æ„å›¾èƒ½æé«˜ä¸“æ³¨åº¦ï¼Œæ˜ç¡®å­¦ä¹ ç›®æ ‡å’Œé¢„æœŸæˆæœã€‚",
            "æ•™æˆçŸ¥è¯†çš„åŒæ—¶è®°å½•å­¦ä¹ è¿‡ç¨‹(å­¦ä¹ æ—¥å¿—)ï¼Œæœ‰åŠ©äºè¯†åˆ«ä¸ªäººå­¦ä¹ æ¨¡å¼å’Œæ”¹è¿›ç©ºé—´ã€‚",
            "ä½¿ç”¨'5ç§’æ³•åˆ™'å…‹æœå­¦ä¹ æ‹–å»¶ï¼šå½“æƒ³å­¦ä¹ æ—¶ï¼Œå€’æ•°5-4-3-2-1ï¼Œç„¶åç«‹å³å¼€å§‹ï¼Œé¿å…çŠ¹è±«å’Œå€Ÿå£ã€‚",
            "'ç•ªèŒ„å·¥ä½œæ³•'ä¸ä»…é€‚ç”¨äºå­¦ä¹ ï¼Œä¹Ÿå¯ç”¨äºå¤ä¹ å’Œé—®é¢˜è§£å†³ï¼Œå…³é”®æ˜¯ä¸¥æ ¼æ‰§è¡Œä¼‘æ¯æ—¶é—´ã€‚",
            
            // æ–°å¢å†…å®¹ï¼šå­¦ä¹ ä¸å¥åº·
            "èº«ä½“æ´»åŠ¨èƒ½æé«˜è®¤çŸ¥åŠŸèƒ½ï¼Œç ”ç©¶è¡¨æ˜æ¯å‘¨è‡³å°‘150åˆ†é’Ÿä¸­ç­‰å¼ºåº¦è¿åŠ¨èƒ½æ”¹å–„è®°å¿†åŠ›å’Œæ³¨æ„åŠ›ã€‚",
            "é¥®é£Ÿå¯¹å¤§è„‘åŠŸèƒ½æœ‰æ˜¾è‘—å½±å“ï¼Œå¯Œå«Omega-3è„‚è‚ªé…¸ã€æŠ—æ°§åŒ–å‰‚å’Œå¤åˆç¢³æ°´åŒ–åˆç‰©çš„é£Ÿç‰©æœ‰åŠ©äºè®¤çŸ¥å¥åº·ã€‚",
            "æ°´åˆ†æ‘„å…¥ä¸è¶³ä¼šå½±å“è®¤çŸ¥è¡¨ç°ï¼Œè½»åº¦è„±æ°´(ä»…2%)å°±èƒ½æ˜¾è‘—é™ä½æ³¨æ„åŠ›ã€è®°å¿†åŠ›å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚",
            "è§„å¾‹ä½œæ¯å¯¹å­¦ä¹ è‡³å…³é‡è¦ï¼Œä¿æŒä¸€è‡´çš„ç¡çœ æ—¶é—´èƒ½ä¼˜åŒ–è®°å¿†å·©å›ºå’Œè®¤çŸ¥åŠŸèƒ½ã€‚",
            "å‹åŠ›ç®¡ç†æ˜¯æœ‰æ•ˆå­¦ä¹ çš„å…³é”®ï¼Œæ…¢æ€§å‹åŠ›ä¼šæŸå®³è®°å¿†åŠ›ï¼Œä½†é€‚åº¦å‹åŠ›èƒ½æé«˜ä¸“æ³¨åŠ›å’Œè¡¨ç°ã€‚",
            "ç¤¾äº¤è”ç³»å¯¹å­¦ä¹ æœ‰ç§¯æå½±å“ï¼Œä¸åŒå­¦è®¨è®ºå’Œåˆä½œèƒ½æ·±åŒ–ç†è§£å¹¶æä¾›æƒ…æ„Ÿæ”¯æŒã€‚",
            "ç¯å¢ƒå™ªéŸ³å¯¹å­¦ä¹ çš„å½±å“å› äººè€Œå¼‚ï¼Œæœ‰äº›äººåœ¨å®‰é™ç¯å¢ƒä¸­å­¦ä¹ æ•ˆç‡æ›´é«˜ï¼Œè€Œæœ‰äº›äººåˆ™åœ¨é€‚åº¦èƒŒæ™¯å™ªéŸ³ä¸‹è¡¨ç°æ›´å¥½ã€‚",
            "å®šæœŸä¼‘æ¯å’Œæ¢å¤æ˜¯æŒç»­é«˜æ•ˆå­¦ä¹ çš„åŸºç¡€ï¼Œè¿‡åº¦å­¦ä¹ å¯èƒ½å¯¼è‡´å€¦æ€ å’Œæ•ˆç‡ä¸‹é™ã€‚",
            "ç§¯æçš„è‡ªæˆ‘å¯¹è¯èƒ½æå‡å­¦ä¹ ä¿¡å¿ƒå’Œè¡¨ç°ï¼Œç”¨é¼“åŠ±æ€§è¯­è¨€æ›¿ä»£è‡ªæˆ‘æ€€ç–‘ã€‚",
            "æ„Ÿæ©ç»ƒä¹ æœ‰åŠ©äºæ”¹å–„å­¦ä¹ å¿ƒæ€ï¼Œå®šæœŸåæ€å­¦ä¹ ä¸­çš„è¿›æ­¥å’Œæ”¶è·èƒ½å¢å¼ºå­¦ä¹ åŠ¨åŠ›ã€‚"
        ];
        
        let countdownInterval = null;
        let countdownSeconds = 60;
        
        // éšæœºæ˜¾ç¤ºä¸€ä¸ªæœ‰è¶£çš„äº‹å®
        function showRandomFunFact() {
            const randomIndex = Math.floor(Math.random() * funFacts.length);
            document.getElementById('fun-fact-content').textContent = funFacts[randomIndex];
            
            // é‡ç½®å€’è®¡æ—¶
            resetCountdown();
        }
        
        // é‡ç½®å€’è®¡æ—¶
        function resetCountdown() {
            clearInterval(countdownInterval);
            countdownSeconds = 60;
            document.getElementById('countdown').textContent = countdownSeconds;
            
            // å¼€å§‹æ–°çš„å€’è®¡æ—¶
            countdownInterval = setInterval(() => {
                countdownSeconds--;
                document.getElementById('countdown').textContent = countdownSeconds;
                
                if (countdownSeconds <= 0) {
                    showRandomFunFact();
                }
            }, 1000);
        }
        
        // åˆå§‹åŒ–"ä½ çŸ¥é“å—"æ ç›®
        function initFunFactSection() {
            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªäº‹å®
            showRandomFunFact();
            
            // ç»‘å®šæ‰‹åŠ¨åˆ·æ–°æŒ‰é’®
            document.getElementById('fun-fact-refresh').addEventListener('click', showRandomFunFact);
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', async function() {
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            showLoader();
            
            try {
                // è®¾ç½®å½“å‰æ—¥æœŸ
                updateCurrentDate();
                
                // ç¡®ä¿classConfigåŒ…å«gradeSubjectsé…ç½®
                if (!classConfig.gradeSubjects) {
                    classConfig.gradeSubjects = {
                        "åˆä¸€": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"],
                        "åˆäºŒ": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"],
                        "åˆä¸‰": ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­", "ç‰©ç†", "åŒ–å­¦", "å†å²", "åœ°ç†", "æ”¿æ²»", "ç”Ÿç‰©", "ä½“è‚²", "å¿ƒç†", "ä¿¡æ¯"]
                    };
                }
                
                // å¦‚æœæ²¡æœ‰é€‰æ‹©å¹´çº§ï¼Œé»˜è®¤ä½¿ç”¨åˆä¸€
                if (!classConfig.classInfo.grade) {
                    classConfig.classInfo.grade = "åˆä¸€";
                    classConfig.subjects = [...classConfig.gradeSubjects["åˆä¸€"]];
                }
                
                // æ›´æ–°åŠ è½½çŠ¶æ€
                updateLoaderText('åŠ è½½æ•°æ®ä¸­...');
                
                // åˆå§‹åŒ–æ•°æ®åº“å¹¶åŠ è½½æ•°æ®ï¼ˆå®¹é”™å¤„ç†ï¼‰
                try {
                    await initDatabase();
                    // å°è¯•åŠ è½½æ•°æ®ï¼Œä½†å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­
                    try { await loadScheduleData(); } catch (e) { console.error('åŠ è½½è¯¾ç¨‹è¡¨å¤±è´¥:', e); }
                    try { await loadHomeworkRecords(); } catch (e) { console.error('åŠ è½½ä½œä¸šè®°å½•å¤±è´¥:', e); }
                    try { await loadClassConfig(); } catch (e) { console.error('åŠ è½½ç­çº§é…ç½®å¤±è´¥:', e); }
                } catch (error) {
                    console.error('æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥:', error);
                    // å³ä½¿æ•°æ®åº“å¤±è´¥ï¼Œä¹Ÿç»§ç»­åˆå§‹åŒ–åº”ç”¨
                }
                
                // æ›´æ–°åŠ è½½çŠ¶æ€
                updateLoaderText('ç”Ÿæˆç•Œé¢å…ƒç´ ...');
                
                // ç”Ÿæˆç§‘ç›®é€‰æ‹©å™¨
                generateSubjectSelect();
                
                // ç”Ÿæˆå­¦å·é€‰æ‹©å™¨
                generateStudentNumberButtons();
                
                // æ›´æ–°ç­è®­æ˜¾ç¤º
                updateClassMotto();
                
                // ç”Ÿæˆè¯¾ç¨‹è¡¨
                generateSchedule();
                
                // æ˜¾ç¤ºä½œä¸šè®°å½•
                displayHomeworkRecords();
                
                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                bindEventListeners();
                
                // æ·»åŠ é…ç½®æŒ‰é’®å’Œå¯¼å…¥åŠŸèƒ½
                addConfigAndImportFeatures();
                
                // åˆå§‹åŒ–"ä½ çŸ¥é“å—"æ ç›®
                initFunFactSection();
                
                // æ³¨å†ŒService Worker
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', () => {
                        navigator.serviceWorker.register('service-worker.js')
                            .then(registration => {
                                console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                            })
                            .catch(error => {
                                console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                            });
                    });
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            } finally {
                // éšè—åŠ è½½åŠ¨ç”»
                setTimeout(() => {
                    hideLoader();
                    // åŠ è½½å®Œæˆåæ˜¾ç¤ºå…¬å‘Š
                    showAnnouncement();
                }, 500); // çŸ­æš‚å»¶è¿Ÿï¼Œç¡®ä¿ç”¨æˆ·èƒ½çœ‹åˆ°åŠ è½½è¿‡ç¨‹
            }
        });
        
        // æ›´æ–°å½“å‰æ—¥æœŸ
        // ç­çº§é€‰æ‹©æ¨¡æ€æ¡†
        function showClassSelectionModal() {
            // é˜²æ­¢é‡å¤åˆ›å»ºæ¨¡æ€æ¡†
            if (document.getElementById('class-selection-modal')) {
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'class-selection-modal';
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass-effect rounded-xl p-8 max-w-lg w-full border border-white/30 shadow-xl transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                    <h3 class="text-xl font-bold text-dark mb-6">é€‰æ‹©ç­çº§ä¿¡æ¯</h3>
                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å¹´çº§</label>
                            <select id="grade-selector" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                                <option value="åˆä¸€">åˆä¸€</option>
                                <option value="åˆäºŒ">åˆäºŒ</option>
                                <option value="åˆä¸‰">åˆä¸‰</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç­çº§</label>
                            <select id="class-selector" class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                                <option value="ä¸€ç­">ä¸€ç­</option>
                                <option value="äºŒç­">äºŒç­</option>
                                <option value="ä¸‰ç­">ä¸‰ç­</option>
                                <option value="å››ç­">å››ç­</option>
                                <option value="äº”ç­">äº”ç­</option>
                                <option value="å…­ç­">å…­ç­</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-end gap-4">
                        <button id="cancel-selection" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100/20 transition-colors duration-300">
                            å–æ¶ˆ
                        </button>
                        <button id="confirm-selection" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors duration-300">
                            ç¡®è®¤
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
                document.getElementById('modal-content').classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // è·å–å½“å‰é€‰æ‹©
            const currentGrade = document.getElementById('config-class-grade').value || 'åˆä¸€';
            const currentClass = document.getElementById('config-class-name').value ? 
                document.getElementById('config-class-name').value.replace(/^\S+/, '') : 'ä¸€ç­';
            
            // è®¾ç½®é»˜è®¤é€‰æ‹©
            if (document.getElementById('grade-selector')) {
                document.getElementById('grade-selector').value = currentGrade;
            }
            if (document.getElementById('class-selector')) {
                document.getElementById('class-selector').value = currentClass;
            }
            
            // ç¡®è®¤æŒ‰é’®äº‹ä»¶
            if (document.getElementById('confirm-selection')) {
                document.getElementById('confirm-selection').addEventListener('click', function() {
                    const selectedGrade = document.getElementById('grade-selector').value;
                    const selectedClass = document.getElementById('class-selector').value;
                    const fullClassName = `${selectedGrade}${selectedClass}`;
                    
                    // æ›´æ–°æ˜¾ç¤º
                    document.getElementById('config-class-name-display').value = fullClassName;
                    document.getElementById('config-class-name').value = fullClassName;
                    document.getElementById('config-class-grade').value = selectedGrade;
                    
                    // å¦‚æœä¸»é…ç½®ä¸­æœ‰gradeé€‰æ‹©æ¡†ï¼Œä¹ŸåŒæ­¥æ›´æ–°
                    if (document.getElementById('config-grade')) {
                        document.getElementById('config-grade').value = selectedGrade;
                    }
                    
                    // æ›´æ–°é¡µé¢æ ‡é¢˜
                    document.title = `${fullClassName}å­¦æƒ…ç»Ÿè®¡`;
                    const mainTitle = document.querySelector('h1.text-gradient');
                    if (mainTitle) {
                        mainTitle.textContent = `${fullClassName}å­¦æƒ…ç»Ÿè®¡`;
                    }
                    
                    // ä¿å­˜åˆ°localStorage
                    classConfig.classInfo.name = fullClassName;
                    classConfig.classInfo.grade = selectedGrade;
                    localStorage.setItem('classConfig', JSON.stringify(classConfig));
                    
                    closeModal();
                    showToast('ç­çº§ä¿¡æ¯æ›´æ–°æˆåŠŸï¼', 'success');
                });
            }
            
            // å–æ¶ˆæŒ‰é’®äº‹ä»¶
            if (document.getElementById('cancel-selection')) {
                document.getElementById('cancel-selection').addEventListener('click', closeModal);
            }
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // å…³é—­æ¨¡æ€æ¡†å‡½æ•°
            function closeModal() {
                const modalContent = document.getElementById('modal-content');
                if (modalContent) {
                    modalContent.classList.add('scale-95', 'opacity-0');
                    modalContent.classList.remove('scale-100', 'opacity-100');
                }
                
                setTimeout(() => {
                    if (document.getElementById('class-selection-modal')) {
                        document.body.removeChild(document.getElementById('class-selection-modal'));
                    }
                    document.body.style.overflow = '';
                }, 300);
            }
        }
        
        // åˆå§‹åŒ–ç­çº§é€‰æ‹©å™¨ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const openSelector = document.getElementById('open-class-selector');
            const displayInput = document.getElementById('config-class-name-display');
            
            if (openSelector) {
                openSelector.addEventListener('click', showClassSelectionModal);
            }
            if (displayInput) {
                displayInput.addEventListener('click', showClassSelectionModal);
            }
        });
        
        // æ›´æ–°ç­è®­æ˜¾ç¤º
function updateClassMotto() {
    const mottoElement = document.getElementById('class-motto');
    if (mottoElement && classConfig.classInfo.motto) {
        mottoElement.textContent = classConfig.classInfo.motto;
    }
}

function updateCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('zh-CN', options);
            
            // è‡ªåŠ¨æ ¹æ®å½“å‰æ—¥æœŸé€‰æ‹©å¯¹åº”çš„æ˜ŸæœŸï¼ˆæ’é™¤å‘¨å…­å’Œå‘¨æ—¥ï¼‰
            const dayOfWeek = now.getDay();
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            
            // å¦‚æœæ˜¯å‘¨ä¸€åˆ°å‘¨äº”ï¼Œè‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„æ˜ŸæœŸ
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                const today = weekdays[dayOfWeek];
                // åªæœ‰å½“é¡µé¢åˆæ¬¡åŠ è½½æ—¶æ‰è‡ªåŠ¨é€‰æ‹©æ—¥æœŸï¼Œé¿å…å¹²æ‰°ç”¨æˆ·çš„æ‰‹åŠ¨é€‰æ‹©
                if (!window.currentDayAutoSelected) {
                    currentDay = today;
                    window.currentDayAutoSelected = true;
                    
                    // æ›´æ–°UIä¸Šçš„æŒ‰é’®é€‰ä¸­çŠ¶æ€
                    const dayButtons = document.querySelectorAll('.day-btn');
                    dayButtons.forEach(btn => {
                        if (btn.dataset.day === today) {
                            // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
                            dayButtons.forEach(b => {
                                b.classList.remove('gradient-border', 'bg-primary', 'text-white');
                                b.classList.add('glass-effect', 'border', 'border-white/30', 'hover:bg-primary/10');
                            });
                            
                            // è®¾ç½®å½“å‰æ—¥æœŸæŒ‰é’®çš„æ ·å¼
                            btn.classList.add('gradient-border', 'bg-primary', 'text-white');
                            btn.classList.remove('glass-effect', 'border', 'border-white/30', 'hover:bg-primary/10');
                            
                            // æ¨¡æ‹Ÿç‚¹å‡»æ•ˆæœï¼Œæ·»åŠ åˆ‡æ¢åŠ¨ç”»
                            const container = document.getElementById('schedule-container');
                            if (container) {
                                container.style.opacity = '0';
                                container.style.transform = 'translateY(20px)';
                                container.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                                
                                setTimeout(() => {
                                    generateSchedule();
                                    container.style.opacity = '1';
                                    container.style.transform = 'translateY(0)';
                                }, 150);
                            }
                        }
                    });
                    
                    console.log(`è‡ªåŠ¨é€‰æ‹©æ—¥æœŸ: ${today}`);
                }
            } else {
                console.log('å½“å‰æ˜¯å‘¨æœ«ï¼Œä½¿ç”¨é»˜è®¤æ—¥æœŸ');
            }
        }
        
        // ç”Ÿæˆå­¦å·é€‰æ‹©å™¨
        function generateStudentNumberButtons() {
            // æŸ¥æ‰¾æˆ–åˆ›å»ºæ‰¹é‡æ“ä½œæŒ‰é’®å®¹å™¨
            let batchContainer = document.getElementById('batch-controls-container');
            if (!batchContainer) {
                batchContainer = document.createElement('div');
                batchContainer.id = 'batch-controls-container';
                batchContainer.className = 'mb-6';
                
                // å°†æ‰¹é‡æ“ä½œå®¹å™¨æ’å…¥åˆ°å­¦å·é€‰æ‹©å™¨ä¹‹å‰
                const container = document.getElementById('student-numbers');
                container.parentNode.insertBefore(batchContainer, container);
            }
            
            // è®¾ç½®æ‰¹é‡æ“ä½œæŒ‰é’®
            batchContainer.innerHTML = `
                <div class="flex gap-3 p-4 glass-effect border border-white/20 rounded-xl">
                    <button id="select-all-btn" class="px-4 py-2 glass-effect border border-white/30 rounded-lg text-sm hover:bg-primary/10 transition-all duration-300">
                        å…¨é€‰
                    </button>
                    <button id="select-range-btn" class="px-4 py-2 glass-effect border border-white/30 rounded-lg text-sm hover:bg-primary/10 transition-all duration-300">
                        é€‰æ‹©èŒƒå›´
                    </button>
                    <button id="clear-all-btn" class="px-4 py-2 glass-effect border border-white/30 rounded-lg text-sm hover:bg-primary/10 transition-all duration-300">
                        æ¸…ç©ºé€‰æ‹©
                    </button>
                </div>
            `;
            
            // ç»‘å®šæ‰¹é‡æ“ä½œäº‹ä»¶
            document.getElementById('select-all-btn').addEventListener('click', selectAllStudents);
            document.getElementById('select-range-btn').addEventListener('click', selectStudentRange);
            document.getElementById('clear-all-btn').addEventListener('click', clearAllStudentSelections);
            
            // æ¸…ç©ºå¹¶ç”Ÿæˆå­¦å·æŒ‰é’®
            const container = document.getElementById('student-numbers');
            container.innerHTML = '';
            
            // æ ¹æ®é…ç½®ç”Ÿæˆå­¦å·æŒ‰é’®
            for (let i = classConfig.minStudentId; i <= classConfig.maxStudentId; i++) {
                // è·³è¿‡æ’é™¤çš„å­¦å·
                if (classConfig.excludedIds.includes(i)) continue;
                
                const button = document.createElement('button');
                button.className = 'student-number-btn w-12 h-12 flex items-center justify-center rounded-full glass-effect border border-white/30 hover:bg-primary/10 transition-all duration-300 hover-lift';
                button.textContent = i;
                button.dataset.number = i;
                
                button.addEventListener('click', function() {
                    toggleStudentNumber(i);
                });
                
                container.appendChild(button);
            }
        }
        
        // æ‰¹é‡æ“ä½œå‡½æ•°
        function selectAllStudents() {
            selectedStudentNumbers = [];
            
            for (let i = classConfig.minStudentId; i <= classConfig.maxStudentId; i++) {
                if (!classConfig.excludedIds.includes(i)) {
                    selectedStudentNumbers.push(i);
                }
            }
            
            updateStudentNumberButtons();
            updateSelectedNumbersDisplay();
        }
        
        // åˆ›å»ºè‡ªå®šä¹‰è¾“å…¥æ¨¡æ€æ¡†
        function createInputModal(title, placeholder, defaultValue = '', onConfirm) {
            // åˆ›å»ºæ¨¡æ€æ¡†å®¹å™¨
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-md">
                    <div class="p-6 border-b border-white/20">
                        <h3 class="text-xl font-bold text-dark">${title}</h3>
                    </div>
                    <div class="p-6">
                        <input 
                            type="text" 
                            id="modal-input" 
                            class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300"
                            placeholder="${placeholder}"
                            value="${defaultValue}"
                        >
                    </div>
                    <div class="p-6 border-t border-white/20 flex gap-3">
                        <button id="modal-cancel" class="flex-1 px-4 py-3 glass-effect border border-white/30 rounded-xl hover:bg-gray-200/20 transition-all duration-300">
                            å–æ¶ˆ
                        </button>
                        <button id="modal-confirm" class="flex-1 px-4 py-3 gradient-border bg-primary hover:bg-primary/90 text-white rounded-xl transition-all duration-300 hover:shadow-lg">
                            ç¡®è®¤
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const input = document.getElementById('modal-input');
            const cancelBtn = document.getElementById('modal-cancel');
            const confirmBtn = document.getElementById('modal-confirm');
            
            // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
            input.focus();
            input.select();
            
            // å–æ¶ˆæŒ‰é’®äº‹ä»¶
            cancelBtn.addEventListener('click', () => {
                modal.remove();
            });
            
            // ç¡®è®¤æŒ‰é’®äº‹ä»¶
            confirmBtn.addEventListener('click', () => {
                const value = input.value;
                modal.remove();
                onConfirm(value);
            });
            
            // å›è½¦é”®ç¡®è®¤
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const value = input.value;
                    modal.remove();
                    onConfirm(value);
                }
            });
            
            // ESCé”®å–æ¶ˆ
            document.addEventListener('keydown', function handleEsc(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                    document.removeEventListener('keydown', handleEsc);
                }
            });
        }
        
        function selectStudentRange() {
            createInputModal(
                'é€‰æ‹©å­¦å·èŒƒå›´', 
                'è¯·è¾“å…¥å­¦å·èŒƒå›´ï¼ˆæ ¼å¼ï¼šå¼€å§‹-ç»“æŸï¼Œå¦‚ 1-10ï¼‰', 
                '',
                (rangeInput) => {
                    if (!rangeInput) return;
                    
                    const [start, end] = rangeInput.split('-').map(Number);
                    if (isNaN(start) || isNaN(end) || start > end) {
                        showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„èŒƒå›´æ ¼å¼ï¼', 'error');
                        return;
                    }
                    
                    // éªŒè¯èŒƒå›´åœ¨æœ‰æ•ˆèŒƒå›´å†…
                    if (start < classConfig.minStudentId || end > classConfig.maxStudentId) {
                        showToast(`èŒƒå›´å¿…é¡»åœ¨ ${classConfig.minStudentId}-${classConfig.maxStudentId} ä¹‹é—´ï¼`, 'error');
                        return;
                    }
                    
                    // æ·»åŠ èŒƒå›´å†…çš„å­¦å·
                    for (let i = start; i <= end; i++) {
                        if (!classConfig.excludedIds.includes(i) && !selectedStudentNumbers.includes(i)) {
                            selectedStudentNumbers.push(i);
                        }
                    }
                    
                    updateStudentNumberButtons();
                    updateSelectedNumbersDisplay();
                }
            );
        }
        
        function clearAllStudentSelections() {
            selectedStudentNumbers = [];
            updateStudentNumberButtons();
            updateSelectedNumbersDisplay();
        }
        
        function updateStudentNumberButtons() {
            document.querySelectorAll('.student-number-btn').forEach(button => {
                const number = parseInt(button.dataset.number);
                if (selectedStudentNumbers.includes(number)) {
                    button.classList.add('bg-primary/20', 'border-primary');
                } else {
                    button.classList.remove('bg-primary/20', 'border-primary');
                }
            });
        }
        
        // åˆ‡æ¢å­¦å·é€‰æ‹©çŠ¶æ€
        function toggleStudentNumber(number) {
            const index = selectedStudentNumbers.indexOf(number);
            const button = document.querySelector(`.student-number-btn[data-number="${number}"]`);
            
            if (index === -1) {
                selectedStudentNumbers.push(number);
                if (button) button.classList.add('bg-primary/20', 'border-primary');
            } else {
                selectedStudentNumbers.splice(index, 1);
                if (button) button.classList.remove('bg-primary/20', 'border-primary');
            }
            
            updateSelectedNumbersDisplay();
        }
        
        // æ›´æ–°å·²é€‰å­¦å·æ˜¾ç¤º
        function updateSelectedNumbersDisplay() {
            const container = document.getElementById('selected-numbers');
            container.innerHTML = '';
            
            selectedStudentNumbers.sort((a, b) => a - b).forEach(number => {
                const tag = document.createElement('div');
                tag.className = 'inline-flex items-center glass-effect border border-white/30 bg-primary/20 text-primary px-3 py-1.5 rounded-full text-sm hover-lift transition-all duration-300';
                tag.innerHTML = `${number} <span class="ml-1 cursor-pointer remove-number">&times;</span>`;
                tag.dataset.number = number;
                
                const removeBtn = tag.querySelector('.remove-number');
                removeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleStudentNumber(number);
                });
                
                container.appendChild(tag);
            });
            
            if (selectedStudentNumbers.length === 0) {
                container.innerHTML = '<span class="text-gray-400">æš‚æ— é€‰æ‹©</span>';
            }
        }
        
        // ç”Ÿæˆè¯¾ç¨‹è¡¨
        function generateSchedule() {
            const container = document.getElementById('schedule-container');
            container.innerHTML = '';
            
            const courses = scheduleData[currentDay];
            courses.forEach(course => {
                container.appendChild(createCourseItem(course));
            });
        }
        
        // åˆ›å»ºè¯¾ç¨‹èŠ‚æ•°ç¼–è¾‘æ¨¡æ€æ¡†
        function createSectionNumberModal(courseId) {
            // ç§»é™¤å·²å­˜åœ¨çš„æ¨¡æ€æ¡†
            const existingModal = document.getElementById('section-number-modal');
            if (existingModal) existingModal.remove();
            
            const modal = document.createElement('div');
            modal.id = 'section-number-modal';
            modal.className = 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-md">
                    <div class="p-6 border-b border-white/20">
                        <h2 class="text-xl font-bold text-dark">ä¿®æ”¹è¯¾ç¨‹èŠ‚æ•°</h2>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div>
                                <label for="section-number-input" class="block text-sm font-medium text-gray-700 mb-2">è¯·è¾“å…¥æ–°çš„è¯¾ç¨‹èŠ‚æ•°</label>
                                <input 
                                    type="number" 
                                    id="section-number-input" 
                                    value="${courseId}"
                                    min="1"
                                    max="99"
                                    class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300"
                                    placeholder="1-99ä¹‹é—´çš„æ•°å­—"
                                >
                            </div>
                            <div class="flex gap-3">
                                <button id="section-number-cancel" class="flex-1 px-4 py-3 glass-effect border border-white/30 rounded-xl hover:bg-gray-200/20 transition-all duration-300">
                                    å–æ¶ˆ
                                </button>
                                <button id="section-number-confirm" class="flex-1 px-4 py-3 gradient-border bg-primary hover:bg-primary/90 text-white rounded-xl transition-all duration-300 hover:shadow-lg">
                                    ç¡®è®¤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç»‘å®šäº‹ä»¶
            const cancelBtn = document.getElementById('section-number-cancel');
            const confirmBtn = document.getElementById('section-number-confirm');
            const input = document.getElementById('section-number-input');
            
            // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
            input.focus();
            input.select();
            
            // å–æ¶ˆæŒ‰é’®äº‹ä»¶
            cancelBtn.addEventListener('click', () => {
                modal.remove();
            });
            
            // ç¡®è®¤æŒ‰é’®äº‹ä»¶
            confirmBtn.addEventListener('click', () => {
                const number = parseInt(input.value);
                handleSectionNumberUpdate(courseId, number);
                modal.remove();
            });
            
            // å›è½¦é”®ç¡®è®¤
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const number = parseInt(input.value);
                    handleSectionNumberUpdate(courseId, number);
                    modal.remove();
                }
            });
        }
        
        // å¤„ç†è¯¾ç¨‹èŠ‚æ•°æ›´æ–°
        function handleSectionNumberUpdate(courseId, number) {
            if (isNaN(number) || number < 1 || number > 99) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„è¯¾ç¨‹èŠ‚æ•°ï¼ˆ1-99ï¼‰ï¼', 'error');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦é‡å¤
            const courses = scheduleData[currentDay];
            if (courses.some(c => c.id !== courseId && c.id === number)) {
                showToast('è¯¥è¯¾ç¨‹èŠ‚æ•°å·²å­˜åœ¨ï¼', 'error');
                return;
            }
            
            // æ›´æ–°è¯¾ç¨‹èŠ‚æ•°
            const courseIndex = courses.findIndex(c => c.id === courseId);
            if (courseIndex !== -1) {
                courses[courseIndex].id = number;
                
                // æŒ‰èŠ‚æ•°æ’åº
                scheduleData[currentDay].sort((a, b) => a.id - b.id);
                
                saveScheduleData();
                generateSchedule();
                showToast('è¯¾ç¨‹èŠ‚æ•°å·²æ›´æ–°ï¼', 'success');
            }
        }
        
        // ç¼–è¾‘è¯¾ç¨‹èŠ‚æ•°
        function editSectionNumber(courseId) {
            createSectionNumberModal(courseId);
        }
        
        // åˆ›å»ºè¯¾ç¨‹é¡¹
        function createCourseItem(course) {
            const courseDiv = document.createElement('div');
            courseDiv.className = 'glass-effect rounded-xl p-5 shadow-sm border border-white/30 hover-lift transition-all duration-300 relative';
            courseDiv.innerHTML = `
                <div class="flex items-center mb-4">
                    <span class="section-number bg-primary/20 text-primary font-semibold rounded-full w-10 h-10 flex items-center justify-center mr-4 hover-lift transition-all duration-300 cursor-pointer" data-id="${course.id}" title="ç‚¹å‡»ä¿®æ”¹è¯¾ç¨‹èŠ‚æ•°">${course.id}</span>
                    <input type="text" placeholder="è¯·è¾“å…¥ç§‘ç›®åç§°" value="${course.subject || ''}" 
                           class="flex-1 px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" 
                           data-field="subject" data-id="${course.id}">
                </div>
                <button class="absolute top-4 right-4 text-gray-400 hover:text-danger transition-colors delete-course-btn" data-id="${course.id}">
                    <i class="fa fa-trash"></i>
                </button>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">è¯¾å ‚è¡¨ç°è¯„åˆ†</label>
                    <!-- å¿«é€Ÿé€‰æ‹©ç§‘ç›® -->
                    <div class="flex flex-wrap gap-2 mb-2">
                        ${classConfig.subjects.map(subject => `
                            <button class="quick-subject-btn px-3 py-1 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-subject="${subject}">
                                ${subject}
                            </button>
                        `).join('')}
                    </div>
                    <!-- è¯„åˆ†æ˜¾ç¤ºï¼Œæ ¹æ®ç§‘ç›®ç±»å‹æ˜¾ç¤ºä¸åŒçš„è¯„åˆ†æ–¹å¼ -->
                    <div class="space-y-3" data-field="rating" data-id="${course.id}">
                        ${course.subject === 'æ•°å­¦' || course.subject === 'è‹±è¯­' ? `
                            <!-- åˆ†å±‚ç­è¯„åˆ† - ä¸‰è¡Œæ˜¾ç¤º -->
                            <div class="flex items-center">
                                <span class="w-8 text-sm text-gray-500">1ç­:</span>
                                <div class="flex-1 flex gap-1">
                                    ${Array(5).fill(null).map((_, i) => {
                                        const starIndex = i + 1;
                                        return `<i class="fa fa-star text-sm cursor-pointer transition-transform hover:scale-110 ${starIndex <= (course.layerRatings?.layer1 || 0) ? 'star-active' : 'star-inactive'}" data-rating="${starIndex}" data-layer="1"></i>`;
                                    }).join('')}
                                </div>
                            </div>
                            <div class="flex items-center">
                                <span class="w-8 text-sm text-gray-500">2ç­:</span>
                                <div class="flex-1 flex gap-1">
                                    ${Array(5).fill(null).map((_, i) => {
                                        const starIndex = i + 1;
                                        return `<i class="fa fa-star text-sm cursor-pointer transition-transform hover:scale-110 ${starIndex <= (course.layerRatings?.layer2 || 0) ? 'star-active' : 'star-inactive'}" data-rating="${starIndex}" data-layer="2"></i>`;
                                    }).join('')}
                                </div>
                            </div>
                            <div class="flex items-center">
                                <span class="w-8 text-sm text-gray-500">3ç­:</span>
                                <div class="flex-1 flex gap-1">
                                    ${Array(5).fill(null).map((_, i) => {
                                        const starIndex = i + 1;
                                        return `<i class="fa fa-star text-sm cursor-pointer transition-transform hover:scale-110 ${starIndex <= (course.layerRatings?.layer3 || 0) ? 'star-active' : 'star-inactive'}" data-rating="${starIndex}" data-layer="3"></i>`;
                                    }).join('')}
                                </div>
                            </div>
                        ` : `
                            <!-- æ™®é€šè¯„åˆ† -->
                            <div class="flex gap-2">
                                ${Array(5).fill(null).map((_, i) => {
                                    const starIndex = i + 1;
                                    return `<i class="fa fa-star text-lg cursor-pointer transition-transform hover:scale-110 ${starIndex <= course.rating ? 'star-active' : 'star-inactive'}" data-rating="${starIndex}"></i>`;
                                }).join('')}
                            </div>
                        `}
                    </div>
                </div>
                
                <!-- è¯¾å ‚ä¸è¶³åŠå»ºè®® - æ ¹æ®ç§‘ç›®ç±»å‹æ˜¾ç¤ºä¸åŒ -->
                <div>
                    ${course.subject === 'æ•°å­¦' || course.subject === 'è‹±è¯­' ? `
                        <!-- åˆ†å±‚ç­çš„è¯¾å ‚ä¸è¶³åŠå»ºè®® -->
                        <label class="block text-sm font-medium text-gray-700 mb-2">è¯¾å ‚ä¸è¶³åŠå»ºè®®</label>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">1ç­ï¼š</label>
                                <textarea placeholder="è¯·è¾“å…¥1ç­è¯¾å ‚ä¸è¶³åŠå»ºè®®" rows="2" 
                                          class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" 
                                          data-field="notes" data-id="${course.id}" data-layer="1">${course.layerNotes?.layer1 || ''}</textarea>
                                <!-- 1ç­å¿«é€Ÿé€‰æ‹©ç†ç”± -->
                                <div class="mt-2">
                                    <label class="block text-xs text-gray-500 mb-1">å¿«é€Ÿé€‰æ‹©ç†ç”±ï¼š</label>
                                    <div class="flex flex-wrap gap-2">
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ— " data-layer="1">æ— </button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸Šè¯¾è¯´è¯" data-layer="1">ä¸Šè¯¾è¯´è¯</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ç¡è§‰" data-layer="1">ç¡è§‰</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸è®°ç¬”è®°" data-layer="1">ä¸è®°ç¬”è®°</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ³¨æ„åŠ›ä¸é›†ä¸­" data-layer="1">æ³¨æ„åŠ›ä¸é›†ä¸­</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ‰°ä¹±è¯¾å ‚ç§©åº" data-layer="1">æ‰°ä¹±è¯¾å ‚ç§©åº</button>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">2ç­ï¼š</label>
                                <textarea placeholder="è¯·è¾“å…¥2ç­è¯¾å ‚ä¸è¶³åŠå»ºè®®" rows="2" 
                                          class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" 
                                          data-field="notes" data-id="${course.id}" data-layer="2">${course.layerNotes?.layer2 || ''}</textarea>
                                <!-- 2ç­å¿«é€Ÿé€‰æ‹©ç†ç”± -->
                                <div class="mt-2">
                                    <label class="block text-xs text-gray-500 mb-1">å¿«é€Ÿé€‰æ‹©ç†ç”±ï¼š</label>
                                    <div class="flex flex-wrap gap-2">
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ— " data-layer="2">æ— </button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸Šè¯¾è¯´è¯" data-layer="2">ä¸Šè¯¾è¯´è¯</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ç¡è§‰" data-layer="2">ç¡è§‰</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸è®°ç¬”è®°" data-layer="2">ä¸è®°ç¬”è®°</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ³¨æ„åŠ›ä¸é›†ä¸­" data-layer="2">æ³¨æ„åŠ›ä¸é›†ä¸­</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ‰°ä¹±è¯¾å ‚ç§©åº" data-layer="2">æ‰°ä¹±è¯¾å ‚ç§©åº</button>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">3ç­ï¼š</label>
                                <textarea placeholder="è¯·è¾“å…¥3ç­è¯¾å ‚ä¸è¶³åŠå»ºè®®" rows="2" 
                                          class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" 
                                          data-field="notes" data-id="${course.id}" data-layer="3">${course.layerNotes?.layer3 || ''}</textarea>
                                <!-- 3ç­å¿«é€Ÿé€‰æ‹©ç†ç”± -->
                                <div class="mt-2">
                                    <label class="block text-xs text-gray-500 mb-1">å¿«é€Ÿé€‰æ‹©ç†ç”±ï¼š</label>
                                    <div class="flex flex-wrap gap-2">
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ— " data-layer="3">æ— </button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸Šè¯¾è¯´è¯" data-layer="3">ä¸Šè¯¾è¯´è¯</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ç¡è§‰" data-layer="3">ç¡è§‰</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸è®°ç¬”è®°" data-layer="3">ä¸è®°ç¬”è®°</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ³¨æ„åŠ›ä¸é›†ä¸­" data-layer="3">æ³¨æ„åŠ›ä¸é›†ä¸­</button>
                                        <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ‰°ä¹±è¯¾å ‚ç§©åº" data-layer="3">æ‰°ä¹±è¯¾å ‚ç§©åº</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <!-- æ™®é€šè¯¾å ‚ä¸è¶³åŠå»ºè®® -->
                        <label class="block text-sm font-medium text-gray-700 mb-2">è¯¾å ‚ä¸è¶³åŠå»ºè®®</label>
                        <textarea placeholder="è¯·è¾“å…¥è¯¾å ‚ä¸è¶³åŠå»ºè®®" rows="2" 
                                  class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" 
                                  data-field="notes" data-id="${course.id}">${course.notes || ''}</textarea>
                        <!-- å¿«é€Ÿé€‰æ‹©ç†ç”± -->
                        <div class="mt-2">
                            <label class="block text-xs text-gray-500 mb-1">å¿«é€Ÿé€‰æ‹©ç†ç”±ï¼š</label>
                            <div class="flex flex-wrap gap-2">
                                <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ— ">æ— </button>
                                <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸Šè¯¾è¯´è¯">ä¸Šè¯¾è¯´è¯</button>
                                <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ç¡è§‰">ç¡è§‰</button>
                                <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="ä¸è®°ç¬”è®°">ä¸è®°ç¬”è®°</button>
                                <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ³¨æ„åŠ›ä¸é›†ä¸­">æ³¨æ„åŠ›ä¸é›†ä¸­</button>
                                <button class="quick-reason-btn px-2 py-0.5 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}" data-reason="æ‰°ä¹±è¯¾å ‚ç§©åº">æ‰°ä¹±è¯¾å ‚ç§©åº</button>
                            </div>
                        </div>
                    `}
                </div>
                
                <!-- å¿«é€Ÿé€‰æ‹©å­¦å·åŠŸèƒ½ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">è¡¨ç°ä¸ä½³å­¦ç”Ÿ</label>
                    <div class="mb-2">
                        <div id="course-students-${course.id}" class="flex flex-wrap gap-2 max-h-32 overflow-y-auto ios-scrollbar p-2 glass-effect border border-white/30 rounded-lg min-h-[60px]">
                            ${course.poorStudents ? course.poorStudents.map(num => `
                                <div class="inline-flex items-center glass-effect border border-white/30 bg-danger/20 text-danger px-2 py-1 rounded-full text-xs hover-lift transition-all duration-300">
                                    ${num} <span class="ml-1 cursor-pointer remove-poor-student" data-number="${num}">&times;</span>
                                </div>
                            `).join('') : '<span class="text-gray-400 text-xs">æš‚æ— é€‰æ‹©</span>'}
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-select-students-btn px-3 py-1 glass-effect border border-white/30 rounded-lg text-xs hover:bg-primary/10 transition-all duration-300" data-id="${course.id}">
                            <i class="fa fa-user-o mr-1"></i>é€‰æ‹©å­¦ç”Ÿ
                        </button>
                    </div>
                </div>`;
            
            // ç»‘å®šç§‘ç›®è¾“å…¥äº‹ä»¶
            const subjectInput = courseDiv.querySelector('[data-field="subject"]');
            subjectInput.addEventListener('input', function() {
                updateCourseData(course.id, 'subject', this.value);
            });
            
            // ç»‘å®šå¿«é€Ÿé€‰æ‹©ç§‘ç›®äº‹ä»¶
            const quickSubjectBtns = courseDiv.querySelectorAll('.quick-subject-btn');
            quickSubjectBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const courseId = parseInt(this.dataset.id);
                    const subject = this.dataset.subject;
                    
                    // æ›´æ–°ç§‘ç›®
                    updateCourseData(courseId, 'subject', subject);
                    
                    // æ›´æ–°UIä¸­çš„ç§‘ç›®è¾“å…¥æ¡†
                    const subjectInput = courseDiv.querySelector('[data-field="subject"]');
                    if (subjectInput) {
                        subjectInput.value = subject;
                    }
                    
                    // æ·»åŠ ç‚¹å‡»åŠ¨ç”»æ•ˆæœ
                    this.classList.add('bg-primary/20');
                    setTimeout(() => {
                        this.classList.remove('bg-primary/20');
                    }, 300);
                    
                    // é‡æ–°ç”Ÿæˆè¯¾ç¨‹è¡¨ä»¥æ›´æ–°è¯„åˆ†æ˜¾ç¤º
                    setTimeout(() => {
                        generateSchedule();
                    }, 50);
                });
            });
            
            // ç»‘å®šè¯„åˆ†ç‚¹å‡»äº‹ä»¶
            const ratingContainer = courseDiv.querySelector('[data-field="rating"]');
            const stars = ratingContainer.querySelectorAll('.fa-star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰åˆ†å±‚ä¿¡æ¯
                    if (this.dataset.layer) {
                        // åˆ†å±‚è¯„åˆ†é€»è¾‘
                        const layer = this.dataset.layer;
                        const courseId = parseInt(ratingContainer.dataset.id);
                        const course = scheduleData[currentDay].find(c => c.id === courseId);
                        
                        // ç¡®ä¿layerRatingså¯¹è±¡å­˜åœ¨
                        if (!course.layerRatings) {
                            course.layerRatings = { layer1: 0, layer2: 0, layer3: 0 };
                        }
                        
                        // æ›´æ–°å¯¹åº”åˆ†å±‚çš„è¯„åˆ†
                        course.layerRatings[`layer${layer}`] = rating;
                        
                        // ä¿å­˜æ•°æ®
                        saveScheduleData();
                        
                        // æ›´æ–°UI
                        generateSchedule();
                    } else {
                        // æ™®é€šè¯„åˆ†é€»è¾‘
                        updateCourseData(course.id, 'rating', rating);
                        updateStarDisplay(stars, rating);
                    }
                    
                    // æ·»åŠ ç‚¹å‡»åŠ¨ç”»æ•ˆæœ
                    this.classList.add('animate-pulse');
                    setTimeout(() => {
                        this.classList.remove('animate-pulse');
                    }, 500);
                });
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    
                    if (this.dataset.layer) {
                        // åˆ†å±‚è¯„åˆ†æ‚¬åœæ•ˆæœ
                        const layer = this.dataset.layer;
                        const layerStars = ratingContainer.querySelectorAll(`[data-layer="${layer}"]`);
                        layerStars.forEach(s => {
                            const sRating = parseInt(s.dataset.rating);
                            if (sRating <= rating) {
                                s.classList.add('scale-125');
                            }
                        });
                    } else {
                        // æ™®é€šè¯„åˆ†æ‚¬åœæ•ˆæœ
                        stars.forEach(s => {
                            const sRating = parseInt(s.dataset.rating);
                            if (sRating <= rating) {
                                s.classList.add('scale-125');
                            }
                        });
                    }
                });
                
                star.addEventListener('mouseleave', function() {
                    if (this.dataset.layer) {
                        // åˆ†å±‚è¯„åˆ†æ¢å¤
                        const layer = this.dataset.layer;
                        const layerStars = ratingContainer.querySelectorAll(`[data-layer="${layer}"]`);
                        layerStars.forEach(s => {
                            s.classList.remove('scale-125');
                        });
                    } else {
                        // æ™®é€šè¯„åˆ†æ¢å¤
                        stars.forEach(s => {
                            s.classList.remove('scale-125');
                        });
                    }
                });
            });
            
            // ç»‘å®šç¬”è®°è¾“å…¥äº‹ä»¶ - åŒæ—¶å¤„ç†æ™®é€šç¬”è®°å’Œåˆ†å±‚ç¬”è®°
            const notesInputs = courseDiv.querySelectorAll('[data-field="notes"]');
            notesInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const courseId = parseInt(this.dataset.id);
                    const layer = this.dataset.layer;
                    const course = scheduleData[currentDay].find(c => c.id === courseId);
                    
                    if (layer) {
                        // åˆ†å±‚ç¬”è®°å¤„ç†
                        if (!course.layerNotes) {
                            course.layerNotes = { layer1: '', layer2: '', layer3: '' };
                        }
                        course.layerNotes[`layer${layer}`] = this.value;
                        saveScheduleData();
                    } else {
                        // æ™®é€šç¬”è®°å¤„ç†
                        updateCourseData(course.id, 'notes', this.value);
                    }
                });
            });
            
            // ç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶
            const deleteBtn = courseDiv.querySelector('.delete-course-btn');
            deleteBtn.addEventListener('click', function() {
                const courseId = parseInt(this.dataset.id);
                deleteCourse(courseId);
            });
            
            // ç»‘å®šé€‰æ‹©å­¦ç”ŸæŒ‰é’®äº‹ä»¶
            const selectStudentsBtn = courseDiv.querySelector('.quick-select-students-btn');
            selectStudentsBtn.addEventListener('click', function() {
                const courseId = parseInt(this.dataset.id);
                showStudentSelectionModal(courseId);
            });
            
            // ç»‘å®šå¿«é€Ÿé€‰æ‹©ç†ç”±äº‹ä»¶
            const quickReasonBtns = courseDiv.querySelectorAll('.quick-reason-btn');
            quickReasonBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const courseId = parseInt(this.dataset.id);
                    const reason = this.dataset.reason;
                    handleQuickReason(courseId, reason);
                });
            });
            
            // ç»‘å®šå·²é€‰å­¦ç”Ÿç§»é™¤æŒ‰é’®äº‹ä»¶
            const removeButtons = courseDiv.querySelectorAll('.remove-poor-student');
            removeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const number = parseInt(this.dataset.number);
                    removePoorStudent(course.id, number);
                });
            });
            
            // ç»‘å®šè¯¾ç¨‹èŠ‚æ•°ç¼–è¾‘äº‹ä»¶
            const sectionNumberEl = courseDiv.querySelector('.section-number');
            sectionNumberEl.addEventListener('click', function() {
                const courseId = parseInt(this.dataset.id);
                editSectionNumber(courseId);
            });
            
            return courseDiv;
        }
        
        // æ›´æ–°è¯¾ç¨‹æ•°æ®
        function updateCourseData(courseId, field, value) {
            const courseIndex = scheduleData[currentDay].findIndex(c => c.id === courseId);
            if (courseIndex !== -1) {
                scheduleData[currentDay][courseIndex][field] = value;
                // è‡ªåŠ¨ä¿å­˜åˆ° IndexedDB
                saveScheduleData();
            }
        }
        
        // æ›´æ–°è¡¨ç°ä¸ä½³å­¦ç”Ÿåˆ—è¡¨
        function updatePoorStudents(courseId, students) {
            const courseIndex = scheduleData[currentDay].findIndex(c => c.id === courseId);
            if (courseIndex !== -1) {
                scheduleData[currentDay][courseIndex].poorStudents = students;
                // è‡ªåŠ¨ä¿å­˜åˆ° IndexedDB
                saveScheduleData();
            }
        }
        
        // åˆ›å»ºå­¦ç”Ÿé€‰æ‹©æ¨¡æ€æ¡†
        function createStudentSelectionModal() {
            const modal = document.createElement('div');
            modal.id = 'student-selection-modal';
            modal.className = 'fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-white/20">
                        <h2 class="text-2xl font-bold text-dark flex items-center gap-2">
                            <i class="fa fa-users text-primary"></i>
                            é€‰æ‹©è¡¨ç°ä¸ä½³å­¦ç”Ÿ
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©å­¦å·</label>
                            <div id="modal-student-numbers" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto scrollbar-hide p-3 glass-effect border border-white/30 rounded-xl"></div>
                        </div>
                        
                        <!-- å·²é€‰å­¦å·åˆ—è¡¨ -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                å·²é€‰æ‹©çš„å­¦å·
                                <span id="selected-count" class="ml-2 text-xs text-gray-500">(0)</span>
                            </label>
                            <div id="selected-students-list" class="flex flex-wrap gap-2 max-h-24 overflow-y-auto scrollbar-hide p-3 glass-effect border border-primary/30 bg-primary/5 rounded-xl">
                                <span class="text-gray-400 text-sm">æš‚æ— é€‰æ‹©</span>
                            </div>
                        </div>
                        
                        <div class="flex gap-3 p-4 glass-effect border border-white/20 rounded-xl">
                            <button id="modal-select-all-btn" class="px-4 py-2 glass-effect border border-white/30 rounded-lg text-sm hover:bg-primary/10 transition-all duration-300">
                                å…¨é€‰
                            </button>
                            <button id="modal-clear-all-btn" class="px-4 py-2 glass-effect border border-white/30 rounded-lg text-sm hover:bg-primary/10 transition-all duration-300">
                                æ¸…ç©ºé€‰æ‹©
                            </button>
                        </div>
                    </div>
                    <div class="p-6 border-t border-white/20 flex justify-end gap-3">
                        <button id="modal-cancel" class="px-5 py-2.5 glass-effect border border-white/30 rounded-lg hover:bg-gray-100/50 transition-all duration-300">å–æ¶ˆ</button>
                        <button id="modal-confirm" class="px-5 py-2.5 gradient-border bg-primary hover:bg-primary/90 text-white rounded-lg transition-all duration-300 hover:shadow-lg">ç¡®è®¤é€‰æ‹©</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // æ›´æ–°å·²é€‰å­¦ç”Ÿåˆ—è¡¨
            function updateSelectedStudentsList(selectedStudents) {
                const listContainer = document.getElementById('selected-students-list');
                const countElement = document.getElementById('selected-count');
                
                // ç¡®ä¿å…ƒç´ å­˜åœ¨
                if (!listContainer || !countElement) return;
                
                // æ›´æ–°è®¡æ•°
                countElement.textContent = `(${selectedStudents.length})`;
                
                // æ¸…ç©ºåˆ—è¡¨
                listContainer.innerHTML = '';
                
                if (selectedStudents.length === 0) {
                    // å¦‚æœæ²¡æœ‰é€‰æ‹©å­¦ç”Ÿï¼Œæ˜¾ç¤ºæç¤ºæ–‡æœ¬
                    const emptyText = document.createElement('span');
                    emptyText.className = 'text-gray-400 text-sm';
                    emptyText.textContent = 'æš‚æ— é€‰æ‹©';
                    listContainer.appendChild(emptyText);
                } else {
                    // æ’åºåæ˜¾ç¤ºé€‰ä¸­çš„å­¦ç”Ÿ
                    const sortedStudents = [...selectedStudents].sort((a, b) => a - b);
                    sortedStudents.forEach(studentId => {
                        const tag = document.createElement('span');
                        tag.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/20 text-primary';
                        tag.textContent = studentId;
                        
                        // æ·»åŠ ç§»é™¤æŒ‰é’®
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'ml-1 text-primary hover:text-primary/70 focus:outline-none';
                        removeBtn.textContent = 'Ã—';
                        removeBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            const modal = document.getElementById('student-selection-modal');
                            if (modal) {
                                const courseId = parseInt(modal.dataset.courseId);
                                const course = scheduleData[currentDay].find(c => c.id === courseId);
                                if (course) {
                                    // ä»å·²é€‰åˆ—è¡¨ä¸­ç§»é™¤è¯¥å­¦ç”Ÿ
                                    course.poorStudents = course.poorStudents.filter(id => id !== studentId);
                                    // æ›´æ–°UI
                                    updateModalStudentButtons(course.poorStudents);
                                    updateSelectedStudentsList(course.poorStudents);
                                }
                            }
                        });
                        
                        tag.appendChild(removeBtn);
                        listContainer.appendChild(tag);
                    });
                }
            }
            
            // æ˜¾ç¤ºå­¦ç”Ÿé€‰æ‹©æ¨¡æ€æ¡†
        function showStudentSelectionModal(courseId) {
            let modal = document.getElementById('student-selection-modal');
            if (!modal) {
                createStudentSelectionModal();
                bindStudentSelectionModalEvents();
                // é‡æ–°è·å–åˆ›å»ºåçš„æ¨¡æ€æ¡†å…ƒç´ 
                modal = document.getElementById('student-selection-modal');
            }
            
            // ç¡®ä¿æ¨¡æ€æ¡†å­˜åœ¨åå†è®¿é—®dataset
            if (modal) {
                // ä¿å­˜å½“å‰è¯¾ç¨‹ID
                modal.dataset.courseId = courseId;
            } else {
                console.error('æ— æ³•åˆ›å»ºæˆ–è·å–å­¦ç”Ÿé€‰æ‹©æ¨¡æ€æ¡†');
                return;
            }
            
            // è·å–å½“å‰è¯¾ç¨‹çš„è¡¨ç°ä¸ä½³å­¦ç”Ÿåˆ—è¡¨
            const course = scheduleData[currentDay].find(c => c.id === courseId);
            const currentPoorStudents = course ? course.poorStudents : [];
            
            // ç”Ÿæˆå­¦å·é€‰æ‹©æŒ‰é’®
            const container = document.getElementById('modal-student-numbers');
            container.innerHTML = '';
            
            // æ ¹æ®é…ç½®ç”Ÿæˆå­¦å·æŒ‰é’®
            for (let i = classConfig.minStudentId; i <= classConfig.maxStudentId; i++) {
                // è·³è¿‡æ’é™¤çš„å­¦å·
                if (classConfig.excludedIds.includes(i)) continue;
                
                const button = document.createElement('button');
                button.className = 'student-number-btn w-10 h-10 flex items-center justify-center rounded-full glass-effect border border-white/30 hover:bg-primary/10 transition-all duration-300 hover-lift';
                button.textContent = i;
                button.dataset.number = i;
                
                // å¦‚æœå·²ç»åœ¨è¡¨ç°ä¸ä½³å­¦ç”Ÿåˆ—è¡¨ä¸­ï¼Œæ ‡è®°ä¸ºé€‰ä¸­
                if (currentPoorStudents.includes(i)) {
                    button.classList.add('bg-primary/20', 'border-primary');
                }
                
                button.addEventListener('click', function() {
                    const number = parseInt(this.dataset.number);
                    const index = currentPoorStudents.indexOf(number);
                    
                    if (index === -1) {
                        currentPoorStudents.push(number);
                        this.classList.add('bg-primary/20', 'border-primary');
                    } else {
                        currentPoorStudents.splice(index, 1);
                        this.classList.remove('bg-primary/20', 'border-primary');
                    }
                    
                    // æ›´æ–°å·²é€‰å­¦å·åˆ—è¡¨
                    updateSelectedStudentsList(currentPoorStudents);
                });
                
                container.appendChild(button);
            }
            
            // åˆå§‹åŒ–å·²é€‰å­¦å·åˆ—è¡¨
            updateSelectedStudentsList(currentPoorStudents);
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // å…³é—­å­¦ç”Ÿé€‰æ‹©æ¨¡æ€æ¡†
        function closeStudentSelectionModal() {
            const modal = document.getElementById('student-selection-modal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }
        
        // ç»‘å®šå­¦ç”Ÿé€‰æ‹©æ¨¡æ€æ¡†äº‹ä»¶
        function bindStudentSelectionModalEvents() {
            const modal = document.getElementById('student-selection-modal');
            if (!modal) return;
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('modal-cancel').addEventListener('click', closeStudentSelectionModal);
            
            // ç¡®è®¤æŒ‰é’®
            document.getElementById('modal-confirm').addEventListener('click', function() {
                const courseId = parseInt(modal.dataset.courseId);
                const course = scheduleData[currentDay].find(c => c.id === courseId);
                
                if (course) {
                    // æ›´æ–°è¯¾ç¨‹çš„è¡¨ç°ä¸ä½³å­¦ç”Ÿåˆ—è¡¨
                    updatePoorStudents(courseId, course.poorStudents.sort((a, b) => a - b));
                    
                    // æ›´æ–°UIæ˜¾ç¤º
                    const container = document.getElementById(`course-students-${courseId}`);
                    if (container) {
                        if (course.poorStudents.length === 0) {
                            container.innerHTML = '<span class="text-gray-400 text-xs">æš‚æ— é€‰æ‹©</span>';
                        } else {
                            container.innerHTML = course.poorStudents.map(num => `
                                <div class="inline-flex items-center glass-effect border border-white/30 bg-danger/20 text-danger px-2 py-1 rounded-full text-xs hover-lift transition-all duration-300">
                                    ${num} <span class="ml-1 cursor-pointer remove-poor-student" data-number="${num}" data-id="${courseId}">&times;</span>
                                </div>
                            `).join('');
                            
                            // ç»‘å®šç§»é™¤æŒ‰é’®äº‹ä»¶
                            container.querySelectorAll('.remove-poor-student').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const number = parseInt(this.dataset.number);
                                    const courseId = parseInt(this.dataset.id);
                                    removePoorStudent(courseId, number);
                                });
                            });
                        }
                    }
                }
                
                closeStudentSelectionModal();
            });
            
            // æ¨¡æ€æ¡†æ‰¹é‡æ“ä½œæŒ‰é’®
            document.getElementById('modal-select-all-btn').addEventListener('click', function() {
                const courseId = parseInt(modal.dataset.courseId);
                const course = scheduleData[currentDay].find(c => c.id === courseId);
                if (course) {
                    course.poorStudents = [];
                    
                    for (let i = classConfig.minStudentId; i <= classConfig.maxStudentId; i++) {
                        if (!classConfig.excludedIds.includes(i)) {
                            course.poorStudents.push(i);
                        }
                    }
                    
                    // æ›´æ–°UI
                    updateModalStudentButtons(course.poorStudents);
                    updateSelectedStudentsList(course.poorStudents);
                }
            });
            
            // ç§»é™¤èŒƒå›´é€‰æ‹©åŠŸèƒ½
            
            document.getElementById('modal-clear-all-btn').addEventListener('click', function() {
                const courseId = parseInt(modal.dataset.courseId);
                const course = scheduleData[currentDay].find(c => c.id === courseId);
                if (course) {
                    course.poorStudents = [];
                    updateModalStudentButtons([]);
                    updateSelectedStudentsList([]);
                }
            });
            
            // ç§»é™¤èŒƒå›´å†…çš„updateSelectedStudentsListå‡½æ•°å®šä¹‰
        }
        
        // æ›´æ–°æ¨¡æ€æ¡†ä¸­çš„å­¦å·æŒ‰é’®çŠ¶æ€
        function updateModalStudentButtons(selectedNumbers) {
            document.querySelectorAll('#modal-student-numbers .student-number-btn').forEach(button => {
                const number = parseInt(button.dataset.number);
                if (selectedNumbers.includes(number)) {
                    button.classList.add('bg-primary/20', 'border-primary');
                } else {
                    button.classList.remove('bg-primary/20', 'border-primary');
                }
            });
        }
        
        // ç§»é™¤è¡¨ç°ä¸ä½³å­¦ç”Ÿ
        function removePoorStudent(courseId, number) {
            const course = scheduleData[currentDay].find(c => c.id === courseId);
            if (course) {
                const index = course.poorStudents.indexOf(number);
                if (index !== -1) {
                    course.poorStudents.splice(index, 1);
                    updatePoorStudents(courseId, course.poorStudents);
                    
                    // æ›´æ–°UI
                    const container = document.getElementById(`course-students-${courseId}`);
                    if (container) {
                        if (course.poorStudents.length === 0) {
                            container.innerHTML = '<span class="text-gray-400 text-xs">æš‚æ— é€‰æ‹©</span>';
                        } else {
                            container.innerHTML = course.poorStudents.map(num => `
                                <div class="inline-flex items-center glass-effect border border-white/30 bg-danger/20 text-danger px-2 py-1 rounded-full text-xs hover-lift transition-all duration-300">
                                    ${num} <span class="ml-1 cursor-pointer remove-poor-student" data-number="${num}" data-id="${courseId}">&times;</span>
                                </div>
                            `).join('');
                            
                            // é‡æ–°ç»‘å®šç§»é™¤æŒ‰é’®äº‹ä»¶
                            container.querySelectorAll('.remove-poor-student').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const number = parseInt(this.dataset.number);
                                    const courseId = parseInt(this.dataset.id);
                                    removePoorStudent(courseId, number);
                                });
                            });
                        }
                    }
                }
            }
        }
        
        // å¤„ç†å¿«é€Ÿé€‰æ‹©ç†ç”±
        function handleQuickReason(courseId, reason) {
            // è·å–è§¦å‘äº‹ä»¶çš„æŒ‰é’®ï¼Œä»ä¸­è·å–layerä¿¡æ¯
            const event = window.event;
            const reasonBtn = event ? event.currentTarget : document.querySelector(`.quick-reason-btn[data-id="${courseId}"][data-reason="${reason}"]`);
            const layer = reasonBtn ? reasonBtn.dataset.layer : '1'; // é»˜è®¤ä½¿ç”¨1ç­
            const layerKey = `layer${layer}`;
            
            const course = scheduleData[currentDay].find(c => c.id === courseId);
            if (course) {
                // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ†å±‚ç§‘ç›®ï¼ˆæ•°å­¦æˆ–è‹±è¯­ï¼‰
                if (course.subject === 'æ•°å­¦' || course.subject === 'è‹±è¯­') {
                    // åˆ†å±‚ç§‘ç›® - æ ¹æ®data-layerå±æ€§ç¡®å®šç­çº§
                    if (!course.layerNotes) {
                        course.layerNotes = { layer1: '', layer2: '', layer3: '' };
                    }
                    
                    let newNote = course.layerNotes[layerKey] || '';
                    if (newNote) {
                        if (!newNote.includes(reason)) {
                            newNote += 'ï¼Œ' + reason;
                        }
                    } else {
                        newNote = reason;
                    }
                    
                    course.layerNotes[layerKey] = newNote;
                    saveScheduleData();
                    
                    // æ›´æ–°UI
                    const notesInput = document.querySelector(`textarea[data-field="notes"][data-id="${courseId}"][data-layer="${layer}"]`);
                    if (notesInput) {
                        notesInput.value = newNote;
                    }
                } else {
                    // æ™®é€šç§‘ç›®å¤„ç†
                    let newNotes = course.notes || '';
                    if (newNotes) {
                        // æ£€æŸ¥æ˜¯å¦å·²ç»åŒ…å«è¯¥ç†ç”±
                        if (!newNotes.includes(reason)) {
                            newNotes += 'ï¼Œ' + reason;
                        }
                    } else {
                        newNotes = reason;
                    }
                    
                    // æ›´æ–°å¤‡æ³¨
                    updateCourseData(courseId, 'notes', newNotes);
                    
                    // æ›´æ–°UI
                    const notesInput = document.querySelector(`textarea[data-field="notes"][data-id="${courseId}"]:not([data-layer])`);
                    if (notesInput) {
                        notesInput.value = newNotes;
                    }
                }
                
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»æ•ˆæœ
                if (reasonBtn) {
                    reasonBtn.classList.add('bg-primary/20');
                    setTimeout(() => {
                        reasonBtn.classList.remove('bg-primary/20');
                    }, 300);
                }
            }
        }
        
        // æ›´æ–°æ˜Ÿæ˜Ÿæ˜¾ç¤º
        function updateStarDisplay(stars, rating) {
            stars.forEach(star => {
                const starRating = parseInt(star.dataset.rating);
                if (starRating <= rating) {
                    star.classList.add('star-active');
                    star.classList.remove('star-inactive');
                } else {
                    star.classList.remove('star-active');
                    star.classList.add('star-inactive');
                }
            });
        }
        
        // æ·»åŠ æ–°è¯¾ç¨‹
        function addNewCourse() {
            // è·å–å½“å‰æ˜ŸæœŸçš„è¯¾ç¨‹æ•°æ®
            const courses = scheduleData[currentDay];
            
            // è®¡ç®—æ–°è¯¾ç¨‹çš„IDï¼ˆå½“å‰æœ€å¤§ID + 1ï¼‰
            const maxId = courses.length > 0 ? Math.max(...courses.map(c => c.id)) : 0;
            const newCourse = { id: maxId + 1, subject: '', rating: 0, notes: '' };
            
            // æ·»åŠ æ–°è¯¾ç¨‹åˆ°æ•°æ®ä¸­
            courses.push(newCourse);
            
            // æ›´æ–°è¯¾ç¨‹è¡¨æ˜¾ç¤º
            generateSchedule();
            
            // ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ»šåŠ¨åˆ°æœ€åæ·»åŠ çš„è¯¾ç¨‹
            const container = document.getElementById('schedule-container');
            container.scrollTop = container.scrollHeight;
            
            // é«˜äº®æ˜¾ç¤ºæ–°æ·»åŠ çš„è¯¾ç¨‹ï¼ˆæ·»åŠ ä¸€ä¸ªä¸´æ—¶åŠ¨ç”»æ•ˆæœï¼‰
            setTimeout(() => {
                const newCourseElement = container.lastElementChild;
                if (newCourseElement) {
                    newCourseElement.classList.add('bg-primary/10');
                    setTimeout(() => {
                        newCourseElement.classList.remove('bg-primary/10');
                    }, 2000);
                }
            }, 100);
        }
        
        // åˆ é™¤è¯¾ç¨‹
        function deleteCourse(courseId) {
            // åˆ›å»ºè‡ªå®šä¹‰æ¯›ç»ç’ƒé£æ ¼çš„ç¡®è®¤å¼¹çª—
            const confirmationModal = document.createElement('div');
            confirmationModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            confirmationModal.innerHTML = `
                <div class="glass-effect rounded-xl p-6 max-w-md w-full border border-white/30 shadow-xl">
                    <h3 class="text-xl font-bold text-dark mb-4">ç¡®è®¤åˆ é™¤</h3>
                    <p class="text-gray-700 mb-6">ç¡®å®šè¦åˆ é™¤è¿™èŠ‚è¯¾å—ï¼Ÿ</p>
                    <div class="flex gap-3 justify-end">
                        <button id="confirm-cancel" class="px-5 py-2.5 glass-effect border border-white/30 rounded-lg hover:bg-gray-100/50 transition-all duration-300">å–æ¶ˆ</button>
                        <button id="confirm-delete" class="px-5 py-2.5 gradient-border bg-danger hover:bg-danger/90 text-white rounded-lg transition-all duration-300 hover:shadow-lg">ç¡®è®¤åˆ é™¤</button>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°æ–‡æ¡£ä¸­
            document.body.appendChild(confirmationModal);
            document.body.style.overflow = 'hidden';
            
            // ç»‘å®šå–æ¶ˆæŒ‰é’®äº‹ä»¶
            confirmationModal.querySelector('#confirm-cancel').addEventListener('click', function() {
                document.body.removeChild(confirmationModal);
                document.body.style.overflow = '';
            });
            
            // ç»‘å®šç¡®è®¤åˆ é™¤æŒ‰é’®äº‹ä»¶
            confirmationModal.querySelector('#confirm-delete').addEventListener('click', function() {
                document.body.removeChild(confirmationModal);
                document.body.style.overflow = '';
                
                // è·å–å½“å‰æ˜ŸæœŸçš„è¯¾ç¨‹æ•°æ®
                const courses = scheduleData[currentDay];
                
                // æ‰¾åˆ°è¦åˆ é™¤çš„è¯¾ç¨‹ç´¢å¼•
                const courseIndex = courses.findIndex(c => c.id === courseId);
                
                if (courseIndex !== -1) {
                    // è·å–è¦åˆ é™¤çš„å…ƒç´ è¿›è¡ŒåŠ¨ç”»æ•ˆæœ
                    const container = document.getElementById('schedule-container');
                    const courseElements = container.querySelectorAll('.glass-effect.rounded-xl.p-5');
                    const elementToDelete = courseElements[courseIndex];
                    
                    if (elementToDelete) {
                        // æ·»åŠ åˆ é™¤åŠ¨ç”»
                        elementToDelete.style.transition = 'all 0.3s ease';
                        elementToDelete.style.opacity = '0';
                        elementToDelete.style.transform = 'translateX(20px)';
                        elementToDelete.style.height = elementToDelete.offsetHeight + 'px';
                    }
                    
                    // ä»æ•°æ®ä¸­åˆ é™¤è¯¾ç¨‹
                    setTimeout(() => {
                        courses.splice(courseIndex, 1);
                        
                        // é‡æ–°ç”Ÿæˆè¯¾ç¨‹è¡¨
                        generateSchedule();
                    }, 300);
                }
            });
            
            // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­åŠŸèƒ½
            confirmationModal.addEventListener('click', function(e) {
                if (e.target === confirmationModal) {
                    document.body.removeChild(confirmationModal);
                    document.body.style.overflow = '';
                }
            });
        }
        
        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        function bindEventListeners() {
            // æ˜ŸæœŸåˆ‡æ¢æŒ‰é’®
            document.querySelectorAll('.day-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.day-btn').forEach(b => {
                        b.classList.remove('gradient-border', 'bg-primary', 'text-white');
                        b.classList.add('glass-effect', 'border', 'border-white/30', 'hover:bg-primary/10');
                    });
                    
                    this.classList.add('gradient-border', 'bg-primary', 'text-white');
                    this.classList.remove('glass-effect', 'border', 'border-white/30', 'hover:bg-primary/10');
                    
                    // æ·»åŠ åˆ‡æ¢åŠ¨ç”»æ•ˆæœ
                    const container = document.getElementById('schedule-container');
                    container.style.opacity = '0';
                    container.style.transform = 'translateY(20px)';
                    container.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    
                    setTimeout(() => {
                        generateSchedule();
                        container.style.opacity = '1';
                        container.style.transform = 'translateY(0)';
                    }, 150);
                    
                    currentDay = this.dataset.day;
                    generateSchedule();
                });
            });
            
            // åˆ›å»ºè‡ªå®šä¹‰ç§‘ç›®æ¨¡æ€æ¡†
            function createCustomSubjectModal() {
                const modal = document.createElement('div');
                modal.id = 'custom-subject-modal';
                modal.className = 'fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4';
                modal.innerHTML = `
                    <div class="glass-effect rounded-2xl w-full max-w-md p-6">
                        <div class="p-4 border-b border-white/20 mb-4">
                            <h2 class="text-xl font-bold text-dark">è‡ªå®šä¹‰ç§‘ç›®</h2>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label for="custom-subject-input" class="block text-sm font-medium text-gray-700 mb-2">è¯·è¾“å…¥ç§‘ç›®åç§°</label>
                                <input 
                                    type="text" 
                                    id="custom-subject-input" 
                                    class="w-full px-4 py-3 glass-effect border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300"
                                    placeholder="ä¾‹å¦‚ï¼šç§‘æŠ€ã€ç»¼åˆå®è·µç­‰"
                                >
                            </div>
                            <div class="flex gap-3">
                                <button id="custom-subject-cancel" class="flex-1 px-4 py-3 glass-effect border border-white/30 rounded-xl hover:bg-gray-200/20 transition-all duration-300">
                                    å–æ¶ˆ
                                </button>
                                <button id="custom-subject-confirm" class="flex-1 px-4 py-3 gradient-border bg-primary hover:bg-primary/90 text-white rounded-xl transition-all duration-300 hover:shadow-lg">
                                    ç¡®è®¤
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬
                document.getElementById('custom-subject-cancel').addEventListener('click', function() {
                    modal.classList.add('hidden');
                    document.getElementById('custom-subject-input').value = '';
                });
            }
            
            // åˆ›å»ºè‡ªå®šä¹‰ç§‘ç›®æ¨¡æ€æ¡†
            createCustomSubjectModal();
            
            // æ·»åŠ æœªäº¤ä½œä¸šè®°å½•
            document.getElementById('add-homework-record').addEventListener('click', function() {
                let subject = document.getElementById('selected-subject-text').textContent;
                
                // æ£€æŸ¥æ˜¯å¦å·²é€‰æ‹©ç§‘ç›®
                if (subject === 'è¯·é€‰æ‹©ç§‘ç›®') {
                    showToast('è¯·å…ˆé€‰æ‹©ç§‘ç›®ï¼', 'error');
                    return;
                }
                
                // å¤„ç†è‡ªå®šä¹‰ç§‘ç›®
                if (subject === 'è‡ªå®šä¹‰') {
                    // æ˜¾ç¤ºæ¯›ç»ç’ƒæ¨¡æ€æ¡†
                    const modal = document.getElementById('custom-subject-modal');
                    modal.classList.remove('hidden');
                    
                    // ä¿å­˜å½“å‰é€‰ä¸­çš„å­¦ç”Ÿ
                    const currentSelectedStudents = [...selectedStudentNumbers];
                    
                    // é‡æ–°ç»‘å®šç¡®è®¤æŒ‰é’®äº‹ä»¶ï¼Œé¿å…å¤šæ¬¡ç»‘å®š
                    const confirmBtn = document.getElementById('custom-subject-confirm');
                    const newConfirmHandler = function() {
                        subject = document.getElementById('custom-subject-input').value;
                        if (!subject || subject.trim() === '') {
                            showToast('ç§‘ç›®åç§°ä¸èƒ½ä¸ºç©º', 'error');
                            return;
                        }
                        
                        // å…³é—­æ¨¡æ€æ¡†
                        modal.classList.add('hidden');
                        document.getElementById('custom-subject-input').value = '';
                        
                        // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
                        confirmBtn.removeEventListener('click', newConfirmHandler);
                        
                        // ç»§ç»­æ·»åŠ è®°å½•çš„é€»è¾‘
                        if (currentSelectedStudents.length === 0) {
                            showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€åæœªäº¤ä½œä¸šçš„å­¦ç”Ÿ', 'error');
                            return;
                        }
                        
                        const record = {
                            id: Date.now(),
                            subject: subject,
                            students: [...currentSelectedStudents],
                            date: new Date().toLocaleDateString('zh-CN')
                        };
                        
                        homeworkRecords.push(record);
                        displayHomeworkRecords();
                        // ä¿å­˜åˆ° IndexedDB
                        saveHomeworkRecords();
                        
                        // æ¸…ç©ºé€‰æ‹©
                        currentSelectedStudents.forEach(number => {
                            const button = document.querySelector(`.student-number-btn[data-number="${number}"]`);
                            if (button) button.classList.remove('bg-primary/20', 'border-primary');
                        });
                        selectedStudentNumbers = [];
                        updateSelectedNumbersDisplay();
                    };
                    
                    // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨å¹¶æ·»åŠ æ–°çš„
                    confirmBtn.removeEventListener('click', confirmBtn._lastHandler);
                    confirmBtn.addEventListener('click', newConfirmHandler);
                    confirmBtn._lastHandler = newConfirmHandler;
                    
                    // é˜²æ­¢é»˜è®¤æäº¤
                    return false;
                }
                
                if (selectedStudentNumbers.length === 0) {
                    showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€åæœªäº¤ä½œä¸šçš„å­¦ç”Ÿ', 'error');
                    return;
                }
                
                const record = {
                    id: Date.now(),
                    subject: subject,
                    students: [...selectedStudentNumbers],
                    date: new Date().toLocaleDateString('zh-CN')
                };
                
                homeworkRecords.push(record);
                displayHomeworkRecords();
                // ä¿å­˜åˆ° IndexedDB
                saveHomeworkRecords();
                
                // æ¸…ç©ºé€‰æ‹©
                selectedStudentNumbers.forEach(number => {
                    const button = document.querySelector(`.student-number-btn[data-number="${number}"]`);
                    if (button) button.classList.remove('bg-primary/20', 'border-primary');
                });
                selectedStudentNumbers = [];
                updateSelectedNumbersDisplay();
            });
            
            // å¯¼å‡ºExcel
            document.getElementById('export-excel').addEventListener('click', function() {
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»æ•ˆæœ
                this.classList.add('animate-pulse');
                setTimeout(() => {
                    this.classList.remove('animate-pulse');
                    exportToExcel();
                }, 300);
            });
            
            // æ·»åŠ æ»šåŠ¨æ—¶çš„è§†å·®æ•ˆæœ
            window.addEventListener('scroll', function() {
                const scrollY = window.scrollY;
                const header = document.querySelector('header');
                header.style.transform = `translateY(${scrollY * 0.1}px)`;
            });
            
            // æ·»åŠ æ–°è¯¾æŒ‰é’®äº‹ä»¶
            document.getElementById('add-new-course').addEventListener('click', function() {
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»æ•ˆæœ
                this.classList.add('animate-pulse');
                setTimeout(() => {
                    this.classList.remove('animate-pulse');
                    addNewCourse();
                }, 300);
            });
        }
        
        // æ˜¾ç¤ºæœªäº¤ä½œä¸šè®°å½•
        function displayHomeworkRecords() {
            const container = document.getElementById('homework-records');
            container.innerHTML = '';
            
            homeworkRecords.forEach(record => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'glass-effect p-4 rounded-xl shadow-sm border border-white/30 relative hover-lift transition-all duration-300';
                recordDiv.innerHTML = `
                    <div class="text-sm text-gray-500">${record.date}</div>
                    <div class="font-medium text-dark">${record.subject}</div>
                    <div class="text-sm">æœªäº¤å­¦å·: ${record.students.sort((a, b) => a - b).join(', ')}</div>
                    <button class="absolute top-2 right-2 text-gray-400 hover:text-danger transition-colors delete-record" data-id="${record.id}">
                        <i class="fa fa-times"></i>
                    </button>
                `;
                
                const deleteBtn = recordDiv.querySelector('.delete-record');
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°çˆ¶å…ƒç´ 
                    const recordId = parseInt(this.dataset.id);
                    // ä»å†…å­˜ä¸­ç§»é™¤è®°å½•
                    homeworkRecords = homeworkRecords.filter(r => r.id !== recordId);
                    
                    // ä»IndexedDBä¸­ç§»é™¤è®°å½•
                    if (db) {
                        const transaction = db.transaction(['homework'], 'readwrite');
                        const store = transaction.objectStore('homework');
                        store.delete(recordId);
                        
                        transaction.oncomplete = () => {
                            console.log('è®°å½•ä»æ•°æ®åº“ä¸­åˆ é™¤æˆåŠŸ');
                        };
                        
                        transaction.onerror = () => {
                            console.error('è®°å½•ä»æ•°æ®åº“ä¸­åˆ é™¤å¤±è´¥');
                        };
                    }
                    
                    // æ›´æ–°UIæ˜¾ç¤º
                    displayHomeworkRecords();
                });
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ä»¥ç¼–è¾‘å­¦ç”Ÿåå•
                recordDiv.addEventListener('click', function() {
                    const recordId = parseInt(this.querySelector('.delete-record').dataset.id);
                    openEditHomeworkModal(recordId);
                });
                
                container.appendChild(recordDiv);
            });
            
            if (homeworkRecords.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">æš‚æ— è®°å½•</div>';
            }
        }
        
        // åˆ›å»ºç¼–è¾‘æœªäº¤ä½œä¸šè®°å½•çš„æ¨¡æ€æ¡†
        function createEditHomeworkModal() {
            // ç¡®ä¿æ¨¡æ€æ¡†åªåˆ›å»ºä¸€æ¬¡
            let modal = document.getElementById('edit-homework-modal');
            if (modal) {
                return modal;
            }
            
            modal = document.createElement('div');
            modal.id = 'edit-homework-modal';
            modal.className = 'fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="glass-effect rounded-2xl w-full max-w-md">
                    <div class="p-6 border-b border-white/20">
                        <h2 class="text-xl font-bold text-dark">ä¿®æ”¹æœªäº¤ä½œä¸šå­¦ç”Ÿ</h2>
                    </div>
                    <div class="p-6">
                        <div class="mb-4">
                            <div class="text-sm text-gray-500 mb-1" id="modal-record-date"></div>
                            <div class="font-medium text-dark mb-4" id="modal-record-subject"></div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©æœªäº¤ä½œä¸šå­¦ç”Ÿå­¦å·</label>
                            <div id="modal-student-selector" class="flex flex-wrap gap-2 max-h-64 overflow-y-auto scrollbar-hide p-3 glass-effect border border-white/30 rounded-xl"></div>
                        </div>
                        <div class="flex gap-3">
                            <button id="modal-cancel-edit" class="flex-1 px-4 py-3 glass-effect border border-white/30 rounded-xl hover:bg-gray-200/20 transition-all duration-300">
                                å–æ¶ˆ
                            </button>
                            <button id="modal-confirm-edit" class="flex-1 px-4 py-3 gradient-border bg-primary hover:bg-primary/90 text-white rounded-xl transition-all duration-300 hover:shadow-lg">
                                ç¡®è®¤ä¿®æ”¹
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // æ·»åŠ å…³é—­äº‹ä»¶
            document.getElementById('modal-cancel-edit').addEventListener('click', function() {
                modal.classList.add('hidden');
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
            
            // ç¡®è®¤ä¿®æ”¹äº‹ä»¶
            document.getElementById('modal-confirm-edit').addEventListener('click', function() {
                const recordId = parseInt(modal.dataset.recordId);
                const selectedStudents = Array.from(document.querySelectorAll('#modal-student-selector .student-number-btn'))
                    .filter(btn => btn.classList.contains('selected'))
                    .map(btn => parseInt(btn.dataset.number));
                
                if (selectedStudents.length === 0) {
                    showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€åæœªäº¤ä½œä¸šçš„å­¦ç”Ÿ', 'error');
                    return;
                }
                
                // æ›´æ–°å†…å­˜ä¸­çš„è®°å½•
                const recordIndex = homeworkRecords.findIndex(r => r.id === recordId);
                if (recordIndex !== -1) {
                    homeworkRecords[recordIndex].students = [...selectedStudents];
                    
                    // æ›´æ–°IndexedDB
                    if (db) {
                        const transaction = db.transaction(['homework'], 'readwrite');
                        const store = transaction.objectStore('homework');
                        store.put(homeworkRecords[recordIndex]);
                        
                        transaction.oncomplete = () => {
                            console.log('è®°å½•æ›´æ–°æˆåŠŸ');
                        };
                        
                        transaction.onerror = () => {
                            console.error('è®°å½•æ›´æ–°å¤±è´¥');
                        };
                    }
                    
                    // æ›´æ–°UI
                    displayHomeworkRecords();
                    showToast('ä¿®æ”¹æˆåŠŸ', 'success');
                }
                
                // å…³é—­æ¨¡æ€æ¡†
                modal.classList.add('hidden');
            });
            
            return modal;
        }
        
        // æ‰“å¼€ç¼–è¾‘æœªäº¤ä½œä¸šè®°å½•æ¨¡æ€æ¡†
        function openEditHomeworkModal(recordId) {
            // è·å–æˆ–åˆ›å»ºæ¨¡æ€æ¡†
            const modal = createEditHomeworkModal();
            
            // ä¿å­˜å½“å‰è®°å½•ID
            modal.dataset.recordId = recordId;
            
            // è·å–è®°å½•æ•°æ®
            const record = homeworkRecords.find(r => r.id === recordId);
            if (record) {
                // è®¾ç½®è®°å½•ä¿¡æ¯
                document.getElementById('modal-record-date').textContent = record.date;
                document.getElementById('modal-record-subject').textContent = record.subject;
                
                // ç”Ÿæˆå­¦å·é€‰æ‹©æŒ‰é’®
                const container = document.getElementById('modal-student-selector');
                container.innerHTML = '';
                
                // æ·»åŠ é€‰ä¸­æ ·å¼çš„CSSï¼ˆç¡®ä¿æ¯æ¬¡æ‰“å¼€æ¨¡æ€æ¡†æ—¶éƒ½åº”ç”¨ï¼‰
                if (!document.querySelector('#edit-homework-modal-style')) {
                    const style = document.createElement('style');
                    style.id = 'edit-homework-modal-style';
                    style.textContent = `
                        .student-number-btn.selected {
                            background-color: rgba(59, 130, 246, 0.2); /* primary color with 20% opacity */
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥å¤„ç†æŒ‰é’®ç‚¹å‡»
                function handleButtonClick() {
                    if (this.classList.contains('selected')) {
                        // å–æ¶ˆé€‰æ‹©
                        this.classList.remove('selected');
                        this.classList.remove('border-primary');
                        this.dataset.selected = 'false';
                    } else {
                        // é€‰æ‹©
                        this.classList.add('selected', 'border-primary');
                        this.dataset.selected = 'true';
                    }
                }
                
                // æ ¹æ®é…ç½®ç”Ÿæˆå­¦å·æŒ‰é’®
                for (let i = classConfig.minStudentId; i <= classConfig.maxStudentId; i++) {
                    // è·³è¿‡æ’é™¤çš„å­¦å·
                    if (classConfig.excludedIds.includes(i)) continue;
                    
                    const button = document.createElement('button');
                    // ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®å±æ€§æ¥æ ‡è®°é€‰ä¸­çŠ¶æ€ï¼Œé¿å…CSSé€‰æ‹©å™¨ä¸­çš„æ–œæ é—®é¢˜
                    button.className = `student-number-btn w-10 h-10 flex items-center justify-center rounded-full glass-effect border border-white/30 hover:bg-primary/10 transition-all duration-300 hover-lift ${record.students.includes(i) ? 'selected' : ''}`;
                    button.dataset.selected = record.students.includes(i) ? 'true' : 'false';
                    button.textContent = i;
                    button.dataset.number = i;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    button.addEventListener('click', handleButtonClick);
                    
                    container.appendChild(button);
                }
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                modal.classList.remove('hidden');
            }
        }
        
        // å¯¼å‡ºExcel
        function exportToExcel() {
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            
            // å®šä¹‰æ ·å¼
            const styles = {
                header: {
                    font: { bold: true, sz: 12, color: { rgb: "000000" } },
                    fill: { type: "pattern", patternType: "solid", fgColor: { rgb: "CCCCCC" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                },
                cell: {
                    font: { sz: 11, color: { rgb: "000000" } },
                    alignment: { horizontal: "left", vertical: "top", wrapText: true },
                    border: {
                        top: { style: "thin", color: { rgb: "DDDDDD" } },
                        bottom: { style: "thin", color: { rgb: "DDDDDD" } },
                        left: { style: "thin", color: { rgb: "DDDDDD" } },
                        right: { style: "thin", color: { rgb: "DDDDDD" } }
                    }
                },
                numberCell: {
                    font: { sz: 11, color: { rgb: "000000" } },
                    alignment: { horizontal: "right", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "DDDDDD" } },
                        bottom: { style: "thin", color: { rgb: "DDDDDD" } },
                        left: { style: "thin", color: { rgb: "DDDDDD" } },
                        right: { style: "thin", color: { rgb: "DDDDDD" } }
                    }
                }
            };
            
            // å‡†å¤‡è¯¾ç¨‹æ•°æ® - æ¯å¤©ä¸€åˆ—çš„æ ¼å¼
            // è·å–æœ€å¤§è¯¾æ—¶æ•°
            // åªåŒ…å«å·¥ä½œæ—¥ï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰ï¼Œä¸åŒ…å«å‘¨å…­å’Œå‘¨æ—¥
            const daysOfWeek = ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”"];
            let maxCourseId = 0;
            daysOfWeek.forEach(day => {
                if (scheduleData[day]) {
                    scheduleData[day].forEach(course => {
                        if (course.id > maxCourseId) {
                            maxCourseId = course.id;
                        }
                    });
                }
            });
            
            // åˆ›å»ºäºŒç»´æ•°ç»„è¡¨ç¤ºè¡¨æ ¼
            // ç¬¬ä¸€è¡Œä¸ºæ ‡é¢˜è¡Œ
            const scheduleSheetData = [['è¯¾æ—¶']];
            
            // æ·»åŠ æ˜ŸæœŸä½œä¸ºåˆ—æ ‡é¢˜
            daysOfWeek.forEach(day => {
                scheduleSheetData[0].push(day);
            });
            
            // ä¸ºæ¯ä¸ªè¯¾æ—¶åˆ›å»ºä¸€è¡Œ
            for (let courseId = 1; courseId <= maxCourseId; courseId++) {
                const row = [courseId];
                
                // ä¸ºæ¯å¤©æ·»åŠ å¯¹åº”çš„è¯¾ç¨‹ä¿¡æ¯
                daysOfWeek.forEach(day => {
                    const course = scheduleData[day]?.find(c => c.id === courseId);
                    if (course && course.subject) {
                        // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ†å±‚ç§‘ç›®ï¼ˆæ•°å­¦æˆ–è‹±è¯­ï¼‰
                        if (course.subject === 'æ•°å­¦' || course.subject === 'è‹±è¯­') {
                            // åˆ†å±‚ç§‘ç›®å¤„ç†
                            let content = '';
                            for (let layer = 1; layer <= 3; layer++) {
                                const layerKey = `layer${layer}`;
                                const layerRating = course.layerRatings?.[layerKey] || 0;
                                const layerNotes = course.layerNotes?.[layerKey] || '';
                                
                                if (layerRating > 0 || layerNotes) {
                                    content += `${course.subject}(${layer}ç­)\nè¯„åˆ†: ${layerRating}\n`;
                                    if (layerNotes) {
                                        content += `å»ºè®®: ${layerNotes}\n`;
                                    }
                                }
                            }
                            // æ·»åŠ è¡¨ç°ä¸ä½³çš„å­¦ç”Ÿ
                            if (course.poorStudents && course.poorStudents.length > 0) {
                                content += `ä¸ä½³å­¦ç”Ÿ: ${course.poorStudents.join(', ')}`;
                            }
                            row.push(content.trim() || course.subject);
                        } else {
                            // æ™®é€šç§‘ç›®
                            let content = `${course.subject}\nè¯„åˆ†: ${course.rating}\n`;
                            if (course.notes) {
                                content += `å»ºè®®: ${course.notes}\n`;
                            }
                            if (course.poorStudents && course.poorStudents.length > 0) {
                                content += `ä¸ä½³å­¦ç”Ÿ: ${course.poorStudents.join(', ')}`;
                            }
                            row.push(content.trim());
                        }
                    } else {
                        row.push(''); // ç©ºå•å…ƒæ ¼
                    }
                });
                
                scheduleSheetData.push(row);
            }
            
            // å‡†å¤‡æœªäº¤ä½œä¸šæ•°æ®ï¼ˆä¿æŒåŸæœ‰æ ¼å¼ï¼‰
            const homeworkDataForExcel = [];
            homeworkRecords.forEach(record => {
                record.students.forEach(student => {
                    homeworkDataForExcel.push({
                        'æ—¥æœŸ': record.date,
                        'ç§‘ç›®': record.subject,
                        'æœªäº¤å­¦å·': student
                    });
                });
            });
            
            // åˆ›å»ºå·¥ä½œè¡¨
            // è¯¾ç¨‹è¡¨ç°è¡¨ä½¿ç”¨äºŒç»´æ•°ç»„ç›´æ¥åˆ›å»º
            if (scheduleSheetData.length > 1) { // ç¡®ä¿æœ‰æ•°æ®è¡Œ
                const wsSchedule = XLSX.utils.aoa_to_sheet(scheduleSheetData);
                
                // è®¾ç½®å•å…ƒæ ¼æ ·å¼å’Œåˆ—å®½
                // ä¸ºè¡¨å¤´è®¾ç½®æ ·å¼
                const range = XLSX.utils.decode_range(wsSchedule['!ref']);
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    // è¡¨å¤´å•å…ƒæ ¼æ ·å¼
                    const address = XLSX.utils.encode_cell({c: C, r: 0});
                    wsSchedule[address].s = styles.header;
                    
                    // è¯¾æ—¶åˆ—ä½¿ç”¨æ•°å­—å¯¹é½
                    if (C === 0) {
                        for (let R = 1; R <= range.e.r; ++R) {
                            const cellAddress = XLSX.utils.encode_cell({c: C, r: R});
                            if (wsSchedule[cellAddress]) {
                                wsSchedule[cellAddress].s = styles.numberCell;
                            }
                        }
                        // è®¾ç½®è¯¾æ—¶åˆ—å®½
                        wsSchedule['!cols'] = wsSchedule['!cols'] || [];
                        wsSchedule['!cols'][0] = {wch: 6};
                    } else {
                        // å…¶ä»–åˆ—ä½¿ç”¨æ–‡æœ¬å¯¹é½
                        for (let R = 1; R <= range.e.r; ++R) {
                            const cellAddress = XLSX.utils.encode_cell({c: C, r: R});
                            if (wsSchedule[cellAddress]) {
                                wsSchedule[cellAddress].s = styles.cell;
                            }
                        }
                        // è®¾ç½®å…¶ä»–åˆ—å®½
                        wsSchedule['!cols'] = wsSchedule['!cols'] || [];
                        wsSchedule['!cols'][C] = {wch: 30}; // è¯¾ç¨‹å†…å®¹åˆ—å®½
                    }
                }
                
                // è®¾ç½®è¡Œé«˜
                wsSchedule['!rows'] = [];
                for (let R = 0; R <= range.e.r; ++R) {
                    if (R === 0) {
                        // è¡¨å¤´è¡Œé«˜
                        wsSchedule['!rows'][R] = {hpt: 30};
                    } else {
                        // æ•°æ®è¡Œé«˜ - è€ƒè™‘å¤šè¡Œæ–‡æœ¬
                        wsSchedule['!rows'][R] = {hpt: 60};
                    }
                }
                
                XLSX.utils.book_append_sheet(wb, wsSchedule, 'è¯¾ç¨‹è¡¨ç°');
            }
            
            if (homeworkDataForExcel.length > 0) {
                const wsHomework = XLSX.utils.json_to_sheet(homeworkDataForExcel);
                
                // è®¾ç½®å•å…ƒæ ¼æ ·å¼å’Œåˆ—å®½
                const range = XLSX.utils.decode_range(wsHomework['!ref']);
                
                // ä¸ºè¡¨å¤´è®¾ç½®æ ·å¼
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({c: C, r: 0});
                    wsHomework[address].s = styles.header;
                }
                
                // ä¸ºæ•°æ®å•å…ƒæ ¼è®¾ç½®æ ·å¼
                for (let R = 1; R <= range.e.r; ++R) {
                    for (let C = range.s.c; C <= range.e.c; ++C) {
                        const address = XLSX.utils.encode_cell({c: C, r: R});
                        if (wsHomework[address]) {
                            // å­¦å·åˆ—ä½¿ç”¨æ•°å­—å¯¹é½
                            if (C === 2) { // æœªäº¤å­¦å·åˆ—
                                wsHomework[address].s = styles.numberCell;
                            } else { // å…¶ä»–åˆ—ä½¿ç”¨æ–‡æœ¬å¯¹é½
                                wsHomework[address].s = styles.cell;
                            }
                        }
                    }
                }
                
                // è®¾ç½®åˆ—å®½
                wsHomework['!cols'] = [
                    {wch: 12}, // æ—¥æœŸåˆ—å®½
                    {wch: 10}, // ç§‘ç›®åˆ—å®½
                    {wch: 10}  // å­¦å·åˆ—å®½
                ];
                
                // è®¾ç½®è¡Œé«˜
                wsHomework['!rows'] = [];
                for (let R = 0; R <= range.e.r; ++R) {
                    wsHomework['!rows'][R] = {hpt: 25};
                }
                
                XLSX.utils.book_append_sheet(wb, wsHomework, 'æœªäº¤ä½œä¸šè®°å½•');
            }
            
            // è®¾ç½®å·¥ä½œç°¿å±æ€§
            wb.Props = {
                Title: "ç­çº§ç»Ÿè®¡æŠ¥å‘Š",
                Subject: "ç­çº§å­¦æƒ…ç»Ÿè®¡",
                Author: "ç­çº§å­¦æƒ…ç»Ÿè®¡ç³»ç»Ÿ",
                CreatedDate: new Date()
            };
            
            // å¯¼å‡ºæ–‡ä»¶
            const dateStr = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `ç­çº§ç»Ÿè®¡_${dateStr}.xlsx`);
            showToast('Excelå¯¼å‡ºæˆåŠŸ', 'success');
        }
    </script>
</body>
</html>

